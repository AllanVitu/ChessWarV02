import{I as P,d as z,h as c,j as G,A as H,w as j,o,b as e,c as i,l as h,t as n,F as b,r as w,x as $,a as T,g as U,u as J,R as K,N as x,f as Q}from"./index-Bh88Vxd1.js";import{m as W,_ as X,f as Y,a as Z,c as ee,b as se,d as te,h as ae}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-9OWB--fr.js";import"./brand-icon-CM8iIody.js";import"./auth-DB9CY__F.js";const ne=async()=>{const p=await P("friends-list");return{friends:p.friends??[],incoming:p.incoming??[],outgoing:p.outgoing??[]}},oe={class:"content-grid"},ie={class:"left-column"},ce={class:"panel friends-card"},le={class:"panel-header"},re={class:"badge-soft"},ue={key:0,class:"panel-sub"},de={key:1,class:"form-message form-message--error"},ve={key:2,class:"friends-list"},me={class:"friend-ident"},he={class:"friend-avatar"},pe={class:"friend-name"},_e={class:"friend-meta"},fe={class:"friend-chips"},ge={class:"friend-chip"},ye={class:"friend-chip"},ke={class:"friend-chip"},be={class:"friend-actions"},we=["disabled","onClick"],Ce=["onClick"],Ie={key:0,class:"empty-state"},Re={class:"right-column"},Fe={class:"panel"},Ne={class:"friends-request-list"},$e={class:"request-info"},Ae={class:"friend-avatar"},qe={class:"friend-name"},Me={class:"friend-meta"},Ee={class:"request-actions"},Ve=["onClick"],je=["onClick"],xe={class:"request-info"},Be={class:"friend-avatar"},Oe={class:"friend-name"},Se=["onClick"],De={key:0,class:"empty-state"},Le={class:"panel"},Pe={class:"friends-request-list"},ze={class:"request-info"},Ge={class:"friend-avatar"},He={class:"friend-name"},Te={class:"friend-meta"},Ue={class:"request-actions"},Je=["onClick"],Ke=["onClick"],Qe={key:0,class:"empty-state"},es=z({__name:"FriendsView",setup(p){const A=Q(),_=c([]),C=c([]),I=c([]),R=c([]),f=c(!1),g=c(""),l=c(""),r=c(!1),u=c(""),d=c(!1),y=a=>{const t=a.trim();return t&&t.split(" ").filter(Boolean).slice(0,2).map(s=>s[0]?.toUpperCase()??"").join("")||"?"},F=a=>typeof a.isOnline=="boolean",N=a=>a.isOnline===!0,B=a=>F(a)?N(a)?"En ligne":"Hors ligne":"Statut inconnu",q=a=>!F(a)||N(a),v=()=>{l.value="",r.value=!1,u.value="",d.value=!1},k=async()=>{const a=await ne();_.value=a.friends,C.value=a.incoming,I.value=a.outgoing},M=async()=>{const a=await Y();R.value=a.matchInvites},O=async()=>{v(),g.value="",f.value=!0;try{await Promise.all([k(),M()])}catch(a){g.value=a.message}finally{f.value=!1}},E=async(a,t)=>{v();try{const s=await Z(a.user.id,t);l.value=s.message,r.value=!s.ok,s.ok&&await k()}catch(s){l.value=s.message,r.value=!0}},S=async a=>{v();try{const t=await ee(a.id);u.value=t.message,d.value=!t.ok,t.ok&&t.status==="accepted"&&t.matchId&&(x(),await A.push(`/jeu/${t.matchId}`))}catch(t){u.value=t.message,d.value=!0}},D=async a=>{v();try{const t=await se(a.user.id);l.value=t.message,r.value=!t.ok,t.ok&&await k()}catch(t){l.value=t.message,r.value=!0}},L=async a=>{v();try{const t=await te(a.id);l.value=t.message,r.value=!t.ok,t.ok&&await k()}catch(t){l.value=t.message,r.value=!0}},V=async(a,t)=>{v();try{const s=await ae(a.id,t);u.value=s.message,d.value=!s.ok,s.ok&&(await M(),t==="accept"&&s.matchId&&(x(),await A.push(`/jeu/${s.matchId}`)))}catch(s){u.value=s.message,d.value=!0}};return G(()=>{O(),W("all").catch(()=>{})}),(a,t)=>(o(),H(X,{eyebrow:"Social",title:"Mes amis",subtitle:"Gerez vos amis, vos demandes et les invitations de match."},{default:j(()=>[e("section",oe,[e("div",ie,[e("div",ce,[e("div",le,[t[0]||(t[0]=e("div",null,[e("p",{class:"panel-title"},"Amis"),e("h3",{class:"panel-headline"},"Votre cercle de joueurs")],-1)),e("span",re,n(_.value.length)+" amis",1)]),f.value?(o(),i("p",ue,"Chargement des amis...")):g.value?(o(),i("p",de,n(g.value),1)):(o(),i("div",ve,[(o(!0),i(b,null,w(_.value,s=>(o(),i("article",{key:s.id,class:"friend-row"},[e("div",me,[e("div",he,n(y(s.name)),1),e("div",null,[e("p",pe,n(s.name),1),e("p",_e,n(s.title||"Profil public"),1)])]),e("div",fe,[e("span",ge,"Elo "+n(s.rating),1),e("span",{class:$(["friend-chip",F(s)?N(s)?"friend-chip--online":"friend-chip--offline":"friend-chip--unknown"])},n(B(s)),3),e("span",ye,n(s.location||"Localisation inconnue"),1),e("span",ke,n(s.lastSeen||"Derniere activite inconnue"),1)]),e("div",be,[T(J(K),{class:"button-ghost",to:`/joueur/${s.id}`},{default:j(()=>[...t[1]||(t[1]=[U("Voir",-1)])]),_:1},8,["to"]),e("button",{class:"button-primary",type:"button",disabled:!q(s),onClick:m=>S(s)},n(q(s)?"Inviter":"Indisponible"),9,we),e("button",{class:"button-ghost",type:"button",onClick:m=>L(s)}," Retirer ",8,Ce)])]))),128)),!_.value.length&&!f.value?(o(),i("p",Ie," Aucun ami pour le moment. ")):h("",!0)])),u.value?(o(),i("p",{key:3,class:$(["form-message",d.value?"form-message--error":"form-message--success"])},n(u.value),3)):h("",!0)])]),e("aside",Re,[e("div",Fe,[t[3]||(t[3]=e("div",{class:"panel-header"},[e("div",null,[e("p",{class:"panel-title"},"Demandes d'amis"),e("h3",{class:"panel-headline"},"En attente")])],-1)),e("div",Ne,[(o(!0),i(b,null,w(C.value,s=>(o(),i("div",{key:s.id,class:"request-row"},[e("div",$e,[e("div",Ae,n(y(s.user.name)),1),e("div",null,[e("p",qe,n(s.user.name),1),e("p",Me,n(s.user.title||"Profil public"),1)])]),e("div",Ee,[e("button",{class:"button-primary",type:"button",onClick:m=>E(s,"accept")}," Accepter ",8,Ve),e("button",{class:"button-ghost",type:"button",onClick:m=>E(s,"decline")}," Refuser ",8,je)])]))),128)),(o(!0),i(b,null,w(I.value,s=>(o(),i("div",{key:s.id,class:"request-row request-row--outgoing"},[e("div",xe,[e("div",Be,n(y(s.user.name)),1),e("div",null,[e("p",Oe,n(s.user.name),1),t[2]||(t[2]=e("p",{class:"friend-meta"},"Demande envoyee",-1))])]),e("button",{class:"button-ghost",type:"button",onClick:m=>D(s)}," Annuler ",8,Se)]))),128))]),!C.value.length&&!I.value.length?(o(),i("p",De," Aucune demande en cours. ")):h("",!0),l.value?(o(),i("p",{key:1,class:$(["form-message",r.value?"form-message--error":"form-message--success"])},n(l.value),3)):h("",!0)]),e("div",Le,[t[4]||(t[4]=e("div",{class:"panel-header"},[e("div",null,[e("p",{class:"panel-title"},"Invitations de match"),e("h3",{class:"panel-headline"},"En cours")])],-1)),e("div",Pe,[(o(!0),i(b,null,w(R.value,s=>(o(),i("div",{key:s.id,class:"request-row"},[e("div",ze,[e("div",Ge,n(y(s.from.name)),1),e("div",null,[e("p",He,n(s.from.name),1),e("p",Te,"Cadence "+n(s.timeControl),1)])]),e("div",Ue,[e("button",{class:"button-primary",type:"button",onClick:m=>V(s,"accept")}," Accepter ",8,Je),e("button",{class:"button-ghost",type:"button",onClick:m=>V(s,"decline")}," Refuser ",8,Ke)])]))),128))]),R.value.length?h("",!0):(o(),i("p",Qe,"Aucune invitation."))])])])]),_:1}))}});export{es as default};
