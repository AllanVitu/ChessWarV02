import{N as Q,d as W,h as l,i as L,I as X,j as Y,E as Z,w as M,o,b as e,c as i,l as h,t as n,F as b,r as w,y as A,a as O,g as P,u as x,R as z,V as D,f as ee}from"./index-vPvGcPAP.js";import{m as se,_ as te,f as ae,a as ne,c as oe,b as ie,d as le,h as ce}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-CrY_gPxS.js";import"./brand-icon-BJNb36kE.js";const re=async()=>{const _=await Q("friends-list",{cacheTtlMs:3e4});return{friends:_.friends??[],incoming:_.incoming??[],outgoing:_.outgoing??[]}},ue={class:"content-grid"},de={class:"left-column"},ve={class:"panel friends-card"},me={class:"panel-header"},pe={class:"badge-soft"},he={key:0,class:"panel-sub"},_e={key:1,class:"form-message form-message--error"},fe={key:2,class:"friends-list"},ge={class:"friend-ident"},ye={class:"friend-avatar"},ke={class:"friend-name"},be={class:"friend-meta"},we={class:"friend-chips"},Ce={class:"friend-chip"},Ie={class:"friend-chip"},Re={class:"friend-chip"},Fe={class:"friend-actions"},Ne=["disabled","onClick"],$e=["onClick"],Me={key:0,class:"empty-state"},Ae={class:"right-column"},je={class:"panel"},qe={class:"friends-request-list"},Ee={class:"request-info"},Ve={class:"friend-avatar"},Se={class:"friend-name"},Be={class:"friend-meta"},Le={class:"request-actions"},Oe=["onClick"],Pe=["onClick"],xe={class:"request-info"},ze={class:"friend-avatar"},De={class:"friend-name"},Te=["onClick"],Ge={key:0,class:"empty-state"},He={class:"panel"},Ue={class:"friends-request-list"},Je={class:"request-info"},Ke={class:"friend-avatar"},Qe={class:"friend-name"},We={class:"friend-meta"},Xe={class:"request-actions"},Ye=["onClick"],Ze=["onClick"],es={key:0,class:"empty-state"},ss=6,os=W({__name:"FriendsView",setup(_){const j=ee(),d=l([]),C=l([]),I=l([]),R=l([]),f=l(!1),g=l(""),c=l(""),r=l(!1),u=l(""),v=l(!1),F=l(1),q=L(()=>d.value.slice(0,F.value*ss)),T=L(()=>q.value.length<d.value.length);X(d,()=>{F.value=1});const y=a=>{const t=a.trim();return t&&t.split(" ").filter(Boolean).slice(0,2).map(s=>s[0]?.toUpperCase()??"").join("")||"?"},N=a=>typeof a.isOnline=="boolean",$=a=>a.isOnline===!0,G=a=>N(a)?$(a)?"En ligne":"Hors ligne":"Statut inconnu",E=a=>!N(a)||$(a),m=()=>{c.value="",r.value=!1,u.value="",v.value=!1},k=async()=>{const a=await re();d.value=a.friends,C.value=a.incoming,I.value=a.outgoing},V=async()=>{const a=await ae();R.value=a.matchInvites},H=async()=>{m(),g.value="",f.value=!0;try{await Promise.all([k(),V()])}catch(a){g.value=a.message}finally{f.value=!1}},S=async(a,t)=>{m();try{const s=await ne(a.user.id,t);c.value=s.message,r.value=!s.ok,s.ok&&await k()}catch(s){c.value=s.message,r.value=!0}},U=async a=>{m();try{const t=await oe(a.id);u.value=t.message,v.value=!t.ok,t.ok&&t.status==="accepted"&&t.matchId&&(D(),await j.push(`/jeu/${t.matchId}`))}catch(t){u.value=t.message,v.value=!0}},J=async a=>{m();try{const t=await ie(a.user.id);c.value=t.message,r.value=!t.ok,t.ok&&await k()}catch(t){c.value=t.message,r.value=!0}},K=async a=>{m();try{const t=await le(a.id);c.value=t.message,r.value=!t.ok,t.ok&&await k()}catch(t){c.value=t.message,r.value=!0}},B=async(a,t)=>{m();try{const s=await ce(a.id,t);u.value=s.message,v.value=!s.ok,s.ok&&(await V(),t==="accept"&&s.matchId&&(D(),await j.push(`/jeu/${s.matchId}`)))}catch(s){u.value=s.message,v.value=!0}};return Y(()=>{H(),se("all").catch(()=>{})}),(a,t)=>(o(),Z(te,{eyebrow:"Social",title:"Mes amis",subtitle:"Gerez vos amis, vos demandes et les invitations de match."},{default:M(()=>[e("section",ue,[e("div",de,[e("div",ve,[e("div",me,[t[1]||(t[1]=e("div",null,[e("p",{class:"panel-title"},"Amis"),e("h3",{class:"panel-headline"},"Votre cercle de joueurs")],-1)),e("span",pe,n(d.value.length)+" amis",1)]),f.value?(o(),i("p",he,"Chargement des amis...")):g.value?(o(),i("p",_e,n(g.value),1)):(o(),i("div",fe,[(o(!0),i(b,null,w(q.value,s=>(o(),i("article",{key:s.id,class:"friend-row"},[e("div",ge,[e("div",ye,n(y(s.name)),1),e("div",null,[e("p",ke,n(s.name),1),e("p",be,n(s.title||"Profil public"),1)])]),e("div",we,[e("span",Ce,"Elo "+n(s.rating),1),e("span",{class:A(["friend-chip",N(s)?$(s)?"friend-chip--online":"friend-chip--offline":"friend-chip--unknown"])},n(G(s)),3),e("span",Ie,n(s.location||"Localisation inconnue"),1),e("span",Re,n(s.lastSeen||"Derniere activite inconnue"),1)]),e("div",Fe,[O(x(z),{class:"button-ghost",to:`/joueur/${s.id}`},{default:M(()=>[...t[2]||(t[2]=[P("Voir",-1)])]),_:1},8,["to"]),e("button",{class:"button-primary",type:"button",disabled:!E(s),onClick:p=>U(s)},n(E(s)?"Inviter":"Indisponible"),9,Ne),e("button",{class:"button-ghost",type:"button",onClick:p=>K(s)}," Retirer ",8,$e)])]))),128)),!d.value.length&&!f.value?(o(),i("div",Me,[t[4]||(t[4]=e("p",{class:"empty-state__title"},"Aucun ami pour le moment.",-1)),t[5]||(t[5]=e("p",{class:"empty-state__subtitle"},"Invitez un joueur pour lancer un match.",-1)),O(x(z),{class:"button-primary",to:"/leaderboard"},{default:M(()=>[...t[3]||(t[3]=[P("Trouver un joueur",-1)])]),_:1})])):T.value?(o(),i("button",{key:1,class:"button-ghost",type:"button",onClick:t[0]||(t[0]=s=>F.value+=1)}," Afficher plus ")):h("",!0)])),u.value?(o(),i("p",{key:3,class:A(["form-message",v.value?"form-message--error":"form-message--success"])},n(u.value),3)):h("",!0)])]),e("aside",Ae,[e("div",je,[t[7]||(t[7]=e("div",{class:"panel-header"},[e("div",null,[e("p",{class:"panel-title"},"Demandes d'amis"),e("h3",{class:"panel-headline"},"En attente")])],-1)),e("div",qe,[(o(!0),i(b,null,w(C.value,s=>(o(),i("div",{key:s.id,class:"request-row"},[e("div",Ee,[e("div",Ve,n(y(s.user.name)),1),e("div",null,[e("p",Se,n(s.user.name),1),e("p",Be,n(s.user.title||"Profil public"),1)])]),e("div",Le,[e("button",{class:"button-primary",type:"button",onClick:p=>S(s,"accept")}," Accepter ",8,Oe),e("button",{class:"button-ghost",type:"button",onClick:p=>S(s,"decline")}," Refuser ",8,Pe)])]))),128)),(o(!0),i(b,null,w(I.value,s=>(o(),i("div",{key:s.id,class:"request-row request-row--outgoing"},[e("div",xe,[e("div",ze,n(y(s.user.name)),1),e("div",null,[e("p",De,n(s.user.name),1),t[6]||(t[6]=e("p",{class:"friend-meta"},"Demande envoyee",-1))])]),e("button",{class:"button-ghost",type:"button",onClick:p=>J(s)}," Annuler ",8,Te)]))),128))]),!C.value.length&&!I.value.length?(o(),i("p",Ge," Aucune demande en cours. ")):h("",!0),c.value?(o(),i("p",{key:1,class:A(["form-message",r.value?"form-message--error":"form-message--success"])},n(c.value),3)):h("",!0)]),e("div",He,[t[8]||(t[8]=e("div",{class:"panel-header"},[e("div",null,[e("p",{class:"panel-title"},"Invitations de match"),e("h3",{class:"panel-headline"},"En cours")])],-1)),e("div",Ue,[(o(!0),i(b,null,w(R.value,s=>(o(),i("div",{key:s.id,class:"request-row"},[e("div",Je,[e("div",Ke,n(y(s.from.name)),1),e("div",null,[e("p",Qe,n(s.from.name),1),e("p",We,"Cadence "+n(s.timeControl),1)])]),e("div",Xe,[e("button",{class:"button-primary",type:"button",onClick:p=>B(s,"accept")}," Accepter ",8,Ye),e("button",{class:"button-ghost",type:"button",onClick:p=>B(s,"decline")}," Refuser ",8,Ze)])]))),128))]),R.value.length?h("",!0):(o(),i("p",es,"Aucune invitation."))])])])]),_:1}))}});export{os as default};
