import{d as j,h as m,Z as V,i as M,j as O,H as R,I as h,E as q,w as F,o as d,b as s,c as f,l as P,p as C,q as n,v as i,t as y,y as D,B as b,Y as I,_ as L,A as E,$,O as _}from"./index-vPvGcPAP.js";import{_ as J}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-CrY_gPxS.js";import"./brand-icon-BJNb36kE.js";const G={class:"profile-grid"},H={class:"panel profile-card"},Y={class:"form-field"},Z={class:"form-field"},K={class:"form-field"},Q={class:"form-field"},W={class:"form-field"},X={class:"avatar-field"},ee={class:"avatar-preview"},se=["src"],te={key:1},ae={class:"avatar-controls"},le={class:"form-field"},oe=["value"],re={key:1,class:"form-message form-message--success",role:"status"},ne={class:"panel profile-card"},ie={class:"form-field"},ue={class:"form-field"},pe={class:"form-field"},ce=j({__name:"ProfileView",setup(me){const u=m(null),t=V({name:"",title:"",motto:"",location:"",avatarUrl:""}),g=m(""),x=m(!1),v=m("");let w=null,U="",S=!1;const B=M(()=>u.value?.profile.email??""),N=M(()=>{const l=t.name.trim();return l&&l.split(" ").filter(Boolean).slice(0,2).map(a=>a[0]?.toUpperCase()??"").join("")||"?"}),o=V({current:"",next:"",confirm:""}),r=m(""),p=m(!1);O(async()=>{const l=await R();u.value=l,t.name=l.profile.name,t.title=l.profile.title,t.motto=l.profile.motto,t.location=l.profile.location,t.avatarUrl=l.profile.avatarUrl,U=JSON.stringify(t),S=!0});const z=l=>{const a=l.target?.files?.[0];if(!a)return;const c=new FileReader;c.onload=()=>{typeof c.result=="string"&&(t.avatarUrl=c.result)},c.readAsDataURL(a)},k=async(l=!1)=>{if(!u.value)return;u.value.profile={...u.value.profile,...t},u.value=await $(u.value);const e=_()?"Profil en attente de synchronisation.":"Profil mis a jour.";x.value=!1,l||(g.value=e,E("Profil",e))},A=async l=>{l?.preventDefault(),await k(!1)};h(t,()=>{if(!S)return;const l=JSON.stringify(t);l!==U&&(U=l,v.value="Sauvegarde automatique...",w&&clearTimeout(w),w=setTimeout(()=>{k(!0).finally(()=>{v.value=_()?"Sauvegarde en attente de connexion.":"Sauvegarde automatique terminee."})},800))},{deep:!0});const T=async()=>{if(r.value="",p.value=!1,!o.current||!o.next){r.value="Veuillez remplir tous les champs.",p.value=!0,b("Mot de passe",r.value);return}if(o.next!==o.confirm){r.value="Les mots de passe ne correspondent pas.",p.value=!0,b("Mot de passe",r.value);return}if(!await I()){r.value="Veuillez vous connecter pour modifier le mot de passe.",p.value=!0,b("Mot de passe",r.value);return}const e=await L(o.current,o.next);r.value=e.message,p.value=!e.ok,e.ok?(o.current="",o.next="",o.confirm="",E("Mot de passe",r.value)):b("Mot de passe",r.value)};return(l,e)=>(d(),q(J,{eyebrow:"Profil",title:"Parametres du compte",subtitle:"Gerez vos informations et la securite du compte."},{default:F(()=>[s("section",G,[s("div",H,[e[16]||(e[16]=s("div",{class:"panel-header"},[s("div",null,[s("p",{class:"panel-title"},"Profil public"),s("h3",{class:"panel-headline"},"Identite et preferences")])],-1)),s("form",{class:"form-stack",onSubmit:C(A,["prevent"])},[s("label",Y,[e[9]||(e[9]=s("span",{class:"form-label"},"Nom",-1)),n(s("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>t.name=a),class:"form-input",type:"text"},null,512),[[i,t.name]])]),s("label",Z,[e[10]||(e[10]=s("span",{class:"form-label"},"Titre",-1)),n(s("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>t.title=a),class:"form-input",type:"text"},null,512),[[i,t.title]])]),s("label",K,[e[11]||(e[11]=s("span",{class:"form-label"},"Devise",-1)),n(s("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>t.motto=a),class:"form-input",type:"text"},null,512),[[i,t.motto]])]),s("label",Q,[e[12]||(e[12]=s("span",{class:"form-label"},"Localisation",-1)),n(s("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>t.location=a),class:"form-input",type:"text"},null,512),[[i,t.location]])]),s("div",W,[e[13]||(e[13]=s("span",{class:"form-label"},"Avatar",-1)),s("div",X,[s("div",ee,[t.avatarUrl?(d(),f("img",{key:0,src:t.avatarUrl,alt:"Avatar profil",width:"72",height:"72",loading:"lazy",decoding:"async"},null,8,se)):(d(),f("span",te,y(N.value),1))]),s("div",ae,[n(s("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>t.avatarUrl=a),class:"form-input",type:"url",placeholder:"https://"},null,512),[[i,t.avatarUrl]]),s("input",{class:"form-input avatar-file",type:"file",accept:"image/*",onChange:z},null,32),s("button",{class:"button-ghost",type:"button",onClick:e[5]||(e[5]=a=>t.avatarUrl="")}," Retirer l'avatar ")])])]),s("label",le,[e[14]||(e[14]=s("span",{class:"form-label"},"Email",-1)),s("input",{class:"form-input",type:"email",value:B.value,disabled:""},null,8,oe)]),e[15]||(e[15]=s("button",{class:"button-primary",type:"submit"},"Enregistrer",-1))],32),g.value?(d(),f("p",{key:0,class:D(["form-message",x.value?"form-message--error":"form-message--success"]),role:"status"},y(g.value),3)):v.value?(d(),f("p",re,y(v.value),1)):P("",!0)]),s("div",ne,[e[21]||(e[21]=s("div",{class:"panel-header"},[s("div",null,[s("p",{class:"panel-title"},"Securite"),s("h3",{class:"panel-headline"},"Changer le mot de passe")])],-1)),s("form",{class:"form-stack",onSubmit:C(T,["prevent"])},[s("label",ie,[e[17]||(e[17]=s("span",{class:"form-label"},"Mot de passe actuel",-1)),n(s("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>o.current=a),class:"form-input",type:"password",autocomplete:"current-password"},null,512),[[i,o.current]])]),s("label",ue,[e[18]||(e[18]=s("span",{class:"form-label"},"Nouveau mot de passe",-1)),n(s("input",{"onUpdate:modelValue":e[7]||(e[7]=a=>o.next=a),class:"form-input",type:"password",autocomplete:"new-password"},null,512),[[i,o.next]])]),s("label",pe,[e[19]||(e[19]=s("span",{class:"form-label"},"Confirmer",-1)),n(s("input",{"onUpdate:modelValue":e[8]||(e[8]=a=>o.confirm=a),class:"form-input",type:"password",autocomplete:"new-password"},null,512),[[i,o.confirm]])]),e[20]||(e[20]=s("button",{class:"button-primary",type:"submit"},"Mettre a jour",-1))],32),r.value?(d(),f("p",{key:0,class:D(["form-message",p.value?"form-message--error":"form-message--success"]),role:"status"},y(r.value),3)):P("",!0)])])]),_:1}))}});export{ce as default};
