import{d as S,h as m,Q as g,i as U,j as A,C as B,A as j,w as N,o as d,b as s,c,l as x,m as V,p as n,v as i,t as y,x as k,S as _,y as M,z as b}from"./index-DDgC0ReB.js";import{_ as F}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-DlTTJkfp.js";import{g as L,u as R}from"./auth-CjXYnRhk.js";import"./brand-icon-DO1QUDMu.js";const I={class:"profile-grid"},T={class:"panel profile-card"},$={class:"form-field"},G={class:"form-field"},Q={class:"form-field"},q={class:"form-field"},H={class:"form-field"},J={class:"avatar-field"},K={class:"avatar-preview"},O=["src"],W={key:1},X={class:"avatar-controls"},Y={class:"form-field"},Z=["value"],h={class:"panel profile-card"},ee={class:"form-field"},se={class:"form-field"},te={class:"form-field"},ie=S({__name:"ProfileView",setup(ae){const u=m(null),t=g({name:"",title:"",motto:"",location:"",avatarUrl:""}),f=m(""),w=m(!1),C=U(()=>u.value?.profile.email??""),P=U(()=>{const o=t.name.trim();return o&&o.split(" ").filter(Boolean).slice(0,2).map(a=>a[0]?.toUpperCase()??"").join("")||"?"}),l=g({current:"",next:"",confirm:""}),r=m(""),p=m(!1);A(async()=>{const o=await B();u.value=o,t.name=o.profile.name,t.title=o.profile.title,t.motto=o.profile.motto,t.location=o.profile.location,t.avatarUrl=o.profile.avatarUrl});const D=o=>{const a=o.target?.files?.[0];if(!a)return;const v=new FileReader;v.onload=()=>{typeof v.result=="string"&&(t.avatarUrl=v.result)},v.readAsDataURL(a)},E=async()=>{u.value&&(u.value.profile={...u.value.profile,...t},u.value=await _(u.value),f.value="Profil mis a jour.",w.value=!1,M("Profil",f.value))},z=async()=>{if(r.value="",p.value=!1,!l.current||!l.next){r.value="Veuillez remplir tous les champs.",p.value=!0,b("Mot de passe",r.value);return}if(l.next!==l.confirm){r.value="Les mots de passe ne correspondent pas.",p.value=!0,b("Mot de passe",r.value);return}if(!await L()){r.value="Veuillez vous connecter pour modifier le mot de passe.",p.value=!0,b("Mot de passe",r.value);return}const e=await R(l.current,l.next);r.value=e.message,p.value=!e.ok,e.ok?(l.current="",l.next="",l.confirm="",M("Mot de passe",r.value)):b("Mot de passe",r.value)};return(o,e)=>(d(),j(F,{eyebrow:"Profil",title:"Parametres du compte",subtitle:"Gerez vos informations et la securite du compte."},{default:N(()=>[s("section",I,[s("div",T,[e[16]||(e[16]=s("div",{class:"panel-header"},[s("div",null,[s("p",{class:"panel-title"},"Profil public"),s("h3",{class:"panel-headline"},"Identite et preferences")])],-1)),s("form",{class:"form-stack",onSubmit:V(E,["prevent"])},[s("label",$,[e[9]||(e[9]=s("span",{class:"form-label"},"Nom",-1)),n(s("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>t.name=a),class:"form-input",type:"text"},null,512),[[i,t.name]])]),s("label",G,[e[10]||(e[10]=s("span",{class:"form-label"},"Titre",-1)),n(s("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>t.title=a),class:"form-input",type:"text"},null,512),[[i,t.title]])]),s("label",Q,[e[11]||(e[11]=s("span",{class:"form-label"},"Devise",-1)),n(s("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>t.motto=a),class:"form-input",type:"text"},null,512),[[i,t.motto]])]),s("label",q,[e[12]||(e[12]=s("span",{class:"form-label"},"Localisation",-1)),n(s("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>t.location=a),class:"form-input",type:"text"},null,512),[[i,t.location]])]),s("div",H,[e[13]||(e[13]=s("span",{class:"form-label"},"Avatar",-1)),s("div",J,[s("div",K,[t.avatarUrl?(d(),c("img",{key:0,src:t.avatarUrl,alt:"Avatar profil",width:"72",height:"72",loading:"lazy",decoding:"async"},null,8,O)):(d(),c("span",W,y(P.value),1))]),s("div",X,[n(s("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>t.avatarUrl=a),class:"form-input",type:"url",placeholder:"https://"},null,512),[[i,t.avatarUrl]]),s("input",{class:"form-input avatar-file",type:"file",accept:"image/*",onChange:D},null,32),s("button",{class:"button-ghost",type:"button",onClick:e[5]||(e[5]=a=>t.avatarUrl="")}," Retirer l'avatar ")])])]),s("label",Y,[e[14]||(e[14]=s("span",{class:"form-label"},"Email",-1)),s("input",{class:"form-input",type:"email",value:C.value,disabled:""},null,8,Z)]),e[15]||(e[15]=s("button",{class:"button-primary",type:"submit"},"Enregistrer",-1))],32),f.value?(d(),c("p",{key:0,class:k(["form-message",w.value?"form-message--error":"form-message--success"]),role:"status"},y(f.value),3)):x("",!0)]),s("div",h,[e[21]||(e[21]=s("div",{class:"panel-header"},[s("div",null,[s("p",{class:"panel-title"},"Securite"),s("h3",{class:"panel-headline"},"Changer le mot de passe")])],-1)),s("form",{class:"form-stack",onSubmit:V(z,["prevent"])},[s("label",ee,[e[17]||(e[17]=s("span",{class:"form-label"},"Mot de passe actuel",-1)),n(s("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>l.current=a),class:"form-input",type:"password",autocomplete:"current-password"},null,512),[[i,l.current]])]),s("label",se,[e[18]||(e[18]=s("span",{class:"form-label"},"Nouveau mot de passe",-1)),n(s("input",{"onUpdate:modelValue":e[7]||(e[7]=a=>l.next=a),class:"form-input",type:"password",autocomplete:"new-password"},null,512),[[i,l.next]])]),s("label",te,[e[19]||(e[19]=s("span",{class:"form-label"},"Confirmer",-1)),n(s("input",{"onUpdate:modelValue":e[8]||(e[8]=a=>l.confirm=a),class:"form-input",type:"password",autocomplete:"new-password"},null,512),[[i,l.confirm]])]),e[20]||(e[20]=s("button",{class:"button-primary",type:"submit"},"Mettre a jour",-1))],32),r.value?(d(),c("p",{key:0,class:k(["form-message",p.value?"form-message--error":"form-message--success"]),role:"status"},y(r.value),3)):x("",!0)])])]),_:1}))}});export{ie as default};
