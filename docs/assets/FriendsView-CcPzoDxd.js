import{d as Q,e as l,p as z,G as W,f as X,s as Y,w as M,o,b as e,c as i,g as h,t as n,F as b,a as w,n as A,i as B,z as L,u as O,x as P,y as Z}from"./vendor-vue-DHDwDR0M.js";import{m as ee,_ as se,f as te,a as ae,c as ne,b as oe,d as ie,h as le}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-CAFU19Jj.js";import{f as ce,m as D}from"./index-D5r2B9WW.js";import"./brand-icon-IDKxxvz3.js";const re=async()=>{const _=await ce("friends-list",{cacheTtlMs:3e4});return{friends:_.friends??[],incoming:_.incoming??[],outgoing:_.outgoing??[]}},ue={class:"content-grid"},de={class:"left-column"},ve={class:"panel friends-card"},me={class:"panel-header"},pe={class:"badge-soft"},he={key:0,class:"panel-sub"},_e={key:1,class:"form-message form-message--error"},fe={key:2,class:"friends-list"},ge={class:"friend-ident"},ye={class:"friend-avatar"},ke={class:"friend-name"},be={class:"friend-meta"},we={class:"friend-chips"},Ce={class:"friend-chip"},Ie={class:"friend-chip"},Fe={class:"friend-chip"},Re={class:"friend-actions"},$e=["disabled","onClick"],Ne=["onClick"],Me={key:0,class:"empty-state"},Ae={class:"right-column"},qe={class:"panel"},je={class:"friends-request-list"},Ee={class:"request-info"},Ve={class:"friend-avatar"},Se={class:"friend-name"},xe={class:"friend-meta"},ze={class:"request-actions"},Be=["onClick"],Le=["onClick"],Oe={class:"request-info"},Pe={class:"friend-avatar"},De={class:"friend-name"},Te=["onClick"],Ge={key:0,class:"empty-state"},He={class:"panel"},Ue={class:"friends-request-list"},Je={class:"request-info"},Ke={class:"friend-avatar"},Qe={class:"friend-name"},We={class:"friend-meta"},Xe={class:"request-actions"},Ye=["onClick"],Ze=["onClick"],es={key:0,class:"empty-state"},ss=6,is=Q({__name:"FriendsView",setup(_){const q=Z(),d=l([]),C=l([]),I=l([]),F=l([]),f=l(!1),g=l(""),c=l(""),r=l(!1),u=l(""),v=l(!1),R=l(1),j=z(()=>d.value.slice(0,R.value*ss)),T=z(()=>j.value.length<d.value.length);W(d,()=>{R.value=1});const y=a=>{const t=a.trim();return t&&t.split(" ").filter(Boolean).slice(0,2).map(s=>s[0]?.toUpperCase()??"").join("")||"?"},$=a=>typeof a.isOnline=="boolean",N=a=>a.isOnline===!0,G=a=>$(a)?N(a)?"En ligne":"Hors ligne":"Statut inconnu",E=a=>!$(a)||N(a),m=()=>{c.value="",r.value=!1,u.value="",v.value=!1},k=async()=>{const a=await re();d.value=a.friends,C.value=a.incoming,I.value=a.outgoing},V=async()=>{const a=await te();F.value=a.matchInvites},H=async()=>{m(),g.value="",f.value=!0;try{await Promise.all([k(),V()])}catch(a){g.value=a.message}finally{f.value=!1}},S=async(a,t)=>{m();try{const s=await ae(a.user.id,t);c.value=s.message,r.value=!s.ok,s.ok&&await k()}catch(s){c.value=s.message,r.value=!0}},U=async a=>{m();try{const t=await ne(a.id);u.value=t.message,v.value=!t.ok,t.ok&&t.status==="accepted"&&t.matchId&&(D(),await q.push(`/jeu/${t.matchId}`))}catch(t){u.value=t.message,v.value=!0}},J=async a=>{m();try{const t=await oe(a.user.id);c.value=t.message,r.value=!t.ok,t.ok&&await k()}catch(t){c.value=t.message,r.value=!0}},K=async a=>{m();try{const t=await ie(a.id);c.value=t.message,r.value=!t.ok,t.ok&&await k()}catch(t){c.value=t.message,r.value=!0}},x=async(a,t)=>{m();try{const s=await le(a.id,t);u.value=s.message,v.value=!s.ok,s.ok&&(await V(),t==="accept"&&s.matchId&&(D(),await q.push(`/jeu/${s.matchId}`)))}catch(s){u.value=s.message,v.value=!0}};return X(()=>{H(),ee("all").catch(()=>{})}),(a,t)=>(o(),Y(se,{eyebrow:"Social",title:"Mes amis",subtitle:"Gerez vos amis, vos demandes et les invitations de match."},{default:M(()=>[e("section",ue,[e("div",de,[e("div",ve,[e("div",me,[t[1]||(t[1]=e("div",null,[e("p",{class:"panel-title"},"Amis"),e("h3",{class:"panel-headline"},"Votre cercle de joueurs")],-1)),e("span",pe,n(d.value.length)+" amis",1)]),f.value?(o(),i("p",he,"Chargement des amis...")):g.value?(o(),i("p",_e,n(g.value),1)):(o(),i("div",fe,[(o(!0),i(b,null,w(j.value,s=>(o(),i("article",{key:s.id,class:"friend-row"},[e("div",ge,[e("div",ye,n(y(s.name)),1),e("div",null,[e("p",ke,n(s.name),1),e("p",be,n(s.title||"Profil public"),1)])]),e("div",we,[e("span",Ce,"Elo "+n(s.rating),1),e("span",{class:A(["friend-chip",$(s)?N(s)?"friend-chip--online":"friend-chip--offline":"friend-chip--unknown"])},n(G(s)),3),e("span",Ie,n(s.location||"Localisation inconnue"),1),e("span",Fe,n(s.lastSeen||"Derniere activite inconnue"),1)]),e("div",Re,[B(O(P),{class:"button-ghost",to:`/joueur/${s.id}`},{default:M(()=>[...t[2]||(t[2]=[L("Voir",-1)])]),_:1},8,["to"]),e("button",{class:"button-primary",type:"button",disabled:!E(s),onClick:p=>U(s)},n(E(s)?"Inviter":"Indisponible"),9,$e),e("button",{class:"button-ghost",type:"button",onClick:p=>K(s)}," Retirer ",8,Ne)])]))),128)),!d.value.length&&!f.value?(o(),i("div",Me,[t[4]||(t[4]=e("p",{class:"empty-state__title"},"Aucun ami pour le moment.",-1)),t[5]||(t[5]=e("p",{class:"empty-state__subtitle"},"Invitez un joueur pour lancer un match.",-1)),B(O(P),{class:"button-primary",to:"/leaderboard"},{default:M(()=>[...t[3]||(t[3]=[L("Trouver un joueur",-1)])]),_:1})])):T.value?(o(),i("button",{key:1,class:"button-ghost",type:"button",onClick:t[0]||(t[0]=s=>R.value+=1)}," Afficher plus ")):h("",!0)])),u.value?(o(),i("p",{key:3,class:A(["form-message",v.value?"form-message--error":"form-message--success"])},n(u.value),3)):h("",!0)])]),e("aside",Ae,[e("div",qe,[t[7]||(t[7]=e("div",{class:"panel-header"},[e("div",null,[e("p",{class:"panel-title"},"Demandes d'amis"),e("h3",{class:"panel-headline"},"En attente")])],-1)),e("div",je,[(o(!0),i(b,null,w(C.value,s=>(o(),i("div",{key:s.id,class:"request-row"},[e("div",Ee,[e("div",Ve,n(y(s.user.name)),1),e("div",null,[e("p",Se,n(s.user.name),1),e("p",xe,n(s.user.title||"Profil public"),1)])]),e("div",ze,[e("button",{class:"button-primary",type:"button",onClick:p=>S(s,"accept")}," Accepter ",8,Be),e("button",{class:"button-ghost",type:"button",onClick:p=>S(s,"decline")}," Refuser ",8,Le)])]))),128)),(o(!0),i(b,null,w(I.value,s=>(o(),i("div",{key:s.id,class:"request-row request-row--outgoing"},[e("div",Oe,[e("div",Pe,n(y(s.user.name)),1),e("div",null,[e("p",De,n(s.user.name),1),t[6]||(t[6]=e("p",{class:"friend-meta"},"Demande envoyee",-1))])]),e("button",{class:"button-ghost",type:"button",onClick:p=>J(s)}," Annuler ",8,Te)]))),128))]),!C.value.length&&!I.value.length?(o(),i("p",Ge," Aucune demande en cours. ")):h("",!0),c.value?(o(),i("p",{key:1,class:A(["form-message",r.value?"form-message--error":"form-message--success"])},n(c.value),3)):h("",!0)]),e("div",He,[t[8]||(t[8]=e("div",{class:"panel-header"},[e("div",null,[e("p",{class:"panel-title"},"Invitations de match"),e("h3",{class:"panel-headline"},"En cours")])],-1)),e("div",Ue,[(o(!0),i(b,null,w(F.value,s=>(o(),i("div",{key:s.id,class:"request-row"},[e("div",Je,[e("div",Ke,n(y(s.from.name)),1),e("div",null,[e("p",Qe,n(s.from.name),1),e("p",We,"Cadence "+n(s.timeControl),1)])]),e("div",Xe,[e("button",{class:"button-primary",type:"button",onClick:p=>x(s,"accept")}," Accepter ",8,Ye),e("button",{class:"button-ghost",type:"button",onClick:p=>x(s,"decline")}," Refuser ",8,Ze)])]))),128))]),F.value.length?h("",!0):(o(),i("p",es,"Aucune invitation."))])])])]),_:1}))}});export{is as default};
