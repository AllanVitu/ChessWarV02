import{d as pt,p as o,A as yt,e as n,G as He,h as bt,s as wt,w as gt,o as h,b as t,c as p,g as k,t as i,n as E,a as Ke,F as We,C as kt,D as _t,J as Mt,B as Ct,K as _a,y as St}from"./vendor-vue-DHDwDR0M.js";import{_ as Tt,c as At}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-BFjnVVcr.js";import{f as ee,i as Ma,j as Ca,k as It,e as Na,m as Nt,t as we,o as Lt,p as Et}from"./index-VbADcaYQ.js";import{c as ze,g as Ot,f as Sa,a as Ta,b as $t}from"./engine-CbTNbDBF.js";import{g as xt}from"./pieceAssets-DL4XSxcU.js";import"./brand-icon-IDKxxvz3.js";const Jt="/api",Aa=(()=>{const c="".trim();return c?c.startsWith("ws://")||c.startsWith("wss://")?c:c.startsWith("https://")?`wss://${c.slice(8)}`:c.startsWith("http://")?`ws://${c.slice(7)}`:c:""})(),Ia=async c=>{const r=await ee(`match-room-get?matchId=${encodeURIComponent(c)}`);if(!r.ok||!r.match)throw new Error("Match introuvable.");return r.match},Pt=async(c,r)=>{if(Ma())throw await Ca("match-move",{matchId:c,...r}),new Error("Connexion hors ligne. Coup mis en attente.");try{const m=await ee("match-move-add",{method:"POST",body:JSON.stringify({matchId:c,from:r.from,to:r.to,notation:r.notation})});if(!m.ok||!m.match)throw new Error("Impossible de jouer le coup.");return m.match}catch(m){throw It(m)||Ma()?(await Ca("match-move",{matchId:c,...r}),new Error("Connexion instable. Coup mis en attente.")):m}},Rt=async(c,r)=>{const m=await ee("match-message-add",{method:"POST",body:JSON.stringify({matchId:c,message:r})});if(!m.ok||!m.match)throw new Error("Impossible d'envoyer le message.");return m.match},Bt=async(c,r)=>{const m=await ee("match-finish",{method:"POST",body:JSON.stringify({matchId:c,result:r})});if(!m.ok||!m.match)throw new Error("Impossible de terminer le match.");return m.match},Dt=async c=>{const r=await ee("match-ready",{method:"POST",body:JSON.stringify({matchId:c})});if(!r.ok||!r.match)throw new Error("Impossible de confirmer la presence.");return r.match},Ft=async c=>{const r=await ee("match-presence",{method:"POST",body:JSON.stringify({matchId:c})});if(!r.ok||!r.match)throw new Error("Presence non enregistree.");return r.match},Ut=(c,r,m)=>{const s=Na();if(!s)return null;const y=new EventSource(`${Jt}/match-stream?matchId=${encodeURIComponent(c)}&token=${encodeURIComponent(s)}`);return y.addEventListener("match",D=>{try{const O=JSON.parse(D.data);r(O)}catch{}}),m&&y.addEventListener("error",m),y},Vt=(c,r,m)=>{if(!Aa)return null;const s=Na();if(!s||!c)return null;const y=new WebSocket(Aa),D=JSON.stringify({type:"subscribe",matchId:c,token:s});return y.addEventListener("open",()=>{y.send(D)}),y.addEventListener("message",O=>{try{const ae=JSON.parse(String(O.data));r(ae)}catch{}}),m&&y.addEventListener("error",m),y},jt={class:"game-layout"},Ht={class:"game-stack"},Kt={class:"panel game-board"},Wt={class:"panel-header"},zt={class:"panel-headline"},qt={class:"badge-soft"},Gt={key:0,class:"form-message form-message--success"},Qt={key:1,class:"form-message form-message--error"},Xt={class:"player-strip"},Yt={class:"player-avatar"},Zt={class:"player-info"},el={class:"player-name"},al={class:"player-avatar"},tl={class:"player-info"},ll={class:"player-name"},sl={class:"board-wrap"},nl={class:"board",role:"grid","aria-label":"Plateau d'echecs"},ol=["aria-label","aria-pressed","onClick"],rl=["src"],il={class:"panel game-actions"},ul={key:0,class:"game-ready"},cl={class:"panel-sub"},vl=["disabled"],dl=["disabled"],ml=["disabled"],fl=["disabled"],hl={key:2,class:"game-rematch"},pl={class:"panel game-panel"},yl={class:"game-info"},bl={class:"metric-label"},wl={class:"metric-value"},gl={class:"metric-label"},kl={class:"metric-value"},_l={class:"metric-value"},Ml={key:0},Cl={class:"metric-value"},Sl={key:1},Tl={class:"metric-value"},Al={class:"panel-subsection"},Il={class:"move-list"},Nl={key:0,class:"empty-state"},Ll={class:"move-ply"},El={class:"move-side"},Ol={class:"move-notation"},$l={key:0,class:"panel-subsection match-chat"},xl={key:0,class:"empty-state"},Jl={class:"chat-row"},Pl={class:"chat-name"},Rl={class:"chat-time"},Bl={class:"chat-text"},Dl={class:"chat-input-row"},Fl=["disabled","onKeydown"],Ul=["disabled"],Vl={key:0,class:"form-message form-message--error"},Gl=pt({__name:"GameView",setup(c){const r=yt(),m=St(),s=o(()=>r.params.id?String(r.params.id):""),y=n(null),D=n([]),O=n([]),ae=n("white"),qe=n("white"),Ie=n(null),Ne=n(null),Le=n(null),Ee=n(null),w=n("waiting"),ge=n(null),Oe=n(null),$e=n(null),J=n(!1),f=n(""),F=n(!1);let te=null,q=null,xe=!1;const G=n(""),Q=n(!1),le=n(""),U=n(null),V=n(""),X=n(!1),P=n(""),ke=n(!1),C=n(0),S=n(0),I=n(0),se=n(!1),Y=n(""),ne=n(!1);let _e=null;const $=n(!1),oe=n("");let re=null,Ge="";const Qe=n(Math.floor(Math.random()*1e3)),j=n(!1);let ie=null;const Je=n(0),H=n(0);let ue=null,ce=null;const La=e=>/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e),Xe=o(()=>La(s.value)),ve=e=>Array.isArray(e)?e[0]??"":typeof e=="string"?e:"",Ye=o(()=>ve(r.query.mode).toLowerCase()),Ze=o(()=>Ye.value==="ia"?"IA":Ye.value==="histoire"?"Histoire":"Local"),ea=o(()=>{const e=ve(r.query.side);return e==="Blancs"||e==="Noirs"||e==="Aleatoire"?e:"Aleatoire"}),aa=o(()=>{const e=ve(r.query.time).trim();return e&&/^\d+(?:\+\d+)?$/.test(e)?e:"10+0"}),Pe=o(()=>{const e=ve(r.query.difficulty);return e==="facile"||e==="intermediaire"||e==="difficile"||e==="maitre"?e:"intermediaire"}),de=o(()=>{const e=Number.parseInt(ve(r.query.chapter),10);return Number.isFinite(e)?e:0}),_=o(()=>s.value?Xe.value?"JcJ":y.value?.mode??ge.value??"JcJ":Ze.value),v=o(()=>_.value==="JcJ"),M=o(()=>_.value==="IA"||_.value==="Histoire"),ta=o(()=>_.value==="JcJ"?"En ligne":_.value),Me=o(()=>{if(M.value)return"IA";const e=y.value?.opponent??Oe.value;return e||"Adversaire"}),me=o(()=>s.value?y.value?.timeControl??$e.value??"10+0":aa.value),Ea=o(()=>_.value==="Local"&&!M.value?"Camp joueur 1":"Votre couleur"),Oa=o(()=>_.value==="Local"&&!M.value?"Joueur 2":"Adversaire"),$a=o(()=>_.value==="Histoire"&&de.value?`Mode ${ta.value} - Chapitre ${de.value} - Cadence ${me.value}`:`Mode ${ta.value} - ${Me.value} - Cadence ${me.value}`),la=o(()=>v.value?J.value?"Connexion au match en ligne...":F.value?"Envoi du coup...":w.value==="waiting"?"En attente des joueurs.":w.value==="ready"?H.value>0?`Demarrage dans ${H.value}s`:"Demarrage en cours...":w.value==="finished"||w.value==="aborted"?"Match termine. Vous pouvez proposer une revanche.":b.value===T.value?"A vous de jouer.":"En attente du coup adverse.":""),xa=async()=>{if(oe.value)return;const e=await Et();oe.value=e?.id??""};He(s,async()=>{const e=s.value||"local";if(Ge!==e&&(Ge=e,we({payload:{mode:_.value}})),Se(),pe(),Te(),R(),De(),he(),fa(),D.value=[],O.value=[],f.value="",F.value=!1,ae.value="white",qe.value="white",Ie.value=null,Ne.value=null,Le.value=null,Ee.value=null,w.value="waiting",ge.value=null,Oe.value=null,$e.value=null,G.value="",Q.value=!1,le.value="",V.value="",X.value=!1,P.value="",ke.value=!1,C.value=0,S.value=0,I.value=0,se.value=!1,Y.value="",ne.value=!1,$.value=!1,Je.value=0,H.value=0,!s.value){y.value=null,Ce();return}const a=Xe.value;a&&(ge.value="JcJ"),y.value=await Lt(s.value),y.value?.mode==="JcJ"?await ba():y.value?Ce(!1):a&&await ba()},{immediate:!0});const Ja=o(()=>`${Ze.value}|${ea.value}|${aa.value}|${Pe.value}|${de.value}`);He(Ja,()=>{s.value||Ce()});const sa=o(()=>y.value?.side?y.value.side:s.value?"Aleatoire":ea.value),T=o(()=>v.value?ae.value:sa.value==="Blancs"?"white":sa.value==="Noirs"?"black":(s.value?Number.parseInt(s.value.slice(-1)||"0",10):Qe.value)%2===0?"white":"black"),fe=o(()=>M.value?T.value==="white"?"black":"white":null),N=o(()=>v.value?["finished","aborted"].includes(w.value):$.value),na=o(()=>v.value?T.value==="white"?Ne.value??"":Ie.value??"":""),Re=o(()=>v.value?T.value==="white"?!!Le.value:!!Ee.value:!1),Pa=e=>{const a=e.trim(),l=/^(\d+)(?:\+(\d+))?$/.exec(a);if(!l)return{initialMs:600*1e3,incrementMs:0};const d=Math.max(1,Number.parseInt(l[1]??"10",10)),u=Math.max(0,Number.parseInt(l[2]??"0",10));return{initialMs:d*60*1e3,incrementMs:u*1e3}},Be=o(()=>Pa(me.value)),oa=e=>{const a=Math.max(0,Math.ceil(e/1e3)),l=Math.floor(a/60),d=a%60;return`${l}:${d.toString().padStart(2,"0")}`},ra=e=>e<=1e4?"player-clock--danger":e<=3e4?"player-clock--warning":"",Ra=o(()=>oa(C.value)),Ba=o(()=>oa(S.value)),ia=o(()=>v.value?w.value==="started"&&!J.value&&!F.value:!$.value),K=n(ze()),b=n("white"),A=n(null),Z=n(null),W=n([]),ua=["a","b","c","d","e","f","g","h"],Da=[8,7,6,5,4,3,2,1],Fa=e=>{const a=e[0]??"",l=Number(e[1]),d=ua.indexOf(a);return{row:8-l,col:d===-1?0:d}},Ua={p:"p",r:"r",n:"n",b:"b",q:"q",k:"k",P:"P",R:"R",N:"N",B:"B",Q:"Q",K:"K"},Va={p:"pion noir",r:"tour noire",n:"cavalier noir",b:"fou noir",q:"dame noire",k:"roi noir",P:"pion blanc",R:"tour blanche",N:"cavalier blanc",B:"fou blanc",Q:"dame blanche",K:"roi blanc"},ja=o(()=>Ot(K.value,b.value)),ca=o(()=>A.value?ja.value.filter(e=>e.from===A.value):[]),Ha=o(()=>new Set(ca.value.map(e=>e.to))),Ka=o(()=>v.value?w.value==="started"&&!J.value&&!F.value&&b.value===T.value:$.value?!1:M.value?b.value===T.value&&!j.value:!0),va=o(()=>_.value==="Local"&&!M.value?"Joueur 1":M.value?T.value==="white"?"Vous":"IA":T.value==="white"?"Vous":Me.value),da=o(()=>_.value==="Local"&&!M.value?"Joueur 2":M.value?T.value==="black"?"Vous":"IA":T.value==="black"?"Vous":Me.value),Wa=o(()=>({facile:"Facile",intermediaire:"Intermediaire",difficile:"Difficile",maitre:"Maitre"})[Pe.value]??"Intermediaire"),ma=e=>{const a=e.trim();return a&&a.split(" ").filter(Boolean).slice(0,2).map(l=>l[0]?.toUpperCase()??"").join("")||"?"},za=e=>{let a=ze();const l=[];let d=null;for(const u of e){const g=Fa(u.from),ye=a[g.row]?.[g.col]??"";ye&&(a=Ta(a,{from:u.from,to:u.to,piece:ye}),l.push({ply:u.ply,side:u.side==="white"?"white":"black",notation:u.notation}),d={from:u.from,to:u.to})}K.value=a,W.value=l,Z.value=d,A.value=null},x=e=>{D.value=e.moves??[],O.value=e.messages??[];let a=e.yourSide;oe.value&&(e.whiteId&&e.whiteId===oe.value?a="white":e.blackId&&e.blackId===oe.value&&(a="black")),ae.value=a??"white",qe.value=e.sideToMove,Ie.value=e.whiteId??null,Ne.value=e.blackId??null,Le.value=e.whiteReadyAt??null,Ee.value=e.blackReadyAt??null,w.value=e.status??"waiting",ge.value=e.mode??"JcJ",e.opponent&&(Oe.value=e.opponent),e.timeControl&&($e.value=e.timeControl),b.value=e.sideToMove,F.value=!1,qa(e),za(D.value),Ya(e),Za(e)},z=()=>Date.now()+Je.value,qa=e=>{if(!e.serverTime)return;const a=new Date(e.serverTime).getTime();Number.isFinite(a)&&(Je.value=a-Date.now())},R=()=>{_e&&(clearInterval(_e),_e=null)},he=()=>{ue&&(clearInterval(ue),ue=null)},fa=()=>{ce&&(clearInterval(ce),ce=null)},De=()=>{ie&&(clearTimeout(ie),ie=null),j.value=!1},Fe=()=>{se.value||(C.value===0||S.value===0)&&(se.value=!0,rt())},ha=()=>{R(),I.value=v.value?z():Date.now(),_e=setInterval(()=>{if(!ia.value||N.value){I.value=v.value?z():Date.now();return}const e=v.value?z():Date.now(),a=e-I.value;I.value=e,b.value==="white"?C.value=Math.max(0,C.value-a):S.value=Math.max(0,S.value-a),Fe()},250)},Ga=()=>{if(!ia.value||N.value)return;const e=v.value?z():Date.now(),a=e-I.value;I.value=e,b.value==="white"?C.value=Math.max(0,C.value-a):S.value=Math.max(0,S.value-a)},Qa=e=>{const{incrementMs:a}=Be.value;a<=0||(e==="white"?C.value+=a:S.value+=a)},Xa=()=>{const{initialMs:e}=Be.value;C.value=e,S.value=e,$.value=!1,se.value=!1,Y.value="",ne.value=!1,I.value=Date.now(),ha()},Ce=(e=!0)=>{De(),R(),K.value=ze(),b.value="white",A.value=null,Z.value=null,W.value=[],e&&(Qe.value=Math.floor(Math.random()*1e3)),Xa(),pa()},pa=()=>{if(!M.value||!fe.value||N.value||$.value||b.value!==fe.value||j.value)return;j.value=!0;const e=450+Math.floor(Math.random()*650);ie=setTimeout(()=>{if(ie=null,!M.value||!fe.value){j.value=!1;return}if(N.value||$.value||b.value!==fe.value){j.value=!1;return}const a=$t(K.value,fe.value,Pe.value);if(j.value=!1,!a){$.value=!0,Y.value="IA bloquee. Match termine.",ne.value=!0,R();return}ga(a)},e)},Ya=e=>{const{initialMs:a,incrementMs:l}=Be.value;let d=a,u=a;const g=L=>{if(!L)return null;const B=new Date(L).getTime();return Number.isFinite(B)?B:null};let be=g(e.startAt??e.createdAt)??z();for(const L of e.moves??[]){const B=g(L.createdAt);if(!B)continue;const Ae=Math.max(0,B-be);L.side==="white"?d=Math.max(0,d-Ae+l):u=Math.max(0,u-Ae+l),be=B}if(e.status==="started"){const L=Math.max(0,z()-be);e.sideToMove==="white"?d=Math.max(0,d-L):u=Math.max(0,u-L)}(!Number.isFinite(d)||!Number.isFinite(u))&&(d=a,u=a),e.status==="started"&&(!e.moves||e.moves.length===0)&&(d<=0||u<=0)&&(d=a,u=a),C.value=d,S.value=u,I.value=Date.now(),se.value=e.status!=="started",Fe(),e.status==="started"?ha():R()},Za=e=>{if(e.status!=="ready"||!e.startAt){H.value=0,he();return}const a=new Date(e.startAt).getTime();if(!Number.isFinite(a)){H.value=0,he();return}const l=()=>{const d=Math.ceil((a-z())/1e3);H.value=Math.max(0,d),H.value<=0&&he()};l(),ue||(ue=setInterval(l,250))},Se=()=>{if(!q)return;const e=q;q=null,e.close()},pe=()=>{te&&(te.close(),te=null)},Te=()=>{re&&(clearInterval(re),re=null)},ya=async(e=!1)=>{if(!(!s.value||xe)){xe=!0;try{const a=await Ia(s.value);x(a),f.value&&(f.value="")}catch(a){e||(f.value=a.message)}finally{xe=!1}}},et=async e=>{if(!(!e||e.matchId!==s.value)){if(e.type==="state"&&e.match){x(e.match),f.value&&(f.value="");return}if(e.type==="match-update"){await ya();return}e.type==="error"&&(f.value=e.message||"Erreur temps reel.")}},Ue=()=>{re||(re=setInterval(async()=>{await ya(!0)},3e3))},at=()=>{ce||!s.value||(ce=setInterval(async()=>{if(s.value)try{const e=await Ft(s.value);x(e)}catch{}},8e3))},Ve=()=>{s.value&&(pe(),te=Ut(s.value,e=>{x(e),f.value&&(f.value="")},()=>{f.value||(f.value="Connexion temps reel interrompue."),Ue()}),te||Ue())},tt=()=>{if(!s.value)return;Te(),pe(),Se();const e=Vt(s.value,a=>{et(a)},()=>{f.value||(f.value="Connexion temps reel interrompue."),Ve()});if(!e){Ve();return}q=e,e.addEventListener("close",()=>{q===e&&(q=null,f.value||(f.value="Connexion temps reel interrompue."),Ve())})},ba=async()=>{if(s.value){J.value=!0,f.value="",Te(),pe(),Se(),await xa();try{const e=await Ia(s.value);x(e),tt(),at()}catch(e){f.value=e.message,Ue()}finally{J.value=!1}}},lt=async()=>{if(!(!s.value||!v.value))try{const e=await Dt(s.value);x(e)}catch(e){f.value=e.message}},wa=(e,a)=>e?a==="white"?e===e.toUpperCase():e===e.toLowerCase():!1,ga=e=>{v.value||(Ga(),Qa(b.value),Fe()),K.value=Ta(K.value,e),W.value=[...W.value,{ply:W.value.length+1,side:b.value,notation:Sa(e)}],Z.value={from:e.from,to:e.to},A.value=null,b.value=b.value==="white"?"black":"white",I.value=Date.now(),!v.value&&M.value&&pa()},st=async e=>{if(s.value&&w.value==="started"){F.value=!0,f.value="",R();try{const a=await Pt(s.value,{from:e.from,to:e.to,notation:Sa(e)});x(a)}catch(a){f.value=a.message}finally{F.value=!1}}},nt=e=>{if(!e)return"";const a=new Date(e);return Number.isNaN(a.getTime())?"":a.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},ka=async()=>{if(!s.value||!v.value)return;const e=G.value.trim();if(e){Q.value=!0,le.value="";try{const a=await Rt(s.value,e);x(a),G.value="",await _a(),U.value&&(U.value.scrollTop=U.value.scrollHeight)}catch(a){le.value=a.message}finally{Q.value=!1}}},ot=async()=>{if(!na.value){V.value="Adversaire introuvable.",X.value=!0;return}V.value="",X.value=!1;try{const e=await At(na.value,me.value,"Aleatoire");V.value=e.message,X.value=!e.ok,e.ok&&e.status==="accepted"&&e.matchId&&(Nt(),await m.push(`/jeu/${e.matchId}`))}catch(e){V.value=e.message,X.value=!0}},je=async e=>{if(!(!s.value||!v.value)){P.value="",ke.value=!1;try{const a=await Bt(s.value,e);x(a),e==="draw"?P.value="Match nul enregistre.":e==="timeout"?P.value="Temps ecoule.":P.value="Match termine.",we({name:"finish_game",payload:{matchId:s.value,result:e}})}catch(a){P.value=a.message,ke.value=!0}}},rt=async()=>{if(!N.value){if(R(),v.value){await je("timeout");return}$.value=!0,Y.value="Temps ecoule. Match termine.",ne.value=!0,we({payload:{matchId:s.value||"local"}})}},it=(e,a)=>{if(!Ka.value)return;if(!A.value){if(!a||!wa(a,b.value))return;A.value=e;return}if(e===A.value){A.value=null;return}const l=ca.value.find(d=>d.to===e);if(!l){a&&wa(a,b.value)&&(A.value=e);return}if(v.value){st(l);return}ga(l)},ut=async()=>{if(v.value){if(N.value)return;await je("resign");return}we({payload:{matchId:s.value||"local"}}),await m.push("/dashboard")},ct=async()=>{if(v.value){if(N.value)return;await je("draw");return}we({payload:{matchId:s.value||"local"}}),await m.push("/dashboard")},vt=()=>{v.value||Ce()},dt=async()=>{await m.push("/dashboard")};He(()=>O.value.length,async()=>{await _a(),U.value&&(U.value.scrollTop=U.value.scrollHeight)}),bt(()=>{Se(),pe(),Te(),R(),De(),he(),fa()});const mt=o(()=>Da.flatMap((e,a)=>ua.map((l,d)=>{const u=K.value[a]?.[d]??"",g=`${l}${e}`,ye=(a+d)%2===1,be=u?u===u.toUpperCase()?"light":"dark":"",L=A.value===g,B=Ha.value.has(g),Ae=Z.value?.from===g||Z.value?.to===g,ft=Z.value?.to===g,ht=u?`${g} ${Va[u]??"piece"}`:`${g} vide`;return{id:g,piece:u,symbol:Ua[u]??"",image:u?xt(u):"",dark:ye,tone:be,isSelected:L,isTarget:B,isLast:Ae,isArrival:ft,ariaLabel:ht}})));return(e,a)=>(h(),wt(Tt,{eyebrow:"Partie",title:`Match ${s.value||"Libre"}`,subtitle:$a.value},{default:gt(()=>[t("section",jt,[t("div",Ht,[t("div",Kt,[t("div",Wt,[t("div",null,[a[1]||(a[1]=t("p",{class:"panel-title"},"Plateau",-1)),t("h3",zt,"Tour: "+i(b.value==="white"?"Blancs":"Noirs"),1)]),t("span",qt,i(_.value==="JcJ"?"En ligne":"Local"),1)]),la.value?(h(),p("p",Gt,i(la.value),1)):k("",!0),f.value?(h(),p("p",Qt,i(f.value),1)):k("",!0),Y.value?(h(),p("p",{key:2,class:E(["form-message",ne.value?"form-message--error":"form-message--success"])},i(Y.value),3)):k("",!0),t("div",Xt,[t("div",{class:E(["player-chip",b.value==="white"&&"player-chip--active"])},[t("div",Yt,i(ma(va.value)),1),t("div",Zt,[t("p",el,i(va.value),1),a[2]||(a[2]=t("p",{class:"player-meta"},"Blancs",-1))]),t("div",{class:E(["player-clock",ra(C.value)])},i(Ra.value),3)],2),a[4]||(a[4]=t("span",{class:"vs-pill"},"VS",-1)),t("div",{class:E(["player-chip",b.value==="black"&&"player-chip--active"])},[t("div",al,i(ma(da.value)),1),t("div",tl,[t("p",ll,i(da.value),1),a[3]||(a[3]=t("p",{class:"player-meta"},"Noirs",-1))]),t("div",{class:E(["player-clock",ra(S.value)])},i(Ba.value),3)],2)]),t("div",sl,[t("div",nl,[(h(!0),p(We,null,Ke(mt.value,l=>(h(),p("button",{key:l.id,type:"button",class:E(["square",l.dark?"square--dark":"square--light",l.isLast?"square--last":"",l.isArrival?"square--arrival":"",l.isSelected?"square--selected":"",l.isTarget?"square--target":""]),"aria-label":l.ariaLabel,"aria-pressed":l.isSelected,role:"gridcell",onClick:d=>it(l.id,l.piece)},[l.piece&&l.image?(h(),p("img",{key:0,src:l.image,alt:"","aria-hidden":"true",class:E(["piece","piece-img",l.tone==="light"?"piece--light":"piece--dark",l.isArrival?"piece--impact":""])},null,10,rl)):l.piece?(h(),p("span",{key:1,class:E(["piece",l.tone==="light"?"piece--light":"piece--dark",l.isArrival?"piece--impact":""])},i(l.symbol),3)):k("",!0)],10,ol))),128))])])]),t("div",il,[a[8]||(a[8]=t("div",null,[t("p",{class:"panel-title"},"Actions"),t("h3",{class:"panel-headline"},"Fin de match"),t("p",{class:"panel-sub"},"Gerez la partie en cours en un clic.")],-1)),v.value&&(w.value==="waiting"||w.value==="ready")?(h(),p("div",ul,[a[5]||(a[5]=t("p",{class:"panel-title"},"Synchronisation",-1)),t("p",cl,i(Re.value?"Presence confirmee.":"Confirmez votre presence pour lancer la partie."),1),t("button",{class:"button-primary",type:"button",disabled:Re.value||J.value,onClick:lt},i(Re.value?"Pret":"Je suis pret"),9,vl)])):k("",!0),t("button",{class:"button-ghost game-action",type:"button",disabled:N.value||v.value&&w.value!=="started",onClick:ut}," Abandonner ",8,dl),t("button",{class:"button-ghost game-action",type:"button",disabled:N.value||v.value&&w.value!=="started",onClick:ct}," Match Nul ",8,ml),t("button",{class:"button-ghost game-action",type:"button",disabled:v.value,onClick:vt}," Reinitialiser le match ",8,fl),P.value?(h(),p("p",{key:1,class:E(["form-message",ke.value?"form-message--error":"form-message--success"])},i(P.value),3)):k("",!0),v.value&&N.value?(h(),p("div",hl,[a[6]||(a[6]=t("p",{class:"panel-title"},"Revanche",-1)),a[7]||(a[7]=t("p",{class:"panel-sub"},"Proposez une nouvelle partie a votre adversaire.",-1)),t("div",{class:"game-rematch-actions"},[t("button",{class:"button-primary",type:"button",onClick:ot}," Proposer une revanche "),t("button",{class:"button-ghost",type:"button",onClick:dt}," Retour au tableau ")]),V.value?(h(),p("p",{key:0,class:E(["form-message",X.value?"form-message--error":"form-message--success"])},i(V.value),3)):k("",!0)])):k("",!0)])]),t("div",pl,[a[14]||(a[14]=t("div",{class:"panel-header"},[t("div",null,[t("p",{class:"panel-title"},"Commandes"),t("h3",{class:"panel-headline"},"Gestion du match")])],-1)),t("div",yl,[t("div",null,[t("p",bl,i(Ea.value),1),t("p",wl,i(T.value==="white"?"Blancs":"Noirs"),1)]),t("div",null,[t("p",gl,i(Oa.value),1),t("p",kl,i(Me.value),1)]),t("div",null,[a[9]||(a[9]=t("p",{class:"metric-label"},"Cadence",-1)),t("p",_l,i(me.value),1)]),M.value?(h(),p("div",Ml,[a[10]||(a[10]=t("p",{class:"metric-label"},"Difficulte",-1)),t("p",Cl,i(Wa.value),1)])):k("",!0),_.value==="Histoire"&&de.value?(h(),p("div",Sl,[a[11]||(a[11]=t("p",{class:"metric-label"},"Chapitre",-1)),t("p",Tl,"#"+i(de.value),1)])):k("",!0)]),t("div",Al,[a[12]||(a[12]=t("p",{class:"panel-title"},"Historique",-1)),t("div",Il,[W.value.length?k("",!0):(h(),p("div",Nl,"Aucun coup joue.")),(h(!0),p(We,null,Ke(W.value,l=>(h(),p("div",{key:l.ply,class:"move-item"},[t("span",Ll,"#"+i(l.ply),1),t("span",El,i(l.side==="white"?"Blancs":"Noirs"),1),t("span",Ol,i(l.notation),1)]))),128))])]),v.value?(h(),p("div",$l,[a[13]||(a[13]=t("p",{class:"panel-title"},"Chat",-1)),t("div",{ref_key:"chatListRef",ref:U,class:"chat-list"},[O.value.length?k("",!0):(h(),p("div",xl,"Aucun message.")),(h(!0),p(We,null,Ke(O.value,l=>(h(),p("div",{key:l.id,class:"chat-item"},[t("div",Jl,[t("span",Pl,i(l.userName),1),t("span",Rl,i(nt(l.createdAt)),1)]),t("p",Bl,i(l.message),1)]))),128))],512),t("div",Dl,[kt(t("input",{"onUpdate:modelValue":a[0]||(a[0]=l=>G.value=l),type:"text",placeholder:"Ecrire un message...","aria-label":"Message",disabled:Q.value||J.value,onKeydown:Mt(Ct(ka,["prevent"]),["enter"])},null,40,Fl),[[_t,G.value]]),t("button",{class:"button-primary",type:"button",disabled:Q.value||J.value||!G.value.trim(),onClick:ka},i(Q.value?"Envoi...":"Envoyer"),9,Ul)]),le.value?(h(),p("p",Vl,i(le.value),1)):k("",!0)])):k("",!0)])])]),_:1},8,["title","subtitle"]))}});export{Gl as default};
