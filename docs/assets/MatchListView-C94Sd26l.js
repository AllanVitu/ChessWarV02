import{d as nt,e as l,p as M,G as lt,f as it,h as ut,y as rt,s as ct,w as b,o as r,i as I,b as t,C as V,H as q,c,a as $,t as o,F as J,n as i,g as h,z as L,u as j,x as O}from"./vendor-vue-DHDwDR0M.js";import{_ as dt}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-Cqwo0E3b.js";import{_ as mt}from"./AppModal.vue_vue_type_script_setup_true_lang-CWrUK09g.js";import{f as P,d as vt,h as pt}from"./index-B8oaCmpa.js";import"./brand-icon-IDKxxvz3.js";const ft=async n=>{const u=await P("matchmake-join",{method:"POST",body:JSON.stringify(n)});if(!u.ok)throw new Error("Impossible de rejoindre la file.");return u.status==="matched"&&u.matchId?{status:"matched",matchId:u.matchId}:{status:"queued",mode:n.mode,timeControl:n.timeControl,side:n.side}},x=async()=>{const n=await P("matchmake-status");return n.ok?n.status==="matched"&&n.matchId?{status:"matched",matchId:n.matchId,matchStatus:n.matchStatus}:n.status==="queued"?{status:"queued",mode:n.mode??"ranked",timeControl:n.timeControl??"10+0",side:n.side??"Aleatoire",queuedAt:n.queuedAt}:{status:"idle"}:{status:"idle"}},bt=async()=>{await P("matchmake-leave",{method:"POST",body:JSON.stringify({})})},ht={class:"form-stack"},gt={class:"form-field"},yt=["value"],kt={class:"form-field"},Ct={class:"segmented"},_t={class:"form-field"},wt=["value"],At={class:"match-layout"},Mt={class:"panel match-create"},It={class:"panel-header"},$t={class:"panel-actions"},Jt={class:"badge-soft"},St={class:"mode-toggle"},Nt={key:0,class:"form-stack matchmake-form"},Tt={class:"form-field"},Bt={class:"segmented"},Ht={class:"form-field"},Vt={class:"segmented"},qt={class:"form-field"},Lt=["value"],jt={class:"panel-actions"},Ot={key:1,class:"panel-matchmaking"},Pt={class:"panel-sub"},Et={class:"panel match-list"},zt={class:"panel-header"},Dt={class:"panel-actions"},Ut=["disabled"],xt={class:"match-cards"},Ft={key:0,class:"empty-state"},Rt={class:"match-row"},Gt={class:"match-ident"},Kt={class:"match-avatar"},Qt={class:"match-id"},Wt={class:"match-opponent"},Xt={class:"match-meta"},Yt={class:"match-footer"},Zt={class:"match-move"},te={class:"match-actions"},ee=["onClick"],se=6,re=nt({__name:"MatchListView",setup(n){const u=l([]),g=l(""),w=l(!1),y=rt(),d=l("IA"),k=l(!1),S=l("intermediaire"),v=l("Aleatoire"),N=l("10+0"),C=l("ranked"),p=l("Aleatoire"),T=l("10+0"),m=l({status:"idle"}),f=l(""),A=l(!1);let _=null;const F=[{value:"facile",label:"Facile"},{value:"intermediaire",label:"Intermediaire"},{value:"difficile",label:"Difficile"},{value:"maitre",label:"Maitre"}],E=["5+0","10+0","15+10","20+0","30+0"],R={waiting:"En attente",ready:"Pret",started:"En cours",finished:"Termine",aborted:"Annule"},G=a=>{const e=a.trim();return e&&e.split(" ").filter(Boolean).slice(0,2).map(s=>s[0]?.toUpperCase()??"").join("")||"?"},K=a=>a==="waiting"||a==="ready"?"Ouvrir":a==="started"?"Reprendre":"Revoir",Q=a=>a==="IA"?"IA":a==="Histoire"?"Histoire":"JcJ",W=M(()=>u.value.length),z=M(()=>u.value.some(a=>a.status==="finished"||a.status==="aborted")),B=l(1),D=M(()=>u.value.slice(0,B.value*se)),X=M(()=>D.value.length<u.value.length);lt(u,()=>{B.value=1}),it(async()=>{u.value=await vt(),m.value=await x(),m.value.status==="queued"&&U()}),ut(()=>{H()});const H=()=>{_&&(clearInterval(_),_=null)},U=()=>{_||(_=setInterval(async()=>{await Y()},3e3))},Y=async()=>{const a=await x();m.value=a,a.status==="matched"&&a.matchId&&(H(),await y.push(`/jeu/${a.matchId}`))},Z=async()=>{if(g.value="",w.value=!1,!z.value){g.value="Aucun match termine a effacer.",w.value=!0;return}if(!window.confirm("Effacer l'historique des matchs termines ?"))return;const e=await pt("history");u.value=e.matches,g.value=e.message,w.value=!e.ok},tt=()=>{try{window.sessionStorage.setItem("warchess.play.access","1")}catch{}},et=async()=>{tt(),k.value=!1;const a=new URLSearchParams({allow:"1",mode:"ia",difficulty:S.value,side:v.value,time:N.value});await y.push(`/play?${a.toString()}`)},st=async()=>{if(d.value==="IA"){k.value=!0;return}if(d.value==="Histoire"){await y.push("/histoire");return}f.value="",A.value=!1;try{const a=await ft({mode:C.value,timeControl:T.value,side:p.value});if(m.value=a,a.status==="matched"&&a.matchId){await y.push(`/jeu/${a.matchId}`);return}f.value="Recherche en cours...",U()}catch(a){f.value=a.message,A.value=!0}},at=async()=>{await bt(),m.value={status:"idle"},f.value="File annulee.",A.value=!1,H()},ot=async a=>{await y.push(`/jeu/${a.id}`)};return(a,e)=>(r(),ct(dt,{eyebrow:"Matchs",title:"Centre des matchs",subtitle:"Creez, lancez et suivez vos parties en un seul endroit."},{default:b(()=>[I(mt,{modelValue:k.value,"onUpdate:modelValue":e[6]||(e[6]=s=>k.value=s),title:"Match IA"},{footer:b(()=>[t("button",{class:"button-ghost",type:"button",onClick:e[5]||(e[5]=s=>k.value=!1)},"Annuler"),t("button",{class:"button-primary",type:"button",onClick:et},"Lancer")]),default:b(()=>[t("div",ht,[t("label",gt,[e[17]||(e[17]=t("span",{class:"form-label"},"Difficulte",-1)),V(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>S.value=s),class:"form-input"},[(r(),c(J,null,$(F,s=>t("option",{key:s.value,value:s.value},o(s.label),9,yt)),64))],512),[[q,S.value]])]),t("div",kt,[e[18]||(e[18]=t("span",{class:"form-label"},"Couleur",-1)),t("div",Ct,[t("button",{class:i(["segmented-button",v.value==="Blancs"?"segmented-button--active":""]),type:"button",onClick:e[1]||(e[1]=s=>v.value="Blancs")}," Blancs ",2),t("button",{class:i(["segmented-button",v.value==="Noirs"?"segmented-button--active":""]),type:"button",onClick:e[2]||(e[2]=s=>v.value="Noirs")}," Noirs ",2),t("button",{class:i(["segmented-button",v.value==="Aleatoire"?"segmented-button--active":""]),type:"button",onClick:e[3]||(e[3]=s=>v.value="Aleatoire")}," Aleatoire ",2)])]),t("label",_t,[e[19]||(e[19]=t("span",{class:"form-label"},"Temps",-1)),V(t("select",{"onUpdate:modelValue":e[4]||(e[4]=s=>N.value=s),class:"form-input"},[(r(),c(J,null,$(E,s=>t("option",{key:s,value:s},o(s),9,wt)),64))],512),[[q,N.value]])])])]),_:1},8,["modelValue"]),t("section",At,[t("div",Mt,[t("div",It,[e[20]||(e[20]=t("div",null,[t("p",{class:"panel-title"},"Nouveau match"),t("h3",{class:"panel-headline"},"Configurer une partie")],-1)),t("div",$t,[t("span",Jt,o(W.value)+" matchs",1)])]),e[25]||(e[25]=t("p",{class:"panel-sub"}," Tous les nouveaux matchs se lancent depuis ici, puis basculent vers l'arene de jeu IA ou JcJ. ",-1)),t("div",St,[t("button",{class:i(["button-ghost mode-pill",d.value==="IA"?"mode-pill--active":""]),type:"button",onClick:e[7]||(e[7]=s=>d.value="IA")}," IA ",2),t("button",{class:i(["button-ghost mode-pill",d.value==="Histoire"?"mode-pill--active":""]),type:"button",onClick:e[8]||(e[8]=s=>d.value="Histoire")}," Histoire ",2),t("button",{class:i(["button-ghost mode-pill",d.value==="JcJ"?"mode-pill--active":""]),type:"button",onClick:e[9]||(e[9]=s=>d.value="JcJ")}," JcJ ",2)]),d.value==="JcJ"?(r(),c("div",Nt,[t("label",Tt,[e[21]||(e[21]=t("span",{class:"form-label"},"Type de match",-1)),t("div",Bt,[t("button",{class:i(["segmented-button",C.value==="ranked"?"segmented-button--active":""]),type:"button",onClick:e[10]||(e[10]=s=>C.value="ranked")}," Classe ",2),t("button",{class:i(["segmented-button",C.value==="friendly"?"segmented-button--active":""]),type:"button",onClick:e[11]||(e[11]=s=>C.value="friendly")}," Amical ",2)])]),t("div",Ht,[e[22]||(e[22]=t("span",{class:"form-label"},"Couleur",-1)),t("div",Vt,[t("button",{class:i(["segmented-button",p.value==="Blancs"?"segmented-button--active":""]),type:"button",onClick:e[12]||(e[12]=s=>p.value="Blancs")}," Blancs ",2),t("button",{class:i(["segmented-button",p.value==="Noirs"?"segmented-button--active":""]),type:"button",onClick:e[13]||(e[13]=s=>p.value="Noirs")}," Noirs ",2),t("button",{class:i(["segmented-button",p.value==="Aleatoire"?"segmented-button--active":""]),type:"button",onClick:e[14]||(e[14]=s=>p.value="Aleatoire")}," Aleatoire ",2)])]),t("label",qt,[e[23]||(e[23]=t("span",{class:"form-label"},"Temps",-1)),V(t("select",{"onUpdate:modelValue":e[15]||(e[15]=s=>T.value=s),class:"form-input"},[(r(),c(J,null,$(E,s=>t("option",{key:`pvp-${s}`,value:s},o(s),9,Lt)),64))],512),[[q,T.value]])])])):h("",!0),t("div",jt,[t("button",{class:"button-primary",type:"button",onClick:st},"Nouveau match"),I(j(O),{class:"button-ghost",to:"/amis"},{default:b(()=>[...e[24]||(e[24]=[L("Inviter un ami",-1)])]),_:1})]),d.value==="JcJ"&&m.value.status==="queued"?(r(),c("div",Ot,[t("p",Pt,"File en cours: "+o(m.value.mode)+" - "+o(m.value.timeControl),1),t("button",{class:"button-ghost",type:"button",onClick:at},"Annuler la file")])):h("",!0),f.value?(r(),c("p",{key:2,class:i(["form-message",A.value?"form-message--error":"form-message--success"])},o(f.value),3)):h("",!0)]),t("div",Et,[t("div",zt,[e[26]||(e[26]=t("div",null,[t("p",{class:"panel-title"},"Liste des matchs"),t("h3",{class:"panel-headline"},"Historique et en cours")],-1)),t("div",Dt,[t("button",{class:"button-ghost",type:"button",disabled:!z.value,onClick:Z}," Effacer l'historique ",8,Ut)])]),t("div",xt,[u.value.length?h("",!0):(r(),c("div",Ft,[e[28]||(e[28]=t("p",{class:"empty-state__title"},"Aucun match JcJ pour le moment.",-1)),e[29]||(e[29]=t("p",{class:"empty-state__subtitle"},"Invitez un ami pour commencer.",-1)),I(j(O),{class:"button-primary",to:"/amis"},{default:b(()=>[...e[27]||(e[27]=[L("Trouver un ami",-1)])]),_:1})])),(r(!0),c(J,null,$(D.value,s=>(r(),c("article",{key:s.id,class:"match-card"},[t("div",Rt,[t("div",Gt,[t("div",Kt,o(G(s.opponent)),1),t("div",null,[t("p",Qt,o(s.id),1),t("p",Wt,o(s.opponent),1)])]),t("span",{class:i(["match-status",`match-status--${s.status}`])},o(R[s.status]??"Inconnu"),3)]),t("div",Xt,[t("span",null,o(Q(s.mode)),1),t("span",null,"Cadence "+o(s.timeControl),1),t("span",null,o(s.side),1)]),t("div",Yt,[t("span",Zt,"Dernier coup: "+o(s.lastMove),1),t("div",te,[I(j(O),{class:"button-ghost",to:`/jeu/${s.id}`},{default:b(()=>[...e[30]||(e[30]=[L("Ouvrir",-1)])]),_:1},8,["to"]),t("button",{class:"button-primary",type:"button",onClick:ae=>ot(s)},o(K(s.status)),9,ee)])])]))),128)),X.value?(r(),c("button",{key:1,class:"button-ghost",type:"button",onClick:e[16]||(e[16]=s=>B.value+=1)}," Afficher plus ")):h("",!0)]),g.value?(r(),c("p",{key:0,class:i(["form-message",w.value?"form-message--error":"form-message--success"]),role:"status"},o(g.value),3)):h("",!0)])])]),_:1}))}});export{re as default};
