import{d as ie,e as n,p as J,G as ue,f as re,h as ce,y as de,s as me,w as f,o as r,i as w,b as e,C as S,H as N,c,a as A,t as l,F as M,n as i,g as h,z as q,u as T,x as B}from"./vendor-vue-DHDwDR0M.js";import{_ as ve}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-CAFU19Jj.js";import{_ as pe}from"./AppModal.vue_vue_type_script_setup_true_lang-CWrUK09g.js";import{f as j,d as fe,h as be}from"./index-D5r2B9WW.js";import"./brand-icon-IDKxxvz3.js";const he=async o=>{const u=await j("matchmake-join",{method:"POST",body:JSON.stringify(o)});if(!u.ok)throw new Error("Impossible de rejoindre la file.");return u.status==="matched"&&u.matchId?{status:"matched",matchId:u.matchId}:{status:"queued",mode:o.mode,timeControl:o.timeControl,side:o.side}},F=async()=>{const o=await j("matchmake-status");return o.ok?o.status==="matched"&&o.matchId?{status:"matched",matchId:o.matchId,matchStatus:o.matchStatus}:o.status==="queued"?{status:"queued",mode:o.mode??"ranked",timeControl:o.timeControl??"10+0",side:o.side??"Aleatoire",queuedAt:o.queuedAt}:{status:"idle"}:{status:"idle"}},ge=async()=>{await j("matchmake-leave",{method:"POST",body:JSON.stringify({})})},ye={class:"form-stack"},ke={class:"form-field"},Ce=["value"],_e={class:"form-field"},we=["value"],Ae={class:"form-field"},Me={class:"segmented"},Ie={class:"form-field"},$e=["value"],Je={class:"match-layout"},Se={class:"panel match-create"},Ne={class:"panel-header"},qe={class:"panel-actions"},Te={class:"badge-soft"},Be={class:"mode-toggle"},Pe={key:0,class:"form-stack matchmake-form"},Ve={class:"form-field"},He={class:"segmented"},Ee={class:"form-field"},Le={class:"segmented"},Oe={class:"form-field"},je=["value"],Ue={class:"panel-actions"},ze={key:1,class:"panel-matchmaking"},De={class:"panel-sub"},xe={class:"panel match-list"},Fe={class:"panel-header"},Re={class:"panel-actions"},Ge=["disabled"],Ke={class:"match-cards"},Qe={key:0,class:"empty-state"},We={class:"match-row"},Xe={class:"match-ident"},Ye={class:"match-avatar"},Ze={class:"match-id"},et={class:"match-opponent"},tt={class:"match-meta"},st={class:"match-footer"},at={class:"match-move"},lt={class:"match-actions"},ot=["onClick"],nt=6,vt=ie({__name:"MatchListView",setup(o){const u=n([]),g=n(""),I=n(!1),y=de(),d=n("IA"),k=n(!1),P=n("intermediaire"),V=n("equilibre"),v=n("Aleatoire"),H=n("10+0"),C=n("ranked"),p=n("Aleatoire"),E=n("10+0"),m=n({status:"idle"}),b=n(""),$=n(!1);let _=null;const R=[{value:"facile",label:"Facile"},{value:"intermediaire",label:"Intermediaire"},{value:"difficile",label:"Difficile"},{value:"maitre",label:"Maitre"}],G=[{value:"equilibre",label:"Equilibre"},{value:"agressif",label:"Agressif"},{value:"solide",label:"Solide"},{value:"fou",label:"Chaos"}],U=["5+0","10+0","15+10","20+0","30+0"],K={waiting:"En attente",ready:"Pret",started:"En cours",finished:"Termine",aborted:"Annule"},Q=a=>{const t=a.trim();return t&&t.split(" ").filter(Boolean).slice(0,2).map(s=>s[0]?.toUpperCase()??"").join("")||"?"},W=a=>a==="waiting"||a==="ready"?"Ouvrir":a==="started"?"Reprendre":"Revoir",X=a=>a==="IA"?"IA":a==="Histoire"?"Histoire":"JcJ",Y=J(()=>u.value.length),z=J(()=>u.value.some(a=>a.status==="finished"||a.status==="aborted")),L=n(1),D=J(()=>u.value.slice(0,L.value*nt)),Z=J(()=>D.value.length<u.value.length);ue(u,()=>{L.value=1}),re(async()=>{u.value=await fe(),m.value=await F(),m.value.status==="queued"&&x()}),ce(()=>{O()});const O=()=>{_&&(clearInterval(_),_=null)},x=()=>{_||(_=setInterval(async()=>{await ee()},3e3))},ee=async()=>{const a=await F();m.value=a,a.status==="matched"&&a.matchId&&(O(),await y.push(`/jeu/${a.matchId}`))},te=async()=>{if(g.value="",I.value=!1,!z.value){g.value="Aucun match termine a effacer.",I.value=!0;return}if(!window.confirm("Effacer l'historique des matchs termines ?"))return;const t=await be("history");u.value=t.matches,g.value=t.message,I.value=!t.ok},se=()=>{try{window.sessionStorage.setItem("warchess.play.access","1")}catch{}},ae=async()=>{se(),k.value=!1;const a=new URLSearchParams({allow:"1",mode:"ia",difficulty:P.value,persona:V.value,side:v.value,time:H.value});await y.push(`/play?${a.toString()}`)},le=async()=>{if(d.value==="IA"){k.value=!0;return}if(d.value==="Histoire"){await y.push("/histoire");return}b.value="",$.value=!1;try{const a=await he({mode:C.value,timeControl:E.value,side:p.value});if(m.value=a,a.status==="matched"&&a.matchId){await y.push(`/jeu/${a.matchId}`);return}b.value="Recherche en cours...",x()}catch(a){b.value=a.message,$.value=!0}},oe=async()=>{await ge(),m.value={status:"idle"},b.value="File annulee.",$.value=!1,O()},ne=async a=>{await y.push(`/jeu/${a.id}`)};return(a,t)=>(r(),me(ve,{eyebrow:"Matchs",title:"Centre des matchs",subtitle:"Creez, lancez et suivez vos parties en un seul endroit."},{default:f(()=>[w(pe,{modelValue:k.value,"onUpdate:modelValue":t[7]||(t[7]=s=>k.value=s),title:"Match IA"},{footer:f(()=>[e("button",{class:"button-ghost",type:"button",onClick:t[6]||(t[6]=s=>k.value=!1)},"Annuler"),e("button",{class:"button-primary",type:"button",onClick:ae},"Lancer")]),default:f(()=>[e("div",ye,[e("label",ke,[t[18]||(t[18]=e("span",{class:"form-label"},"Difficulte",-1)),S(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>P.value=s),class:"form-input"},[(r(),c(M,null,A(R,s=>e("option",{key:s.value,value:s.value},l(s.label),9,Ce)),64))],512),[[N,P.value]])]),e("label",_e,[t[19]||(t[19]=e("span",{class:"form-label"},"Personnalite",-1)),S(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>V.value=s),class:"form-input"},[(r(),c(M,null,A(G,s=>e("option",{key:s.value,value:s.value},l(s.label),9,we)),64))],512),[[N,V.value]])]),e("div",Ae,[t[20]||(t[20]=e("span",{class:"form-label"},"Couleur",-1)),e("div",Me,[e("button",{class:i(["segmented-button",v.value==="Blancs"?"segmented-button--active":""]),type:"button",onClick:t[2]||(t[2]=s=>v.value="Blancs")}," Blancs ",2),e("button",{class:i(["segmented-button",v.value==="Noirs"?"segmented-button--active":""]),type:"button",onClick:t[3]||(t[3]=s=>v.value="Noirs")}," Noirs ",2),e("button",{class:i(["segmented-button",v.value==="Aleatoire"?"segmented-button--active":""]),type:"button",onClick:t[4]||(t[4]=s=>v.value="Aleatoire")}," Aleatoire ",2)])]),e("label",Ie,[t[21]||(t[21]=e("span",{class:"form-label"},"Temps",-1)),S(e("select",{"onUpdate:modelValue":t[5]||(t[5]=s=>H.value=s),class:"form-input"},[(r(),c(M,null,A(U,s=>e("option",{key:s,value:s},l(s),9,$e)),64))],512),[[N,H.value]])])])]),_:1},8,["modelValue"]),e("section",Je,[e("div",Se,[e("div",Ne,[t[22]||(t[22]=e("div",null,[e("p",{class:"panel-title"},"Nouveau match"),e("h3",{class:"panel-headline"},"Configurer une partie")],-1)),e("div",qe,[e("span",Te,l(Y.value)+" matchs",1)])]),t[28]||(t[28]=e("p",{class:"panel-sub"}," Tous les nouveaux matchs se lancent depuis ici, puis basculent vers l'arene de jeu IA ou JcJ. ",-1)),e("div",Be,[e("button",{class:i(["button-ghost mode-pill",d.value==="IA"?"mode-pill--active":""]),type:"button",onClick:t[8]||(t[8]=s=>d.value="IA")}," IA ",2),e("button",{class:i(["button-ghost mode-pill",d.value==="Histoire"?"mode-pill--active":""]),type:"button",onClick:t[9]||(t[9]=s=>d.value="Histoire")}," Histoire ",2),e("button",{class:i(["button-ghost mode-pill",d.value==="JcJ"?"mode-pill--active":""]),type:"button",onClick:t[10]||(t[10]=s=>d.value="JcJ")}," JcJ ",2)]),d.value==="JcJ"?(r(),c("div",Pe,[e("label",Ve,[t[23]||(t[23]=e("span",{class:"form-label"},"Type de match",-1)),e("div",He,[e("button",{class:i(["segmented-button",C.value==="ranked"?"segmented-button--active":""]),type:"button",onClick:t[11]||(t[11]=s=>C.value="ranked")}," Classe ",2),e("button",{class:i(["segmented-button",C.value==="friendly"?"segmented-button--active":""]),type:"button",onClick:t[12]||(t[12]=s=>C.value="friendly")}," Amical ",2)])]),e("div",Ee,[t[24]||(t[24]=e("span",{class:"form-label"},"Couleur",-1)),e("div",Le,[e("button",{class:i(["segmented-button",p.value==="Blancs"?"segmented-button--active":""]),type:"button",onClick:t[13]||(t[13]=s=>p.value="Blancs")}," Blancs ",2),e("button",{class:i(["segmented-button",p.value==="Noirs"?"segmented-button--active":""]),type:"button",onClick:t[14]||(t[14]=s=>p.value="Noirs")}," Noirs ",2),e("button",{class:i(["segmented-button",p.value==="Aleatoire"?"segmented-button--active":""]),type:"button",onClick:t[15]||(t[15]=s=>p.value="Aleatoire")}," Aleatoire ",2)])]),e("label",Oe,[t[25]||(t[25]=e("span",{class:"form-label"},"Temps",-1)),S(e("select",{"onUpdate:modelValue":t[16]||(t[16]=s=>E.value=s),class:"form-input"},[(r(),c(M,null,A(U,s=>e("option",{key:`pvp-${s}`,value:s},l(s),9,je)),64))],512),[[N,E.value]])])])):h("",!0),e("div",Ue,[e("button",{class:"button-primary",type:"button",onClick:le},"Nouveau match"),w(T(B),{class:"button-ghost",to:"/entrainement"},{default:f(()=>[...t[26]||(t[26]=[q("Entrainement",-1)])]),_:1}),w(T(B),{class:"button-ghost",to:"/amis"},{default:f(()=>[...t[27]||(t[27]=[q("Inviter un ami",-1)])]),_:1})]),d.value==="JcJ"&&m.value.status==="queued"?(r(),c("div",ze,[e("p",De,"File en cours: "+l(m.value.mode)+" - "+l(m.value.timeControl),1),e("button",{class:"button-ghost",type:"button",onClick:oe},"Annuler la file")])):h("",!0),b.value?(r(),c("p",{key:2,class:i(["form-message",$.value?"form-message--error":"form-message--success"])},l(b.value),3)):h("",!0)]),e("div",xe,[e("div",Fe,[t[29]||(t[29]=e("div",null,[e("p",{class:"panel-title"},"Liste des matchs"),e("h3",{class:"panel-headline"},"Historique et en cours")],-1)),e("div",Re,[e("button",{class:"button-ghost",type:"button",disabled:!z.value,onClick:te}," Effacer l'historique ",8,Ge)])]),e("div",Ke,[u.value.length?h("",!0):(r(),c("div",Qe,[t[31]||(t[31]=e("p",{class:"empty-state__title"},"Aucun match JcJ pour le moment.",-1)),t[32]||(t[32]=e("p",{class:"empty-state__subtitle"},"Invitez un ami pour commencer.",-1)),w(T(B),{class:"button-primary",to:"/amis"},{default:f(()=>[...t[30]||(t[30]=[q("Trouver un ami",-1)])]),_:1})])),(r(!0),c(M,null,A(D.value,s=>(r(),c("article",{key:s.id,class:"match-card"},[e("div",We,[e("div",Xe,[e("div",Ye,l(Q(s.opponent)),1),e("div",null,[e("p",Ze,l(s.id),1),e("p",et,l(s.opponent),1)])]),e("span",{class:i(["match-status",`match-status--${s.status}`])},l(K[s.status]??"Inconnu"),3)]),e("div",tt,[e("span",null,l(X(s.mode)),1),e("span",null,"Cadence "+l(s.timeControl),1),e("span",null,l(s.side),1)]),e("div",st,[e("span",at,"Dernier coup: "+l(s.lastMove),1),e("div",lt,[w(T(B),{class:"button-ghost",to:`/jeu/${s.id}`},{default:f(()=>[...t[33]||(t[33]=[q("Ouvrir",-1)])]),_:1},8,["to"]),e("button",{class:"button-primary",type:"button",onClick:it=>ne(s)},l(W(s.status)),9,ot)])])]))),128)),Z.value?(r(),c("button",{key:1,class:"button-ghost",type:"button",onClick:t[17]||(t[17]=s=>L.value+=1)}," Afficher plus ")):h("",!0)]),g.value?(r(),c("p",{key:0,class:i(["form-message",I.value?"form-message--error":"form-message--success"]),role:"status"},l(g.value),3)):h("",!0)])])]),_:1}))}});export{vt as default};
