import{d as F,e as d,r as N,p as E,f as O,G,s as I,w as b,o as m,b as s,c as f,g as z,B,C as n,D as i,t as g,n as R,i as V,z as S,u as k,x as C}from"./vendor-vue-DHDwDR0M.js";import{_ as J}from"./DashboardLayout.vue_vue_type_script_setup_true_lang-wVOHqvGg.js";import{g as $,b as y,q as H,u as K,a as T,v as Q,i as _}from"./index-DneDkzAD.js";import"./brand-icon-IDKxxvz3.js";const W={class:"profile-grid"},X={class:"panel profile-card"},Y={class:"form-field"},Z={class:"form-field"},ee={class:"form-field"},se={class:"form-field"},te={class:"form-field"},ae={class:"avatar-field"},le={class:"avatar-preview"},oe=["src"],re={key:1},ne={class:"avatar-controls"},ie={class:"form-field"},ue=["value"],pe={key:1,class:"form-message form-message--success",role:"status"},de={class:"panel profile-card"},me={class:"form-field"},fe={class:"form-field"},ve={class:"form-field"},ce={class:"panel profile-card"},be={class:"card-actions"},Ve=F({__name:"ProfileView",setup(ge){const u=d(null),t=N({name:"",title:"",motto:"",location:"",avatarUrl:""}),w=d(""),M=d(!1),v=d("");let U=null,x="",P=!1;const q=E(()=>u.value?.profile.email??""),A=E(()=>{const l=t.name.trim();return l&&l.split(" ").filter(Boolean).slice(0,2).map(a=>a[0]?.toUpperCase()??"").join("")||"?"}),o=N({current:"",next:"",confirm:""}),r=d(""),p=d(!1);O(async()=>{const l=await $();u.value=l,t.name=l.profile.name,t.title=l.profile.title,t.motto=l.profile.motto,t.location=l.profile.location,t.avatarUrl=l.profile.avatarUrl,x=JSON.stringify(t),P=!0});const L=l=>{const a=l.target?.files?.[0];if(!a)return;const c=new FileReader;c.onload=()=>{typeof c.result=="string"&&(t.avatarUrl=c.result)},c.readAsDataURL(a)},D=async(l=!1)=>{if(!u.value)return;u.value.profile={...u.value.profile,...t},u.value=await Q(u.value);const e=_()?"Profil en attente de synchronisation.":"Profil mis a jour.";M.value=!1,l||(w.value=e,T("Profil",e))},h=async l=>{l?.preventDefault(),await D(!1)};G(t,()=>{if(!P)return;const l=JSON.stringify(t);l!==x&&(x=l,v.value="Sauvegarde automatique...",U&&clearTimeout(U),U=setTimeout(()=>{D(!0).finally(()=>{v.value=_()?"Sauvegarde en attente de connexion.":"Sauvegarde automatique terminee."})},800))},{deep:!0});const j=async()=>{if(r.value="",p.value=!1,!o.current||!o.next){r.value="Veuillez remplir tous les champs.",p.value=!0,y("Mot de passe",r.value);return}if(o.next!==o.confirm){r.value="Les mots de passe ne correspondent pas.",p.value=!0,y("Mot de passe",r.value);return}if(!await H()){r.value="Veuillez vous connecter pour modifier le mot de passe.",p.value=!0,y("Mot de passe",r.value);return}const e=await K(o.current,o.next);r.value=e.message,p.value=!e.ok,e.ok?(o.current="",o.next="",o.confirm="",T("Mot de passe",r.value)):y("Mot de passe",r.value)};return(l,e)=>(m(),I(J,{eyebrow:"Profil",title:"Parametres du compte",subtitle:"Gerez vos informations et la securite du compte."},{default:b(()=>[s("section",W,[s("div",X,[e[16]||(e[16]=s("div",{class:"panel-header"},[s("div",null,[s("p",{class:"panel-title"},"Profil public"),s("h3",{class:"panel-headline"},"Identite et preferences")])],-1)),s("form",{class:"form-stack",onSubmit:B(h,["prevent"])},[s("label",Y,[e[9]||(e[9]=s("span",{class:"form-label"},"Nom",-1)),n(s("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>t.name=a),class:"form-input",type:"text"},null,512),[[i,t.name]])]),s("label",Z,[e[10]||(e[10]=s("span",{class:"form-label"},"Titre",-1)),n(s("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>t.title=a),class:"form-input",type:"text"},null,512),[[i,t.title]])]),s("label",ee,[e[11]||(e[11]=s("span",{class:"form-label"},"Devise",-1)),n(s("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>t.motto=a),class:"form-input",type:"text"},null,512),[[i,t.motto]])]),s("label",se,[e[12]||(e[12]=s("span",{class:"form-label"},"Localisation",-1)),n(s("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>t.location=a),class:"form-input",type:"text"},null,512),[[i,t.location]])]),s("div",te,[e[13]||(e[13]=s("span",{class:"form-label"},"Avatar",-1)),s("div",ae,[s("div",le,[t.avatarUrl?(m(),f("img",{key:0,src:t.avatarUrl,alt:"Avatar profil",width:"72",height:"72",loading:"lazy",decoding:"async"},null,8,oe)):(m(),f("span",re,g(A.value),1))]),s("div",ne,[n(s("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>t.avatarUrl=a),class:"form-input",type:"url",placeholder:"https://"},null,512),[[i,t.avatarUrl]]),s("input",{class:"form-input avatar-file",type:"file",accept:"image/*",onChange:L},null,32),s("button",{class:"button-ghost",type:"button",onClick:e[5]||(e[5]=a=>t.avatarUrl="")}," Retirer l'avatar ")])])]),s("label",ie,[e[14]||(e[14]=s("span",{class:"form-label"},"Email",-1)),s("input",{class:"form-input",type:"email",value:q.value,disabled:""},null,8,ue)]),e[15]||(e[15]=s("button",{class:"button-primary",type:"submit"},"Enregistrer",-1))],32),w.value?(m(),f("p",{key:0,class:R(["form-message",M.value?"form-message--error":"form-message--success"]),role:"status"},g(w.value),3)):v.value?(m(),f("p",pe,g(v.value),1)):z("",!0)]),s("div",de,[e[21]||(e[21]=s("div",{class:"panel-header"},[s("div",null,[s("p",{class:"panel-title"},"Securite"),s("h3",{class:"panel-headline"},"Changer le mot de passe")])],-1)),s("form",{class:"form-stack",onSubmit:B(j,["prevent"])},[s("label",me,[e[17]||(e[17]=s("span",{class:"form-label"},"Mot de passe actuel",-1)),n(s("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>o.current=a),class:"form-input",type:"password",autocomplete:"current-password"},null,512),[[i,o.current]])]),s("label",fe,[e[18]||(e[18]=s("span",{class:"form-label"},"Nouveau mot de passe",-1)),n(s("input",{"onUpdate:modelValue":e[7]||(e[7]=a=>o.next=a),class:"form-input",type:"password",autocomplete:"new-password"},null,512),[[i,o.next]])]),s("label",ve,[e[19]||(e[19]=s("span",{class:"form-label"},"Confirmer",-1)),n(s("input",{"onUpdate:modelValue":e[8]||(e[8]=a=>o.confirm=a),class:"form-input",type:"password",autocomplete:"new-password"},null,512),[[i,o.confirm]])]),e[20]||(e[20]=s("button",{class:"button-primary",type:"submit"},"Mettre a jour",-1))],32),r.value?(m(),f("p",{key:0,class:R(["form-message",p.value?"form-message--error":"form-message--success"]),role:"status"},g(r.value),3)):z("",!0)]),s("div",ce,[e[25]||(e[25]=s("div",{class:"panel-header"},[s("div",null,[s("p",{class:"panel-title"},"Navigation"),s("h3",{class:"panel-headline"},"Raccourcis utiles")])],-1)),s("div",be,[V(k(C),{class:"button-primary",to:"/matchs"},{default:b(()=>[...e[22]||(e[22]=[S("Voir historique",-1)])]),_:1}),V(k(C),{class:"button-ghost",to:"/leaderboard"},{default:b(()=>[...e[23]||(e[23]=[S("Classement",-1)])]),_:1}),V(k(C),{class:"button-ghost",to:"/settings"},{default:b(()=>[...e[24]||(e[24]=[S("Parametres",-1)])]),_:1})])])])]),_:1}))}});export{Ve as default};
