const P=["a","b","c","d","e","f","g","h"],M={p:1,n:3,b:3,r:5,q:9,k:0},S=()=>[["r","n","b","q","k","b","n","r"],["p","p","p","p","p","p","p","p"],["","","","","","","",""],["","","","","","","",""],["","","","","","","",""],["","","","","","","",""],["P","P","P","P","P","P","P","P"],["R","N","B","Q","K","B","N","R"]],B=e=>e!==""&&e===e.toUpperCase(),m=e=>B(e)?"white":"black",v=(e,o)=>e>=0&&e<8&&o>=0&&o<8,w=(e,o)=>`${P[o]??""}${8-e}`,C=e=>{const o=e[0]??"",t=Number(e[1]),n=P.indexOf(o);return{row:8-t,col:n===-1?0:n}},d=(e,o,t)=>e[o]?.[t]??"",L=e=>{let o=0;for(const t of e)for(const n of t){if(!n)continue;const s=M[n.toLowerCase()]??0;o+=B(n)?s:-s}return o},R=(e,o)=>{const t=L(e);return o==="white"?t:-t},g=(e,o,t,n,s,r,i)=>{e.push({from:w(o,t),to:w(n,s),piece:r,capture:i})},k=(e,o,t)=>{const n=d(e,o,t);if(!n)return[];const s=m(n),r=[],i=n.toLowerCase();if(i==="p"){const u=s==="white"?-1:1,h=s==="white"?6:1,a=o+u;if(v(a,t)&&d(e,a,t)===""){g(r,o,t,a,t,n);const c=o+u*2;o===h&&d(e,c,t)===""&&g(r,o,t,c,t,n)}for(const c of[t-1,t+1]){if(!v(a,c))continue;const f=d(e,a,c);f&&m(f)!==s&&g(r,o,t,a,c,n,f)}return r}if(i==="n"){const u=[[-2,-1],[-2,1],[-1,-2],[-1,2],[1,-2],[1,2],[2,-1],[2,1]];for(const[h,a]of u){const c=o+h,f=t+a;if(!v(c,f))continue;const l=d(e,c,f);(!l||m(l)!==s)&&g(r,o,t,c,f,n,l||void 0)}return r}const p=u=>{for(const[h,a]of u){let c=o+h,f=t+a;for(;v(c,f);){const l=d(e,c,f);if(!l)g(r,o,t,c,f,n);else{m(l)!==s&&g(r,o,t,c,f,n,l);break}c+=h,f+=a}}};if(i==="b")return p([[-1,-1],[-1,1],[1,-1],[1,1]]),r;if(i==="r")return p([[-1,0],[1,0],[0,-1],[0,1]]),r;if(i==="q")return p([[-1,-1],[-1,1],[1,-1],[1,1],[-1,0],[1,0],[0,-1],[0,1]]),r;if(i==="k"){const u=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];for(const[h,a]of u){const c=o+h,f=t+a;if(!v(c,f))continue;const l=d(e,c,f);(!l||m(l)!==s)&&g(r,o,t,c,f,n,l||void 0)}}return r},q=(e,o)=>{const t=[];for(let n=0;n<8;n+=1)for(let s=0;s<8;s+=1){const r=d(e,n,s);r&&m(r)===o&&t.push(...k(e,n,s))}return t},x=(e,o)=>{const t=e.map(u=>u.slice()),n=C(o.from),s=C(o.to),r=o.piece,i=t[n.row],p=t[s.row];return!i||!p||(i[n.col]="",p[s.col]=r,r.toLowerCase()==="p"&&(s.row===0||s.row===7)&&(p[s.col]=r===r.toUpperCase()?"Q":"q")),t},$=e=>`${e.from}-${e.to}`,F=(e,o,t)=>{const n=q(e,o);if(!n.length)return null;if(t==="facile")return n[Math.floor(Math.random()*n.length)]??null;if(t==="intermediaire"){const i=n.filter(u=>u.capture);return i.length?[...i].sort((u,h)=>{const a=M[u.capture?.toLowerCase()||"p"]??0;return(M[h.capture?.toLowerCase()||"p"]??0)-a})[0]??null:n[Math.floor(Math.random()*n.length)]??null}const s=n.map(i=>{const p=x(e,i),u=R(p,o);return{move:i,score:u}});if(s.sort((i,p)=>p.score-i.score),t==="difficile")return s[0]?.move??null;const r=s.slice(0,3);return r[Math.floor(Math.random()*r.length)]?.move??null};export{x as a,F as b,S as c,$ as f,q as g};
