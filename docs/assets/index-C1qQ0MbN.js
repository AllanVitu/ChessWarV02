const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./IntroView-CRD3HILC.js","./vendor-vue-DHDwDR0M.js","./brand-icon-IDKxxvz3.js","./LoginView-Bdl3cLa6.js","./RegisterView-BICOFQOK.js","./ForgotPasswordView-d5IAc1x2.js","./HomeView-0y7KK7pI.js","./DashboardLayout.vue_vue_type_script_setup_true_lang-DWqoZ-Ld.js","./AppModal.vue_vue_type_script_setup_true_lang-CWrUK09g.js","./leaderboard-D_qe9d24.js","./stats-DDjpa0W3.js","./story-NDRLUkJb.js","./pieceAssets-DL4XSxcU.js","./MatchListView-BxgWIlwj.js","./StoryView-DScWYjN4.js","./StoryChapterView-DHLqJqd8.js","./GameView-C7itmr7d.js","./engine-CbTNbDBF.js","./LeaderboardView-KBeKPJ5Z.js","./ProfileView-eKiHRGbf.js","./ProfileAnalysisView-D8Eb4BLr.js","./ProfileAnalysisView-DEAApM8f.css","./UserProfileView-7gxDuIg0.js","./FriendsView-DuikGx2p.js","./SettingsView-CELetVTt.js","./HelpView-Dh8kUIO3.js","./PerfView-CRiFmo-E.js","./NotFoundView-Dm9vzTRS.js"])))=>i.map(i=>d[i]);
import{r as xe,d as ae,c as O,F as Me,a as Ke,u as N,o as P,n as Qe,b as c,t as J,e as te,f as Ne,g as ze,h as Ye,i as K,R as Xe,j as Ze,k as et,l as tt,m as rt}from"./vendor-vue-DHDwDR0M.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function r(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(n){if(n.ep)return;n.ep=!0;const s=r(n);fetch(n.href,s)}})();const A=xe({items:[]});let ot=0;const nt=()=>A,ie=(e,t=3600)=>{const r=ot+=1;A.items=[...A.items,{...e,id:r}],setTimeout(()=>{A.items=A.items.filter(o=>o.id!==r)},t)},st=e=>{A.items=A.items.filter(t=>t.id!==e)},Pr=(e,t)=>{ie({title:e,message:t,tone:"success"})},Lr=(e,t)=>{ie({title:e,message:t,tone:"error"})},Ir=(e,t)=>{ie({title:e,message:t,tone:"info"})},at={class:"toast-stack toast-stack--global","aria-live":"polite","aria-atomic":"true"},it={class:"toast-main"},ct={class:"toast-title"},lt={class:"toast-sub"},ut=["onClick"],dt=ae({__name:"AppToasts",setup(e){const t=nt();return(r,o)=>(P(),O("div",at,[(P(!0),O(Me,null,Ke(N(t).items,n=>(P(),O("div",{key:n.id,class:Qe(["toast-card",`toast-card--${n.tone}`]),role:"status"},[c("div",it,[c("p",ct,J(n.title),1),c("p",lt,J(n.message),1)]),c("button",{class:"toast-close",type:"button","aria-label":"Fermer",onClick:s=>N(st)(n.id)}," x ",8,ut)],2))),128))]))}}),ft="warchess.analytics.consent",ce=()=>typeof window<"u",Ae=e=>{if(ce())try{window.localStorage.setItem(ft,e?"1":"0")}catch{}},mt=()=>(ce(),!1),pt=e=>{},Oe=e=>{},ht=e=>{ce()&&(e&&e.afterEach(t=>{pt({payload:{path:t.fullPath}})}),window.addEventListener("error",t=>{Oe({message:t.message||"Erreur inconnue",stack:t.error?.stack,context:{source:t.filename,line:t.lineno,column:t.colno}})}),window.addEventListener("unhandledrejection",t=>{const r=t.reason;Oe({message:r?.message??"Promise rejetee",stack:r?.stack})}))},gt={key:0,class:"cookie-banner",role:"dialog","aria-live":"polite","aria-label":"Consentement"},yt=ae({__name:"CookieBanner",setup(e){const t=te(!1);Ne(()=>{t.value=mt()});const r=()=>{Ae(!0),t.value=!1},o=()=>{Ae(!1),t.value=!1};return(n,s)=>t.value?(P(),O("div",gt,[s[0]||(s[0]=c("div",{class:"cookie-banner__content"},[c("p",{class:"cookie-banner__title"},"Respect de votre vie privee"),c("p",{class:"cookie-banner__text"}," Nous utilisons des mesures anonymes pour ameliorer WarChess. Vous pouvez refuser a tout moment. ")],-1)),c("div",{class:"cookie-banner__actions"},[c("button",{class:"button-ghost",type:"button",onClick:o},"Refuser"),c("button",{class:"button-primary",type:"button",onClick:r},"Accepter")])])):ze("",!0)}}),wt="/api",re="warchess.session.token",vt=8e3,_t=12e3,Et=400,bt="",St="auth:expired",Q=new Map,Y=new Map,b=()=>typeof window>"u"||typeof localStorage>"u"?null:localStorage.getItem(re),le=e=>{if(!(typeof window>"u"||typeof localStorage>"u")){if(!e){localStorage.removeItem(re);return}localStorage.setItem(re,e)}},Pe=e=>new Promise(t=>setTimeout(t,e)),Tt=e=>e>=500||e===429,kt=e=>e instanceof Error?e.name==="AbortError"||/Network/i.test(e.message):!1,At=e=>{typeof window>"u"||window.dispatchEvent(new CustomEvent(St,{detail:{status:e}}))},Ot=async()=>null,p=async(e,t={})=>{const{timeoutMs:r,retries:o,retryDelayMs:n,cacheKey:s,cacheTtlMs:a,dedupe:i,retryAuth:I,...d}=t,u=new Headers(d.headers),f=(d.method||"GET").toUpperCase(),k=typeof d.body<"u",w=typeof FormData<"u"&&d.body instanceof FormData;!u.has("Content-Type")&&f!=="GET"&&k&&!w&&u.set("Content-Type","application/json");const _=b();_&&u.set("Authorization",`Bearer ${_}`);const g=s??[f,e,_??"",typeof d.body=="string"?d.body:""].join("|"),Ee=i??f==="GET",be=f==="GET"&&!!a&&a>0;if(be){const y=Y.get(g);if(y&&y.expiresAt>Date.now())return y.value;y&&Y.delete(g)}if(Ee){const y=Q.get(g);if(y)return y}const H=(async()=>{const y=o??(f==="GET"?1:0),Se=n??Et,Je=r??(f==="GET"?vt:_t),Be=I??!0;for(let D=0;D<=y;D+=1){const x=new AbortController,Te=()=>x.abort();d.signal&&d.signal.addEventListener("abort",Te,{once:!0});const We=setTimeout(()=>x.abort(),Je);try{const v=await fetch(`${wt}/${e}`,{...d,headers:u,signal:x.signal}),ke=await v.text();let M={};try{M=ke?JSON.parse(ke):{}}catch{M={}}if(!v.ok){const Ge=M.message||"Erreur serveur.",He=e.startsWith("auth")||e===bt;if((v.status===401||v.status===403)&&Be&&!He){if(await Ot())return p(e,{...t,retryAuth:!1});At(v.status)}if(D<y&&Tt(v.status)){await Pe(Se*Math.pow(2,D));continue}throw new Error(Ge)}return be&&Y.set(g,{expiresAt:Date.now()+(a??0),value:M}),M}catch(v){if(d.signal?.aborted)throw v;if(D<y&&kt(v)){await Pe(Se*Math.pow(2,D));continue}throw v}finally{clearTimeout(We),d.signal&&d.signal.removeEventListener("abort",Te)}}throw new Error("Erreur serveur.")})();return Ee&&(Q.set(g,H),H.finally(()=>{Q.delete(g)})),H},$e="warchess.offline.queue",Le=5;let m=[],Ie=!1,X=!1;const oe=new Set,z=()=>typeof window<"u",V=()=>!z()||typeof navigator>"u"?!1:navigator.onLine===!1,Ue=e=>e instanceof Error?e.name==="AbortError"?!0:/Network|Failed to fetch|load failed/i.test(e.message):!1,$=()=>{if(!(Ie||!z())){Ie=!0;try{const e=window.localStorage.getItem($e);m=e?JSON.parse(e):[]}catch{m=[]}}},ue=()=>{if(z())try{window.localStorage.setItem($e,JSON.stringify(m))}catch{}},W=()=>{for(const e of oe)e(m.length)},Pt=e=>($(),oe.add(e),e(m.length),()=>{oe.delete(e)}),Lt=()=>{$(),m=[],ue(),W()},It=()=>{!z()||!("serviceWorker"in navigator)||!("SyncManager"in window)||navigator.serviceWorker.ready.then(t=>{const r=t.sync;if(r)return r.register("warchess-sync")}).catch(()=>{})},Dt=()=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`,De=async(e,t)=>{$(),e==="profile-save"&&(m=m.filter(o=>o.type!=="profile-save"));const r={id:Dt(),type:e,payload:t,createdAt:new Date().toISOString(),attempts:0};return m.push(r),ue(),W(),It(),V()||E(),r.id},Ct=async e=>{switch(e.type){case"profile-save":{const t=e.payload.profile;if(!t)return;await p("dashboard-save",{method:"POST",body:JSON.stringify({profile:t}),dedupe:!1});return}case"friend-request":{const t=e.payload.userId;if(!t)return;await p("friends-request",{method:"POST",body:JSON.stringify({userId:t}),dedupe:!1});return}case"match-invite":{const t=e.payload.userId;if(!t)return;await p("match-invite-create",{method:"POST",body:JSON.stringify({userId:t,timeControl:e.payload.timeControl??"10+0",requesterSide:e.payload.requesterSide??"Aleatoire"}),dedupe:!1});return}case"match-move":{const t=e.payload.matchId,r=e.payload.from,o=e.payload.to,n=e.payload.notation;if(!t||!r||!o||!n)return;await p("match-move-add",{method:"POST",body:JSON.stringify({matchId:t,from:r,to:o,notation:n}),dedupe:!1});return}default:return}},E=async()=>{if($(),X||V()||!b()||!m.length)return;X=!0;const e=[];for(let t=0;t<m.length;t+=1){const r=m[t];if(r&&!(r.attempts>=Le))try{await Ct(r)}catch(o){if(r.attempts+=1,V()||Ue(o)){e.push(r,...m.slice(t+1));break}r.attempts<Le&&e.push(r)}}m=e,ue(),W(),X=!1},Rt=()=>{$(),W(),V()||E(),z()&&(window.addEventListener("online",()=>{E()}),"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",e=>{e.data?.type==="flush-queue"&&E()}),document.addEventListener("visibilitychange",()=>{document.hidden||E()}))},Vt={key:0,class:"offline-banner",role:"status","aria-live":"polite"},Mt={key:1,class:"offline-banner offline-banner--pending",role:"status"},Nt={class:"offline-banner__text"},zt=ae({__name:"App",setup(e){const t=te(!0),r=te(0);let o=null;const n=()=>{typeof navigator>"u"||(t.value=navigator.onLine)},s=()=>{typeof window>"u"||window.location.reload()};return Ne(()=>{typeof window>"u"||(n(),window.addEventListener("online",n),window.addEventListener("offline",n),o=Pt(a=>{r.value=a}))}),Ye(()=>{typeof window>"u"||(window.removeEventListener("online",n),window.removeEventListener("offline",n),o&&(o(),o=null))}),(a,i)=>(P(),O(Me,null,[t.value?r.value?(P(),O("div",Mt,[c("div",null,[i[2]||(i[2]=c("p",{class:"offline-banner__title"},"Actions en attente",-1)),c("p",Nt,J(r.value)+" action"+J(r.value>1?"s":"")+" en cours de synchronisation. ",1)]),c("button",{class:"button-ghost",type:"button",onClick:i[0]||(i[0]=(...I)=>N(E)&&N(E)(...I))},"Synchroniser")])):ze("",!0):(P(),O("div",Vt,[i[1]||(i[1]=c("div",null,[c("p",{class:"offline-banner__title"},"Vous etes hors ligne."),c("p",{class:"offline-banner__text"},"Certaines actions peuvent etre indisponibles.")],-1)),c("button",{class:"button-ghost",type:"button",onClick:s},"Reessayer")])),K(N(Xe)),K(dt),K(yt)],64))}}),$t="modulepreload",Ut=function(e,t){return new URL(e,t).href},Ce={},l=function(t,r,o){let n=Promise.resolve();if(r&&r.length>0){let d=function(u){return Promise.all(u.map(f=>Promise.resolve(f).then(k=>({status:"fulfilled",value:k}),k=>({status:"rejected",reason:k}))))};const a=document.getElementsByTagName("link"),i=document.querySelector("meta[property=csp-nonce]"),I=i?.nonce||i?.getAttribute("nonce");n=d(r.map(u=>{if(u=Ut(u,o),u in Ce)return;Ce[u]=!0;const f=u.endsWith(".css"),k=f?'[rel="stylesheet"]':"";if(o)for(let _=a.length-1;_>=0;_--){const g=a[_];if(g.href===u&&(!f||g.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${u}"]${k}`))return;const w=document.createElement("link");if(w.rel=f?"stylesheet":$t,f||(w.as="script"),w.crossOrigin="",w.href=u,I&&w.setAttribute("nonce",I),document.head.appendChild(w),f)return new Promise((_,g)=>{w.addEventListener("load",_),w.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${u}`)))})}))}function s(a){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=a,window.dispatchEvent(i),!i.defaultPrevented)throw a}return n.then(a=>{for(const i of a||[])i.status==="rejected"&&s(i.reason);return t().catch(s)})},qt=()=>l(()=>import("./IntroView-CRD3HILC.js"),__vite__mapDeps([0,1,2]),import.meta.url),jt=()=>l(()=>import("./LoginView-Bdl3cLa6.js"),__vite__mapDeps([3,1]),import.meta.url),Ft=()=>l(()=>import("./RegisterView-BICOFQOK.js"),__vite__mapDeps([4,1]),import.meta.url),Jt=()=>l(()=>import("./ForgotPasswordView-d5IAc1x2.js"),__vite__mapDeps([5,1]),import.meta.url),Bt=()=>l(()=>import("./HomeView-0y7KK7pI.js"),__vite__mapDeps([6,1,7,2,8,9,10,11,12]),import.meta.url),Wt=()=>l(()=>import("./MatchListView-BxgWIlwj.js"),__vite__mapDeps([13,1,7,2,8]),import.meta.url),Gt=()=>l(()=>import("./StoryView-DScWYjN4.js"),__vite__mapDeps([14,1,7,2,11]),import.meta.url),Ht=()=>l(()=>import("./StoryChapterView-DHLqJqd8.js"),__vite__mapDeps([15,1,7,2,11]),import.meta.url),xt=()=>l(()=>import("./GameView-C7itmr7d.js"),__vite__mapDeps([16,1,7,2,17,12]),import.meta.url),Kt=()=>l(()=>import("./LeaderboardView-KBeKPJ5Z.js"),__vite__mapDeps([18,1,7,2,9]),import.meta.url),Qt=()=>l(()=>import("./ProfileView-eKiHRGbf.js"),__vite__mapDeps([19,1,7,2]),import.meta.url),Yt=()=>l(()=>import("./ProfileAnalysisView-D8Eb4BLr.js"),__vite__mapDeps([20,1,7,2,10,21]),import.meta.url),Xt=()=>l(()=>import("./UserProfileView-7gxDuIg0.js"),__vite__mapDeps([22,1,7,2]),import.meta.url),Zt=()=>l(()=>import("./FriendsView-DuikGx2p.js"),__vite__mapDeps([23,1,7,2]),import.meta.url),er=()=>l(()=>import("./SettingsView-CELetVTt.js"),__vite__mapDeps([24,1,7,2]),import.meta.url),tr=()=>l(()=>import("./HelpView-Dh8kUIO3.js"),__vite__mapDeps([25,1,2]),import.meta.url),rr=()=>l(()=>import("./PerfView-CRiFmo-E.js"),__vite__mapDeps([26,7,1,2]),import.meta.url),or=()=>l(()=>import("./NotFoundView-Dm9vzTRS.js"),__vite__mapDeps([27,1,2]),import.meta.url),L=Ze({history:et("./"),scrollBehavior(){return{top:0}},routes:[{path:"/",redirect:"/intro"},{path:"/intro",name:"intro",component:qt,meta:{title:"Accueil",description:"Decouvrez WarChess, l'arene d'echecs pour jouer et progresser rapidement."}},{path:"/auth",name:"auth",component:jt,alias:"/connexion",meta:{title:"Connexion",description:"Connectez-vous ou jouez en invite pour demarrer une partie."}},{path:"/dashboard",name:"dashboard",component:Bt,alias:"/tableau-de-bord",meta:{title:"Dashboard",description:"Suivez vos performances, matchs et analyses recentes."}},{path:"/matchs",name:"matchs",component:Wt,alias:"/matches",meta:{title:"Matchs",description:"Creez et gerez vos parties en cours."}},{path:"/histoire",name:"histoire",component:Gt,meta:{title:"Mode histoire",description:"Progressez dans une campagne de chapitres a difficulte croissante."}},{path:"/histoire/:id",name:"histoire-chapitre",component:Ht,meta:{title:"Chapitre",description:"Detail du chapitre et lancement de la mission."}},{path:"/play/:id?",name:"play",component:xt,alias:"/jeu/:id?",meta:{title:"Jouer",description:"Lancez une partie locale ou en ligne."}},{path:"/leaderboard",name:"leaderboard",component:Kt,alias:"/classement",meta:{title:"Classement",description:"Comparez vos performances avec les meilleurs joueurs."}},{path:"/profile",name:"profile",component:Qt,alias:"/profil",meta:{title:"Profil",description:"Gerez vos informations et la securite du compte."}},{path:"/amis",name:"amis",component:Zt,meta:{title:"Amis",description:"Invitez et suivez vos partenaires de jeu."}},{path:"/joueur/:id",name:"joueur",component:Xt,meta:{title:"Profil joueur",description:"Consultez les statistiques publiques."}},{path:"/profil/analyse",name:"profil-analyse",component:Yt,meta:{title:"Analyse",description:"Analysez votre progression sur la saison."}},{path:"/settings",name:"settings",component:er,alias:"/parametres",meta:{title:"Parametres",description:"Ajustez l'interface, les notifications et la confidentialite."}},{path:"/inscription",name:"inscription",component:Ft,alias:"/auth/inscription",meta:{title:"Inscription",description:"Creez un compte WarChess."}},{path:"/mot-de-passe-oublie",name:"mot-de-passe-oublie",component:Jt,alias:"/auth/mot-de-passe-oublie",meta:{title:"Mot de passe",description:"Reinitialisez votre acces au compte."}},{path:"/help",name:"help",component:tr,alias:"/aide",meta:{title:"Aide",description:"Regles, FAQ et conseils pour bien demarrer."}},{path:"/perf",name:"perf",component:rr,alias:"/diagnostics",meta:{title:"Diagnostics",description:"Mesures de performance et erreurs client."}},{path:"/:pathMatch(.*)*",name:"not-found",component:or,meta:{title:"Page introuvable",description:"La page demandee n'existe pas."}}]});L.beforeEach(e=>{if(e.name!=="play")return!0;const t=typeof e.params.id=="string"&&e.params.id.length>0,r=typeof e.query.allow=="string"&&e.query.allow==="1";let o=!1;if(typeof window<"u")try{o=window.sessionStorage.getItem("warchess.play.access")==="1",o&&window.sessionStorage.removeItem("warchess.play.access")}catch{o=!1}return t||r||o?!0:{path:"/matchs"}});const de="warchess.session.guest",nr=()=>typeof window>"u"?!1:window.localStorage.getItem(de)==="1",Dr=()=>{typeof window>"u"||window.localStorage.setItem(de,"1")},fe=()=>{typeof window>"u"||window.localStorage.removeItem(de)},qe="warchess.dashboard",U={profile:{id:"",name:"",title:"",rating:1200,motto:"",location:"",lastSeen:"",email:"",avatarUrl:""},games:[],goals:[]},sr={name:"Invite",title:"Mode invite",rating:1200,motto:"Jouez librement, progressez ensuite.",location:"Hors ligne",lastSeen:"Maintenant",email:""};let h=null,j=null,C=0;const ar=6e4,ir=()=>{if(typeof window>"u")return null;try{const e=window.localStorage.getItem(qe);return e?JSON.parse(e):null}catch{return null}},B=e=>{if(!(typeof window>"u"))try{window.localStorage.setItem(qe,JSON.stringify(e))}catch{}},ne=e=>e?{profile:{...U.profile,...e.profile},games:e.games?.length?e.games:U.games,goals:e.goals?.length?e.goals:U.goals}:U,Re=e=>nr()?{...e,profile:{...e.profile,...sr}}:e,cr=()=>{h=null,j=null,C=0},lr=(e,t)=>{e.profile={...e.profile,...t.profile},e.games=t.games,e.goals=t.goals},ur=async()=>{const e=ir(),t=Re(ne(e)),r=e?.profile?.avatarUrl??"";if(h||(h=t),!b())return h;const o=Date.now()-C>ar;return!j&&o&&(j=p("dashboard-get").then(n=>{if(!n.ok)return t;const s=ne(n.dashboard);return r&&!s.profile.avatarUrl&&(s.profile.avatarUrl=r),Re(s)}).catch(()=>t).then(n=>h?(lr(h,n),B(h),C=Date.now(),h):(h=n,B(n),C=Date.now(),n)).finally(()=>{j=null})),h},Cr=async e=>{if(h=e,B(e),C=Date.now(),!b())return e;if(V())return await De("profile-save",{profile:e.profile}),e;try{const t=await p("dashboard-save",{method:"POST",body:JSON.stringify({profile:e.profile})}),r=t.ok?ne(t.dashboard):e;return t.ok&&e.profile.avatarUrl&&!r.profile.avatarUrl&&(r.profile.avatarUrl=e.profile.avatarUrl),h=r,B(r),C=Date.now(),r}catch(t){return(Ue(t)||V())&&await De("profile-save",{profile:e.profile}),e}},q=[];let T=null,F=null;const dr=e=>e==="planifie"?"waiting":e==="en_cours"?"started":e==="termine"?"finished":e==="abandonne"?"aborted":e==="waiting"||e==="ready"||e==="started"||e==="finished"||e==="aborted"?e:"waiting",fr=e=>({...e,status:dr(e.status)}),mr=()=>{T=null,F=null},me=async()=>T||(b()?(F||(F=p("matches-get").then(e=>e.ok&&e.matches?.length?e.matches:q).catch(()=>q).then(e=>e.filter(t=>t.mode==="JcJ").map(fr)).then(e=>(T=e,e))),F):(T=q,q)),Rr=async e=>(await me()).find(r=>r.id===e)??null,Vr=async(e="history")=>{const t=await me(),r=e==="all"?[]:t.filter(o=>o.status!=="finished"&&o.status!=="aborted");if(!b())return T=r,{ok:!0,message:"Historique efface.",matches:r};try{const o=await p("matches-clear",{method:"POST",body:JSON.stringify({scope:e})}),n=o.ok&&o.matches?o.matches:r;return T=n,{ok:o.ok,message:o.message,matches:n}}catch(o){return T=r,{ok:!1,message:o.message,matches:r}}},pr=async()=>{b()&&await Promise.allSettled([ur(),me()])},je="warchess.preferences",R={darkMode:!1,simplifiedUi:!1,language:"Francais",timezone:"Europe/Paris",cadence:"10+0 Rapide",boardTheme:"Theme botanique",haloTheme:"blue",notifications:{matchAlerts:!0,matchResults:!0,tacticalTips:!1},privacy:{publicProfile:!0,visibleHistory:!1,sharedStats:!0}},hr=()=>{if(typeof window>"u")return{};try{const e=window.localStorage.getItem(je);return e?JSON.parse(e):{}}catch{return{}}},gr=()=>{const e=hr();return{...R,...e,notifications:{...R.notifications,...e.notifications??{}},privacy:{...R.privacy,...e.privacy??{}}}},Mr=e=>{typeof window>"u"||window.localStorage.setItem(je,JSON.stringify(e))},Nr=()=>({...R,notifications:{...R.notifications},privacy:{...R.privacy}}),yr=e=>{if(typeof document>"u")return;const t=document.documentElement,r=document.body,o=r?[t,r]:[t];o.forEach(a=>{a.classList.toggle("theme-dark",e.darkMode),a.classList.toggle("ui-simple",e.simplifiedUi)});const n=["theme-halo-blue","theme-halo-red","theme-halo-green","theme-halo-violet","theme-halo-amber","theme-halo-teal","theme-halo-slate"];o.forEach(a=>{n.forEach(i=>a.classList.remove(i))});const s=["blue","red","green","violet","amber","teal","slate"].includes(e.haloTheme)?e.haloTheme:"blue";o.forEach(a=>{a.classList.add(`theme-halo-${s}`)})},Z={title:"WarChess | Echecs nouvelle generation",description:"WarChess, plateforme d'echecs moderne pour jouer et progresser.",image:"/favicon-512x512.png"},wr=()=>typeof window>"u"?"":window.location.origin,S=(e,t,r="name")=>{if(typeof document>"u")return;let o=document.querySelector(`meta[${r}="${e}"]`);o||(o=document.createElement("meta"),o.setAttribute(r,e),document.head.appendChild(o)),o.setAttribute("content",t)},vr=(e,t)=>{if(typeof document>"u")return;let r=document.querySelector(`link[rel="${e}"]`);r||(r=document.createElement("link"),r.setAttribute("rel",e),document.head.appendChild(r)),r.setAttribute("href",t)},_r=(e,t)=>{if(typeof document>"u")return;({...e});const r=e.title?`${e.title} | WarChess`:Z.title;document.title=r;const o=e.description??Z.description,n=e.image??Z.image,s=`${wr()}/#${t.path}`;S("description",o),S("og:title",r,"property"),S("og:description",o,"property"),S("og:image",n,"property"),S("og:url",s,"property"),S("twitter:title",r),S("twitter:description",o),S("twitter:image",n),vr("canonical",s)},Er=e=>{e.afterEach(t=>{_r(t.meta||{},t)})},pe=()=>{cr(),mr()},Fe=()=>{le(null),fe(),pe(),Lt()},zr=async()=>{try{b()&&await p("auth-logout",{method:"POST"})}catch{}finally{Fe()}},$r=async()=>{if(!b())return null;try{const e=await p("auth-session");return e.ok?e.user??null:null}catch{return null}},Ur=async(e,t,r)=>{if(!e||!t||!r)return{ok:!1,message:"Veuillez remplir tous les champs."};try{const o=await p("auth-register",{method:"POST",body:JSON.stringify({email:e.trim(),password:t,displayName:r.trim()})});return o.ok&&o.token&&(le(o.token),fe(),pe(),E()),{ok:o.ok,message:o.message,user:o.user}}catch(o){return{ok:!1,message:o.message}}},qr=async(e,t)=>{if(!e||!t)return{ok:!1,message:"Veuillez remplir tous les champs."};try{const r=await p("auth-login",{method:"POST",body:JSON.stringify({email:e.trim(),password:t})});return r.ok&&r.token&&(le(r.token),fe(),pe(),E()),{ok:r.ok,message:r.message,user:r.user}}catch(r){return{ok:!1,message:r.message}}},jr=e=>e.trim().toLowerCase()?{ok:!0,message:"Si un compte existe, un lien de reinitialisation a ete envoye."}:{ok:!1,message:"Veuillez saisir un email."},Fr=async(e,t)=>{if(!e||!t)return{ok:!1,message:"Veuillez remplir tous les champs."};try{const r=await p("auth-password",{method:"POST",body:JSON.stringify({currentPassword:e,nextPassword:t})});return{ok:r.ok,message:r.message}}catch(r){return{ok:!1,message:r.message}}},he="warchess.observability.errors",G="warchess.observability.perf",br=50,ge=()=>typeof window<"u",ye=e=>{if(!ge())return[];try{const t=window.localStorage.getItem(e);return t?JSON.parse(t):[]}catch{return[]}},se=(e,t)=>{if(ge())try{window.localStorage.setItem(e,JSON.stringify(t.slice(-br)))}catch{}},we=(e,t)=>{const r=ye(e);r.push(t),se(e,r)},ve=()=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`,Ve=(e,t,r)=>{we(he,{id:ve(),message:e,stack:t,context:r,time:new Date().toISOString()})},ee=(e,t,r)=>{we(G,{id:ve(),type:"navigation",name:e,value:t,meta:r,time:new Date().toISOString()})},Sr=(e,t,r)=>{we(G,{id:ve(),type:"route",name:e,value:t,meta:r,time:new Date().toISOString()})},Jr=()=>ye(he),Br=()=>ye(G),Wr=()=>{se(he,[]),se(G,[])},Tr=e=>{if(!ge())return;const t=performance.getEntriesByType("navigation")[0];if(t&&(ee("ttfb",t.responseStart-t.requestStart),ee("domContentLoaded",t.domContentLoadedEventEnd-t.startTime),ee("load",t.loadEventEnd-t.startTime)),e){let r=0;e.beforeEach(()=>{r=performance.now()}),e.afterEach(o=>{r>0&&Sr("route-change",performance.now()-r,{path:o.fullPath})})}window.addEventListener("error",r=>{Ve(r.message||"Erreur inconnue",r.error?.stack,{source:r.filename,line:r.lineno,column:r.colno})}),window.addEventListener("unhandledrejection",r=>{const o=r.reason;Ve(o?.message??"Promise rejetee",o?.stack,{source:"unhandledrejection"})})};pr();yr(gr());const _e=tt(zt);_e.use(rt());_e.use(L);Er(L);ht(L);Tr(L);Rt();_e.mount("#app");if(typeof document<"u"){document.documentElement.classList.add("app-ready");const e=document.getElementById("app-loader");e&&(e.setAttribute("aria-hidden","true"),window.setTimeout(()=>{e.remove()},350))}"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").catch(()=>{})});typeof window<"u"&&window.addEventListener("auth:expired",()=>{const e=L.currentRoute.value;if(!e.path.startsWith("/auth")){try{window.sessionStorage.setItem("warchess.postLoginRedirect",e.fullPath)}catch{}Fe(),L.push({path:"/auth",query:{reason:"expired"}})}});export{Jr as A,Wr as B,nr as C,zr as D,l as _,Pr as a,Lr as b,jr as c,me as d,b as e,p as f,ur as g,Vr as h,V as i,De as j,Ue as k,qr as l,mr as m,Ir as n,Rr as o,$r as p,Cr as q,Ur as r,Dr as s,pt as t,Fr as u,gr as v,Mr as w,yr as x,Nr as y,Br as z};
