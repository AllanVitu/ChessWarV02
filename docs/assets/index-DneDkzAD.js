const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./IntroView-DBw3EgCy.js","./vendor-vue-DHDwDR0M.js","./brand-icon-IDKxxvz3.js","./LoginView-DKGQvTxW.js","./RegisterView-DtDVI6-b.js","./ForgotPasswordView-D43zUTqQ.js","./HomeView-CAjDQPZN.js","./DashboardLayout.vue_vue_type_script_setup_true_lang-wVOHqvGg.js","./AppModal.vue_vue_type_script_setup_true_lang-CWrUK09g.js","./leaderboard-Be1y-udc.js","./stats-DDjpa0W3.js","./story-NDRLUkJb.js","./pieceAssets-DL4XSxcU.js","./MatchListView-DjVIuvV4.js","./TrainingView-C4SyqXBd.js","./puzzles-C5G97RSN.js","./StoryView-Cxhiabyg.js","./StoryChapterView-D-qaWWB7.js","./GameView-BpTWcuNz.js","./engine-CJX4mt8-.js","./LeaderboardView-Ce0oYYma.js","./ProfileView-BZJeS140.js","./ProfileAnalysisView-BNVWS1Ph.js","./ProfileAnalysisView-DEAApM8f.css","./UserProfileView-C2ZPUme0.js","./FriendsView-DfqBcwQU.js","./SettingsView-D7jueT5P.js","./HelpView-Dh8kUIO3.js","./PerfView-D5HnRDvB.js","./NotFoundView-Dm9vzTRS.js"])))=>i.map(i=>d[i]);
import{r as Xe,d as ie,c as P,F as Ne,a as Ze,u as N,o as I,n as et,b as d,t as G,e as te,f as ze,g as $e,h as tt,i as K,R as ot,j as rt,k as nt,l as st,m as at}from"./vendor-vue-DHDwDR0M.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function o(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=o(n);fetch(n.href,s)}})();const O=Xe({items:[]});let it=0;const ct=()=>O,ce=(e,t=3600)=>{const o=it+=1;O.items=[...O.items,{...e,id:o}],setTimeout(()=>{O.items=O.items.filter(r=>r.id!==o)},t)},lt=e=>{O.items=O.items.filter(t=>t.id!==e)},No=(e,t)=>{ce({title:e,message:t,tone:"success"})},zo=(e,t)=>{ce({title:e,message:t,tone:"error"})},$o=(e,t)=>{ce({title:e,message:t,tone:"info"})},ut={class:"toast-stack toast-stack--global","aria-live":"polite","aria-atomic":"true"},dt={class:"toast-main"},mt={class:"toast-title"},ft={class:"toast-sub"},pt=["onClick"],ht=ie({__name:"AppToasts",setup(e){const t=ct();return(o,r)=>(I(),P("div",ut,[(I(!0),P(Ne,null,Ze(N(t).items,n=>(I(),P("div",{key:n.id,class:et(["toast-card",`toast-card--${n.tone}`]),role:"status"},[d("div",dt,[d("p",mt,G(n.title),1),d("p",ft,G(n.message),1)]),d("button",{class:"toast-close",type:"button","aria-label":"Fermer",onClick:s=>N(lt)(n.id)}," x ",8,pt)],2))),128))]))}}),gt="warchess.analytics.consent",le=()=>typeof window<"u",Oe=e=>{if(le())try{window.localStorage.setItem(gt,e?"1":"0")}catch{}},wt=()=>(le(),!1),yt=e=>{},Le=e=>{},vt=e=>{le()&&(e&&e.afterEach(t=>{yt({payload:{path:t.fullPath}})}),window.addEventListener("error",t=>{Le({message:t.message||"Erreur inconnue",stack:t.error?.stack,context:{source:t.filename,line:t.lineno,column:t.colno}})}),window.addEventListener("unhandledrejection",t=>{const o=t.reason;Le({message:o?.message??"Promise rejetee",stack:o?.stack})}))},_t={key:0,class:"cookie-banner",role:"dialog","aria-live":"polite","aria-label":"Consentement"},bt=ie({__name:"CookieBanner",setup(e){const t=te(!1);ze(()=>{t.value=wt()});const o=()=>{Oe(!0),t.value=!1},r=()=>{Oe(!1),t.value=!1};return(n,s)=>t.value?(I(),P("div",_t,[s[0]||(s[0]=d("div",{class:"cookie-banner__content"},[d("p",{class:"cookie-banner__title"},"Respect de votre vie privee"),d("p",{class:"cookie-banner__text"}," Nous utilisons des mesures anonymes pour ameliorer WarChess. Vous pouvez refuser a tout moment. ")],-1)),d("div",{class:"cookie-banner__actions"},[d("button",{class:"button-ghost",type:"button",onClick:r},"Refuser"),d("button",{class:"button-primary",type:"button",onClick:o},"Accepter")])])):$e("",!0)}}),Et="/api",oe="warchess.session.token",St=8e3,Tt=12e3,At=400,kt="",Ot="auth:expired",Y=new Map,Q=new Map,E=()=>typeof window>"u"||typeof localStorage>"u"?null:localStorage.getItem(oe),ue=e=>{if(!(typeof window>"u"||typeof localStorage>"u")){if(!e){localStorage.removeItem(oe);return}localStorage.setItem(oe,e)}},Pe=e=>new Promise(t=>setTimeout(t,e)),Lt=e=>e>=500||e===429,Pt=e=>e instanceof Error?e.name==="AbortError"||/Network/i.test(e.message):!1,It=e=>{typeof window>"u"||window.dispatchEvent(new CustomEvent(Ot,{detail:{status:e}}))},Dt=async()=>null,h=async(e,t={})=>{const{timeoutMs:o,retries:r,retryDelayMs:n,cacheKey:s,cacheTtlMs:i,dedupe:c,retryAuth:S,...m}=t,a=new Headers(m.headers),u=(m.method||"GET").toUpperCase(),k=typeof m.body<"u",y=typeof FormData<"u"&&m.body instanceof FormData;!a.has("Content-Type")&&u!=="GET"&&k&&!y&&a.set("Content-Type","application/json");const _=E();_&&a.set("Authorization",`Bearer ${_}`);const g=s??[u,e,_??"",typeof m.body=="string"?m.body:""].join("|"),Ee=c??u==="GET",Se=u==="GET"&&!!i&&i>0;if(Se){const w=Q.get(g);if(w&&w.expiresAt>Date.now())return w.value;w&&Q.delete(g)}if(Ee){const w=Y.get(g);if(w)return w}const x=(async()=>{const w=r??(u==="GET"?1:0),Te=n??At,xe=o??(u==="GET"?St:Tt),He=S??!0;for(let C=0;C<=w;C+=1){const H=new AbortController,Ae=()=>H.abort();m.signal&&m.signal.addEventListener("abort",Ae,{once:!0});const Ke=setTimeout(()=>H.abort(),xe);try{const v=await fetch(`${Et}/${e}`,{...m,headers:a,signal:H.signal}),ke=await v.text();let V={};try{V=ke?JSON.parse(ke):{}}catch{V={}}if(!v.ok){const Ye=V.message||"Erreur serveur.",Qe=e.startsWith("auth")||e===kt;if((v.status===401||v.status===403)&&He&&!Qe){if(await Dt())return h(e,{...t,retryAuth:!1});It(v.status)}if(C<w&&Lt(v.status)){await Pe(Te*Math.pow(2,C));continue}throw new Error(Ye)}return Se&&Q.set(g,{expiresAt:Date.now()+(i??0),value:V}),V}catch(v){if(m.signal?.aborted)throw v;if(C<w&&Pt(v)){await Pe(Te*Math.pow(2,C));continue}throw v}finally{clearTimeout(Ke),m.signal&&m.signal.removeEventListener("abort",Ae)}}throw new Error("Erreur serveur.")})();return Ee&&(Y.set(g,x),x.finally(()=>{Y.delete(g)})),x},Ue="warchess.offline.queue",Ie=5;let p=[],De=!1,X=!1;const re=new Set,$=()=>typeof window<"u",M=()=>!$()||typeof navigator>"u"?!1:navigator.onLine===!1,qe=e=>e instanceof Error?e.name==="AbortError"?!0:/Network|Failed to fetch|load failed/i.test(e.message):!1,U=()=>{if(!(De||!$())){De=!0;try{const e=window.localStorage.getItem(Ue);p=e?JSON.parse(e):[]}catch{p=[]}}},de=()=>{if($())try{window.localStorage.setItem(Ue,JSON.stringify(p))}catch{}},B=()=>{for(const e of re)e(p.length)},Ct=e=>(U(),re.add(e),e(p.length),()=>{re.delete(e)}),Rt=()=>{U(),p=[],de(),B()},Mt=()=>{!$()||!("serviceWorker"in navigator)||!("SyncManager"in window)||navigator.serviceWorker.ready.then(t=>{const o=t.sync;if(o)return o.register("warchess-sync")}).catch(()=>{})},Vt=()=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`,Ce=async(e,t)=>{U(),e==="profile-save"&&(p=p.filter(r=>r.type!=="profile-save"));const o={id:Vt(),type:e,payload:t,createdAt:new Date().toISOString(),attempts:0};return p.push(o),de(),B(),Mt(),M()||b(),o.id},Nt=async e=>{switch(e.type){case"profile-save":{const t=e.payload.profile;if(!t)return;await h("dashboard-save",{method:"POST",body:JSON.stringify({profile:t}),dedupe:!1});return}case"friend-request":{const t=e.payload.userId;if(!t)return;await h("friends-request",{method:"POST",body:JSON.stringify({userId:t}),dedupe:!1});return}case"match-invite":{const t=e.payload.userId;if(!t)return;await h("match-invite-create",{method:"POST",body:JSON.stringify({userId:t,timeControl:e.payload.timeControl??"10+0",requesterSide:e.payload.requesterSide??"Aleatoire"}),dedupe:!1});return}case"match-move":{const t=e.payload.matchId,o=e.payload.from,r=e.payload.to,n=e.payload.notation,s=e.payload.promotion;if(!t||!o||!r||!n)return;await h("match-move-add",{method:"POST",body:JSON.stringify({matchId:t,from:o,to:r,notation:n,promotion:s}),dedupe:!1});return}default:return}},b=async()=>{if(U(),X||M()||!E()||!p.length)return;X=!0;const e=[];for(let t=0;t<p.length;t+=1){const o=p[t];if(o&&!(o.attempts>=Ie))try{await Nt(o)}catch(r){if(o.attempts+=1,M()||qe(r)){e.push(o,...p.slice(t+1));break}o.attempts<Ie&&e.push(o)}}p=e,de(),B(),X=!1},zt=()=>{U(),B(),M()||b(),$()&&(window.addEventListener("online",()=>{b()}),"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",e=>{e.data?.type==="flush-queue"&&b()}),document.addEventListener("visibilitychange",()=>{document.hidden||b()}))},$t={key:0,class:"offline-banner",role:"status","aria-live":"polite"},Ut={key:1,class:"offline-banner offline-banner--pending",role:"status"},qt={class:"offline-banner__text"},Ft=ie({__name:"App",setup(e){const t=te(!0),o=te(0);let r=null;const n=()=>{typeof navigator>"u"||(t.value=navigator.onLine)},s=()=>{typeof window>"u"||window.location.reload()};return ze(()=>{typeof window>"u"||(n(),window.addEventListener("online",n),window.addEventListener("offline",n),r=Ct(i=>{o.value=i}))}),tt(()=>{typeof window>"u"||(window.removeEventListener("online",n),window.removeEventListener("offline",n),r&&(r(),r=null))}),(i,c)=>(I(),P(Ne,null,[t.value?o.value?(I(),P("div",Ut,[d("div",null,[c[2]||(c[2]=d("p",{class:"offline-banner__title"},"Actions en attente",-1)),d("p",qt,G(o.value)+" action"+G(o.value>1?"s":"")+" en cours de synchronisation. ",1)]),d("button",{class:"button-ghost",type:"button",onClick:c[0]||(c[0]=(...S)=>N(b)&&N(b)(...S))},"Synchroniser")])):$e("",!0):(I(),P("div",$t,[c[1]||(c[1]=d("div",null,[d("p",{class:"offline-banner__title"},"Vous etes hors ligne."),d("p",{class:"offline-banner__text"},"Certaines actions peuvent etre indisponibles.")],-1)),d("button",{class:"button-ghost",type:"button",onClick:s},"Reessayer")])),K(N(ot)),K(ht),K(bt)],64))}}),Jt="modulepreload",jt=function(e,t){return new URL(e,t).href},Re={},l=function(t,o,r){let n=Promise.resolve();if(o&&o.length>0){let m=function(a){return Promise.all(a.map(u=>Promise.resolve(u).then(k=>({status:"fulfilled",value:k}),k=>({status:"rejected",reason:k}))))};const i=document.getElementsByTagName("link"),c=document.querySelector("meta[property=csp-nonce]"),S=c?.nonce||c?.getAttribute("nonce");n=m(o.map(a=>{if(a=jt(a,r),a in Re)return;Re[a]=!0;const u=a.endsWith(".css"),k=u?'[rel="stylesheet"]':"";if(r)for(let _=i.length-1;_>=0;_--){const g=i[_];if(g.href===a&&(!u||g.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${a}"]${k}`))return;const y=document.createElement("link");if(y.rel=u?"stylesheet":Jt,u||(y.as="script"),y.crossOrigin="",y.href=a,S&&y.setAttribute("nonce",S),document.head.appendChild(y),u)return new Promise((_,g)=>{y.addEventListener("load",_),y.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${a}`)))})}))}function s(i){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=i,window.dispatchEvent(c),!c.defaultPrevented)throw i}return n.then(i=>{for(const c of i||[])c.status==="rejected"&&s(c.reason);return t().catch(s)})},Gt=()=>l(()=>import("./IntroView-DBw3EgCy.js"),__vite__mapDeps([0,1,2]),import.meta.url),Bt=()=>l(()=>import("./LoginView-DKGQvTxW.js"),__vite__mapDeps([3,1]),import.meta.url),Wt=()=>l(()=>import("./RegisterView-DtDVI6-b.js"),__vite__mapDeps([4,1]),import.meta.url),xt=()=>l(()=>import("./ForgotPasswordView-D43zUTqQ.js"),__vite__mapDeps([5,1]),import.meta.url),Ht=()=>l(()=>import("./HomeView-CAjDQPZN.js"),__vite__mapDeps([6,1,7,2,8,9,10,11,12]),import.meta.url),Kt=()=>l(()=>import("./MatchListView-DjVIuvV4.js"),__vite__mapDeps([13,1,7,2,8]),import.meta.url),Yt=()=>l(()=>import("./TrainingView-C4SyqXBd.js"),__vite__mapDeps([14,1,7,2,15]),import.meta.url),Qt=()=>l(()=>import("./StoryView-Cxhiabyg.js"),__vite__mapDeps([16,1,7,2,11,15]),import.meta.url),Xt=()=>l(()=>import("./StoryChapterView-D-qaWWB7.js"),__vite__mapDeps([17,1,7,2,11]),import.meta.url),Zt=()=>l(()=>import("./GameView-BpTWcuNz.js"),__vite__mapDeps([18,1,7,2,19,15,12]),import.meta.url),eo=()=>l(()=>import("./LeaderboardView-Ce0oYYma.js"),__vite__mapDeps([20,1,7,2,9]),import.meta.url),to=()=>l(()=>import("./ProfileView-BZJeS140.js"),__vite__mapDeps([21,1,7,2]),import.meta.url),oo=()=>l(()=>import("./ProfileAnalysisView-BNVWS1Ph.js"),__vite__mapDeps([22,1,7,2,10,23]),import.meta.url),ro=()=>l(()=>import("./UserProfileView-C2ZPUme0.js"),__vite__mapDeps([24,1,7,2]),import.meta.url),no=()=>l(()=>import("./FriendsView-DfqBcwQU.js"),__vite__mapDeps([25,1,7,2]),import.meta.url),so=()=>l(()=>import("./SettingsView-D7jueT5P.js"),__vite__mapDeps([26,1,7,2]),import.meta.url),ao=()=>l(()=>import("./HelpView-Dh8kUIO3.js"),__vite__mapDeps([27,1,2]),import.meta.url),io=()=>l(()=>import("./PerfView-D5HnRDvB.js"),__vite__mapDeps([28,7,1,2]),import.meta.url),co=()=>l(()=>import("./NotFoundView-Dm9vzTRS.js"),__vite__mapDeps([29,1,2]),import.meta.url),D=rt({history:nt("./"),scrollBehavior(){return{top:0}},routes:[{path:"/",redirect:"/intro"},{path:"/intro",name:"intro",component:Gt,meta:{title:"Accueil",description:"Decouvrez WarChess, l'arene d'echecs pour jouer et progresser rapidement."}},{path:"/auth",name:"auth",component:Bt,alias:"/connexion",meta:{title:"Connexion",description:"Connectez-vous ou jouez en invite pour demarrer une partie."}},{path:"/dashboard",name:"dashboard",component:Ht,alias:"/tableau-de-bord",meta:{title:"Dashboard",description:"Suivez vos performances, matchs et analyses recentes."}},{path:"/matchs",name:"matchs",component:Kt,alias:"/matches",meta:{title:"Matchs",description:"Creez et gerez vos parties en cours."}},{path:"/entrainement",name:"entrainement",component:Yt,alias:"/training",meta:{title:"Entrainement",description:"Puzzles tactiques, mini-lessons et exercices personnalises."}},{path:"/histoire",name:"histoire",component:Qt,meta:{title:"Mode histoire",description:"Progressez dans une campagne de chapitres a difficulte croissante."}},{path:"/histoire/:id",name:"histoire-chapitre",component:Xt,meta:{title:"Chapitre",description:"Detail du chapitre et lancement de la mission."}},{path:"/play/:id?",name:"play",component:Zt,alias:"/jeu/:id?",meta:{title:"Jouer",description:"Lancez une partie locale ou en ligne."}},{path:"/leaderboard",name:"leaderboard",component:eo,alias:"/classement",meta:{title:"Classement",description:"Comparez vos performances avec les meilleurs joueurs."}},{path:"/profile",name:"profile",component:to,alias:"/profil",meta:{title:"Profil",description:"Gerez vos informations et la securite du compte."}},{path:"/amis",name:"amis",component:no,meta:{title:"Amis",description:"Invitez et suivez vos partenaires de jeu."}},{path:"/joueur/:id",name:"joueur",component:ro,meta:{title:"Profil joueur",description:"Consultez les statistiques publiques."}},{path:"/profil/analyse",name:"profil-analyse",component:oo,meta:{title:"Analyse",description:"Analysez votre progression sur la saison."}},{path:"/settings",name:"settings",component:so,alias:"/parametres",meta:{title:"Parametres",description:"Ajustez l'interface, les notifications et la confidentialite."}},{path:"/inscription",name:"inscription",component:Wt,alias:"/auth/inscription",meta:{title:"Inscription",description:"Creez un compte WarChess."}},{path:"/mot-de-passe-oublie",name:"mot-de-passe-oublie",component:xt,alias:"/auth/mot-de-passe-oublie",meta:{title:"Mot de passe",description:"Reinitialisez votre acces au compte."}},{path:"/help",name:"help",component:ao,alias:"/aide",meta:{title:"Aide",description:"Regles, FAQ et conseils pour bien demarrer."}},{path:"/perf",name:"perf",component:io,alias:"/diagnostics",meta:{title:"Diagnostics",description:"Mesures de performance et erreurs client."}},{path:"/:pathMatch(.*)*",name:"not-found",component:co,meta:{title:"Page introuvable",description:"La page demandee n'existe pas."}}]});D.beforeEach(e=>{if(e.name!=="play")return!0;const t=typeof e.params.id=="string"&&e.params.id.length>0,o=typeof e.query.allow=="string"&&e.query.allow==="1";let r=!1;if(typeof window<"u")try{r=window.sessionStorage.getItem("warchess.play.access")==="1",r&&window.sessionStorage.removeItem("warchess.play.access")}catch{r=!1}return t||o||r?!0:{path:"/matchs"}});const me="warchess.session.guest",lo=()=>typeof window>"u"?!1:window.localStorage.getItem(me)==="1",Uo=()=>{typeof window>"u"||window.localStorage.setItem(me,"1")},fe=()=>{typeof window>"u"||window.localStorage.removeItem(me)},Fe="warchess.dashboard",Je="warchess.games.local",q={profile:{id:"",name:"",title:"",rating:1200,motto:"",location:"",lastSeen:"",email:"",avatarUrl:""},games:[],goals:[]},uo={name:"Invite",title:"Mode invite",rating:1200,motto:"Jouez librement, progressez ensuite.",location:"Hors ligne",lastSeen:"Maintenant",email:""};let f=null,J=null,R=0;const mo=6e4,fo=()=>{if(typeof window>"u")return null;try{const e=window.localStorage.getItem(Fe);return e?JSON.parse(e):null}catch{return null}},je=()=>{if(typeof window>"u")return[];try{const e=window.localStorage.getItem(Je);return e?JSON.parse(e):[]}catch{return[]}},po=e=>{if(!(typeof window>"u"))try{window.localStorage.setItem(Je,JSON.stringify(e))}catch{}},z=e=>{if(!(typeof window>"u"))try{window.localStorage.setItem(Fe,JSON.stringify(e))}catch{}},ne=e=>e?{profile:{...q.profile,...e.profile},games:e.games?.length?e.games:q.games,goals:e.goals?.length?e.goals:q.goals}:q,Me=e=>lo()?{...e,profile:{...e.profile,...uo}}:e,Ge=(e,t)=>{if(!t.length)return e;const o=new Map;for(const r of e)o.set(r.id,r);for(const r of t)o.set(r.id,r);return[...o.values()].sort((r,n)=>{const s=new Date(n.date).getTime(),i=new Date(r.date).getTime();return(Number.isFinite(s)?s:0)-(Number.isFinite(i)?i:0)})},se=e=>{const t=je();return t.length?{...e,games:Ge(e.games,t)}:e},ho=()=>{f=null,J=null,R=0},go=(e,t)=>{e.profile={...e.profile,...t.profile},e.games=t.games,e.goals=t.goals},wo=async()=>{const e=fo(),t=se(Me(ne(e))),o=e?.profile?.avatarUrl??"";if(f||(f=t),!E())return f;const r=Date.now()-R>mo;return!J&&r&&(J=h("dashboard-get").then(n=>{if(!n.ok)return t;const s=ne(n.dashboard);return o&&!s.profile.avatarUrl&&(s.profile.avatarUrl=o),se(Me(s))}).catch(()=>t).then(n=>f?(go(f,n),z(f),R=Date.now(),f):(f=n,z(n),R=Date.now(),n)).finally(()=>{J=null})),f},qo=async e=>{if(f=e,z(e),R=Date.now(),!E())return e;if(M())return await Ce("profile-save",{profile:e.profile}),e;try{const t=await h("dashboard-save",{method:"POST",body:JSON.stringify({profile:e.profile})}),o=t.ok?ne(t.dashboard):e;t.ok&&e.profile.avatarUrl&&!o.profile.avatarUrl&&(o.profile.avatarUrl=e.profile.avatarUrl);const r=se(o);return f=r,z(r),R=Date.now(),r}catch(t){return(qe(t)||M())&&await Ce("profile-save",{profile:e.profile}),e}},Fo=e=>{const o=je().filter(n=>n.id!==e.id),r=[e,...o].slice(0,200);po(r),f&&(f.games=Ge(f.games,[e]),z(f))},F=[];let A=null,j=null;const yo=e=>e==="planifie"?"waiting":e==="en_cours"?"started":e==="termine"?"finished":e==="abandonne"?"aborted":e==="waiting"||e==="ready"||e==="started"||e==="finished"||e==="aborted"?e:"waiting",vo=e=>({...e,status:yo(e.status)}),_o=()=>{A=null,j=null},pe=async()=>A||(E()?(j||(j=h("matches-get").then(e=>e.ok&&e.matches?.length?e.matches:F).catch(()=>F).then(e=>e.filter(t=>t.mode==="JcJ").map(vo)).then(e=>(A=e,e))),j):(A=F,F)),Jo=async e=>(await pe()).find(o=>o.id===e)??null,jo=async(e="history")=>{const t=await pe(),o=e==="all"?[]:t.filter(r=>r.status!=="finished"&&r.status!=="aborted");if(!E())return A=o,{ok:!0,message:"Historique efface.",matches:o};try{const r=await h("matches-clear",{method:"POST",body:JSON.stringify({scope:e})}),n=r.ok&&r.matches?r.matches:o;return A=n,{ok:r.ok,message:r.message,matches:n}}catch(r){return A=o,{ok:!1,message:r.message,matches:o}}},bo=async()=>{E()&&await Promise.allSettled([wo(),pe()])},Be="warchess.preferences",Eo=["Theme sable","Theme contraste"],L={darkMode:!1,simplifiedUi:!1,language:"Francais",timezone:"Europe/Paris",cadence:"10+0 Rapide",boardTheme:"Theme sable",haloTheme:"blue",notifications:{matchAlerts:!0,matchResults:!0,tacticalTips:!1},privacy:{publicProfile:!0,visibleHistory:!1,sharedStats:!0}},So=()=>{if(typeof window>"u")return{};try{const e=window.localStorage.getItem(Be);return e?JSON.parse(e):{}}catch{return{}}},To=()=>{const e=So(),t={...L,...e,notifications:{...L.notifications,...e.notifications??{}},privacy:{...L.privacy,...e.privacy??{}}};return Eo.includes(t.boardTheme)||(t.boardTheme=L.boardTheme),t},Go=e=>{typeof window>"u"||window.localStorage.setItem(Be,JSON.stringify(e))},Bo=()=>({...L,notifications:{...L.notifications},privacy:{...L.privacy}}),Ao=e=>{if(typeof document>"u")return;const t=document.documentElement,o=document.body,r=o?[t,o]:[t];r.forEach(a=>{a.classList.toggle("theme-dark",e.darkMode),a.classList.toggle("ui-simple",e.simplifiedUi)});const n=["theme-halo-blue","theme-halo-red","theme-halo-green","theme-halo-violet","theme-halo-amber","theme-halo-teal","theme-halo-slate"];r.forEach(a=>{n.forEach(u=>a.classList.remove(u))});const s=["blue","red","green","violet","amber","teal","slate"].includes(e.haloTheme)?e.haloTheme:"blue";r.forEach(a=>{a.classList.add(`theme-halo-${s}`)});const i=["board-theme-botanique","board-theme-sable","board-theme-contraste"];r.forEach(a=>{i.forEach(u=>a.classList.remove(u))});const c={"Theme sable":"board-theme-sable","Theme contraste":"board-theme-contraste"},S=c["Theme sable"],m=c[e.boardTheme]??S;r.forEach(a=>{a.classList.add(m)})},Z={title:"WarChess | Echecs nouvelle generation",description:"WarChess, plateforme d'echecs moderne pour jouer et progresser.",image:"/favicon-512x512.png"},ko=()=>typeof window>"u"?"":window.location.origin,T=(e,t,o="name")=>{if(typeof document>"u")return;let r=document.querySelector(`meta[${o}="${e}"]`);r||(r=document.createElement("meta"),r.setAttribute(o,e),document.head.appendChild(r)),r.setAttribute("content",t)},Oo=(e,t)=>{if(typeof document>"u")return;let o=document.querySelector(`link[rel="${e}"]`);o||(o=document.createElement("link"),o.setAttribute("rel",e),document.head.appendChild(o)),o.setAttribute("href",t)},Lo=(e,t)=>{if(typeof document>"u")return;({...e});const o=e.title?`${e.title} | WarChess`:Z.title;document.title=o;const r=e.description??Z.description,n=e.image??Z.image,s=`${ko()}/#${t.path}`;T("description",r),T("og:title",o,"property"),T("og:description",r,"property"),T("og:image",n,"property"),T("og:url",s,"property"),T("twitter:title",o),T("twitter:description",r),T("twitter:image",n),Oo("canonical",s)},Po=e=>{e.afterEach(t=>{Lo(t.meta||{},t)})},he=()=>{ho(),_o()},We=()=>{ue(null),fe(),he(),Rt()},Wo=async()=>{try{E()&&await h("auth-logout",{method:"POST"})}catch{}finally{We()}},xo=async()=>{if(!E())return null;try{const e=await h("auth-session");return e.ok?e.user??null:null}catch{return null}},Ho=async(e,t,o)=>{if(!e||!t||!o)return{ok:!1,message:"Veuillez remplir tous les champs."};try{const r=await h("auth-register",{method:"POST",body:JSON.stringify({email:e.trim(),password:t,displayName:o.trim()})});return r.ok&&r.token&&(ue(r.token),fe(),he(),b()),{ok:r.ok,message:r.message,user:r.user}}catch(r){return{ok:!1,message:r.message}}},Ko=async(e,t)=>{if(!e||!t)return{ok:!1,message:"Veuillez remplir tous les champs."};try{const o=await h("auth-login",{method:"POST",body:JSON.stringify({email:e.trim(),password:t})});return o.ok&&o.token&&(ue(o.token),fe(),he(),b()),{ok:o.ok,message:o.message,user:o.user}}catch(o){return{ok:!1,message:o.message}}},Yo=e=>e.trim().toLowerCase()?{ok:!0,message:"Si un compte existe, un lien de reinitialisation a ete envoye."}:{ok:!1,message:"Veuillez saisir un email."},Qo=async(e,t)=>{if(!e||!t)return{ok:!1,message:"Veuillez remplir tous les champs."};try{const o=await h("auth-password",{method:"POST",body:JSON.stringify({currentPassword:e,nextPassword:t})});return{ok:o.ok,message:o.message}}catch(o){return{ok:!1,message:o.message}}},ge="warchess.observability.errors",W="warchess.observability.perf",Io=50,we=()=>typeof window<"u",ye=e=>{if(!we())return[];try{const t=window.localStorage.getItem(e);return t?JSON.parse(t):[]}catch{return[]}},ae=(e,t)=>{if(we())try{window.localStorage.setItem(e,JSON.stringify(t.slice(-Io)))}catch{}},ve=(e,t)=>{const o=ye(e);o.push(t),ae(e,o)},_e=()=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`,Ve=(e,t,o)=>{ve(ge,{id:_e(),message:e,stack:t,context:o,time:new Date().toISOString()})},ee=(e,t,o)=>{ve(W,{id:_e(),type:"navigation",name:e,value:t,meta:o,time:new Date().toISOString()})},Do=(e,t,o)=>{ve(W,{id:_e(),type:"route",name:e,value:t,meta:o,time:new Date().toISOString()})},Xo=()=>ye(ge),Zo=()=>ye(W),er=()=>{ae(ge,[]),ae(W,[])},Co=e=>{if(!we())return;const t=performance.getEntriesByType("navigation")[0];if(t&&(ee("ttfb",t.responseStart-t.requestStart),ee("domContentLoaded",t.domContentLoadedEventEnd-t.startTime),ee("load",t.loadEventEnd-t.startTime)),e){let o=0;e.beforeEach(()=>{o=performance.now()}),e.afterEach(r=>{o>0&&Do("route-change",performance.now()-o,{path:r.fullPath})})}window.addEventListener("error",o=>{Ve(o.message||"Erreur inconnue",o.error?.stack,{source:o.filename,line:o.lineno,column:o.colno})}),window.addEventListener("unhandledrejection",o=>{const r=o.reason;Ve(r?.message??"Promise rejetee",r?.stack,{source:"unhandledrejection"})})};bo();Ao(To());const be=st(Ft);be.use(at());be.use(D);Po(D);vt(D);Co(D);zt();be.mount("#app");if(typeof document<"u"){document.documentElement.classList.add("app-ready");const e=document.getElementById("app-loader");e&&(e.setAttribute("aria-hidden","true"),window.setTimeout(()=>{e.remove()},350))}"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").catch(()=>{})});typeof window<"u"&&window.addEventListener("auth:expired",()=>{const e=D.currentRoute.value;if(!e.path.startsWith("/auth")){try{window.sessionStorage.setItem("warchess.postLoginRedirect",e.fullPath)}catch{}We(),D.push({path:"/auth",query:{reason:"expired"}})}});export{Zo as A,Xo as B,er as C,lo as D,Wo as E,l as _,No as a,zo as b,Yo as c,pe as d,E as e,h as f,wo as g,jo as h,M as i,Ce as j,qe as k,Ko as l,_o as m,$o as n,Fo as o,Jo as p,xo as q,Ho as r,Uo as s,yt as t,Qo as u,qo as v,To as w,Go as x,Ao as y,Bo as z};
