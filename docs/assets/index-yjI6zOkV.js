const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./IntroView-BY3kYQ-t.js","./vendor-vue-DHDwDR0M.js","./brand-icon-IDKxxvz3.js","./LoginView-wc3Xs5ta.js","./RegisterView-DmpoF3Bt.js","./ForgotPasswordView-BqArdVb8.js","./HomeView-DECqALwe.js","./DashboardLayout.vue_vue_type_script_setup_true_lang-3Gta68jF.js","./AppModal.vue_vue_type_script_setup_true_lang-CWrUK09g.js","./leaderboard-i2qju1zZ.js","./stats-DDjpa0W3.js","./story-NDRLUkJb.js","./pieceAssets-DL4XSxcU.js","./MatchListView-K1Tdpzla.js","./StoryView-CHFZF-u2.js","./StoryChapterView-5fxheSTq.js","./GameView-BBRaWjpN.js","./engine-CbTNbDBF.js","./LeaderboardView-nEd2d1cU.js","./ProfileView-FVv6qQWh.js","./ProfileAnalysisView-CNfix-6g.js","./ProfileAnalysisView-DEAApM8f.css","./UserProfileView-BlSYDj53.js","./FriendsView-DTU2y4FG.js","./SettingsView-J-quDJxK.js","./HelpView-Dh8kUIO3.js","./PerfView-OxRL5HpH.js","./NotFoundView-Dm9vzTRS.js"])))=>i.map(i=>d[i]);
import{r as xe,d as ae,c as P,F as Ve,a as Ke,u as N,o as L,n as Qe,b as u,t as J,e as te,f as Ne,g as ze,h as Ye,i as K,R as Xe,j as Ze,k as et,l as tt,m as ot}from"./vendor-vue-DHDwDR0M.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function o(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=o(n);fetch(n.href,s)}})();const O=xe({items:[]});let rt=0;const nt=()=>O,ie=(e,t=3600)=>{const o=rt+=1;O.items=[...O.items,{...e,id:o}],setTimeout(()=>{O.items=O.items.filter(r=>r.id!==o)},t)},st=e=>{O.items=O.items.filter(t=>t.id!==e)},Lo=(e,t)=>{ie({title:e,message:t,tone:"success"})},Io=(e,t)=>{ie({title:e,message:t,tone:"error"})},Do=(e,t)=>{ie({title:e,message:t,tone:"info"})},at={class:"toast-stack toast-stack--global","aria-live":"polite","aria-atomic":"true"},it={class:"toast-main"},ct={class:"toast-title"},lt={class:"toast-sub"},ut=["onClick"],dt=ae({__name:"AppToasts",setup(e){const t=nt();return(o,r)=>(L(),P("div",at,[(L(!0),P(Ve,null,Ke(N(t).items,n=>(L(),P("div",{key:n.id,class:Qe(["toast-card",`toast-card--${n.tone}`]),role:"status"},[u("div",it,[u("p",ct,J(n.title),1),u("p",lt,J(n.message),1)]),u("button",{class:"toast-close",type:"button","aria-label":"Fermer",onClick:s=>N(st)(n.id)}," x ",8,ut)],2))),128))]))}}),mt="warchess.analytics.consent",ce=()=>typeof window<"u",Ae=e=>{if(ce())try{window.localStorage.setItem(mt,e?"1":"0")}catch{}},ft=()=>(ce(),!1),pt=e=>{},Oe=e=>{},ht=e=>{ce()&&(e&&e.afterEach(t=>{pt({payload:{path:t.fullPath}})}),window.addEventListener("error",t=>{Oe({message:t.message||"Erreur inconnue",stack:t.error?.stack,context:{source:t.filename,line:t.lineno,column:t.colno}})}),window.addEventListener("unhandledrejection",t=>{const o=t.reason;Oe({message:o?.message??"Promise rejetee",stack:o?.stack})}))},gt={key:0,class:"cookie-banner",role:"dialog","aria-live":"polite","aria-label":"Consentement"},yt=ae({__name:"CookieBanner",setup(e){const t=te(!1);Ne(()=>{t.value=ft()});const o=()=>{Ae(!0),t.value=!1},r=()=>{Ae(!1),t.value=!1};return(n,s)=>t.value?(L(),P("div",gt,[s[0]||(s[0]=u("div",{class:"cookie-banner__content"},[u("p",{class:"cookie-banner__title"},"Respect de votre vie privee"),u("p",{class:"cookie-banner__text"}," Nous utilisons des mesures anonymes pour ameliorer WarChess. Vous pouvez refuser a tout moment. ")],-1)),u("div",{class:"cookie-banner__actions"},[u("button",{class:"button-ghost",type:"button",onClick:r},"Refuser"),u("button",{class:"button-primary",type:"button",onClick:o},"Accepter")])])):ze("",!0)}}),wt="/api",oe="warchess.session.token",vt=8e3,_t=12e3,bt=400,Et="",St="auth:expired",Q=new Map,Y=new Map,E=()=>typeof window>"u"||typeof localStorage>"u"?null:localStorage.getItem(oe),le=e=>{if(!(typeof window>"u"||typeof localStorage>"u")){if(!e){localStorage.removeItem(oe);return}localStorage.setItem(oe,e)}},Pe=e=>new Promise(t=>setTimeout(t,e)),Tt=e=>e>=500||e===429,kt=e=>e instanceof Error?e.name==="AbortError"||/Network/i.test(e.message):!1,At=e=>{typeof window>"u"||window.dispatchEvent(new CustomEvent(St,{detail:{status:e}}))},Ot=async()=>null,p=async(e,t={})=>{const{timeoutMs:o,retries:r,retryDelayMs:n,cacheKey:s,cacheTtlMs:c,dedupe:i,retryAuth:S,...m}=t,a=new Headers(m.headers),l=(m.method||"GET").toUpperCase(),A=typeof m.body<"u",w=typeof FormData<"u"&&m.body instanceof FormData;!a.has("Content-Type")&&l!=="GET"&&A&&!w&&a.set("Content-Type","application/json");const _=E();_&&a.set("Authorization",`Bearer ${_}`);const g=s??[l,e,_??"",typeof m.body=="string"?m.body:""].join("|"),be=i??l==="GET",Ee=l==="GET"&&!!c&&c>0;if(Ee){const y=Y.get(g);if(y&&y.expiresAt>Date.now())return y.value;y&&Y.delete(g)}if(be){const y=Q.get(g);if(y)return y}const H=(async()=>{const y=r??(l==="GET"?1:0),Se=n??bt,Je=o??(l==="GET"?vt:_t),Be=S??!0;for(let D=0;D<=y;D+=1){const x=new AbortController,Te=()=>x.abort();m.signal&&m.signal.addEventListener("abort",Te,{once:!0});const We=setTimeout(()=>x.abort(),Je);try{const v=await fetch(`${wt}/${e}`,{...m,headers:a,signal:x.signal}),ke=await v.text();let V={};try{V=ke?JSON.parse(ke):{}}catch{V={}}if(!v.ok){const Ge=V.message||"Erreur serveur.",He=e.startsWith("auth")||e===Et;if((v.status===401||v.status===403)&&Be&&!He){if(await Ot())return p(e,{...t,retryAuth:!1});At(v.status)}if(D<y&&Tt(v.status)){await Pe(Se*Math.pow(2,D));continue}throw new Error(Ge)}return Ee&&Y.set(g,{expiresAt:Date.now()+(c??0),value:V}),V}catch(v){if(m.signal?.aborted)throw v;if(D<y&&kt(v)){await Pe(Se*Math.pow(2,D));continue}throw v}finally{clearTimeout(We),m.signal&&m.signal.removeEventListener("abort",Te)}}throw new Error("Erreur serveur.")})();return be&&(Q.set(g,H),H.finally(()=>{Q.delete(g)})),H},$e="warchess.offline.queue",Le=5;let f=[],Ie=!1,X=!1;const re=new Set,z=()=>typeof window<"u",M=()=>!z()||typeof navigator>"u"?!1:navigator.onLine===!1,Ue=e=>e instanceof Error?e.name==="AbortError"?!0:/Network|Failed to fetch|load failed/i.test(e.message):!1,$=()=>{if(!(Ie||!z())){Ie=!0;try{const e=window.localStorage.getItem($e);f=e?JSON.parse(e):[]}catch{f=[]}}},ue=()=>{if(z())try{window.localStorage.setItem($e,JSON.stringify(f))}catch{}},W=()=>{for(const e of re)e(f.length)},Pt=e=>($(),re.add(e),e(f.length),()=>{re.delete(e)}),Lt=()=>{$(),f=[],ue(),W()},It=()=>{!z()||!("serviceWorker"in navigator)||!("SyncManager"in window)||navigator.serviceWorker.ready.then(t=>{const o=t.sync;if(o)return o.register("warchess-sync")}).catch(()=>{})},Dt=()=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`,De=async(e,t)=>{$(),e==="profile-save"&&(f=f.filter(r=>r.type!=="profile-save"));const o={id:Dt(),type:e,payload:t,createdAt:new Date().toISOString(),attempts:0};return f.push(o),ue(),W(),It(),M()||b(),o.id},Ct=async e=>{switch(e.type){case"profile-save":{const t=e.payload.profile;if(!t)return;await p("dashboard-save",{method:"POST",body:JSON.stringify({profile:t}),dedupe:!1});return}case"friend-request":{const t=e.payload.userId;if(!t)return;await p("friends-request",{method:"POST",body:JSON.stringify({userId:t}),dedupe:!1});return}case"match-invite":{const t=e.payload.userId;if(!t)return;await p("match-invite-create",{method:"POST",body:JSON.stringify({userId:t,timeControl:e.payload.timeControl??"10+0",requesterSide:e.payload.requesterSide??"Aleatoire"}),dedupe:!1});return}case"match-move":{const t=e.payload.matchId,o=e.payload.from,r=e.payload.to,n=e.payload.notation;if(!t||!o||!r||!n)return;await p("match-move-add",{method:"POST",body:JSON.stringify({matchId:t,from:o,to:r,notation:n}),dedupe:!1});return}default:return}},b=async()=>{if($(),X||M()||!E()||!f.length)return;X=!0;const e=[];for(let t=0;t<f.length;t+=1){const o=f[t];if(o&&!(o.attempts>=Le))try{await Ct(o)}catch(r){if(o.attempts+=1,M()||Ue(r)){e.push(o,...f.slice(t+1));break}o.attempts<Le&&e.push(o)}}f=e,ue(),W(),X=!1},Rt=()=>{$(),W(),M()||b(),z()&&(window.addEventListener("online",()=>{b()}),"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",e=>{e.data?.type==="flush-queue"&&b()}),document.addEventListener("visibilitychange",()=>{document.hidden||b()}))},Mt={key:0,class:"offline-banner",role:"status","aria-live":"polite"},Vt={key:1,class:"offline-banner offline-banner--pending",role:"status"},Nt={class:"offline-banner__text"},zt=ae({__name:"App",setup(e){const t=te(!0),o=te(0);let r=null;const n=()=>{typeof navigator>"u"||(t.value=navigator.onLine)},s=()=>{typeof window>"u"||window.location.reload()};return Ne(()=>{typeof window>"u"||(n(),window.addEventListener("online",n),window.addEventListener("offline",n),r=Pt(c=>{o.value=c}))}),Ye(()=>{typeof window>"u"||(window.removeEventListener("online",n),window.removeEventListener("offline",n),r&&(r(),r=null))}),(c,i)=>(L(),P(Ve,null,[t.value?o.value?(L(),P("div",Vt,[u("div",null,[i[2]||(i[2]=u("p",{class:"offline-banner__title"},"Actions en attente",-1)),u("p",Nt,J(o.value)+" action"+J(o.value>1?"s":"")+" en cours de synchronisation. ",1)]),u("button",{class:"button-ghost",type:"button",onClick:i[0]||(i[0]=(...S)=>N(b)&&N(b)(...S))},"Synchroniser")])):ze("",!0):(L(),P("div",Mt,[i[1]||(i[1]=u("div",null,[u("p",{class:"offline-banner__title"},"Vous etes hors ligne."),u("p",{class:"offline-banner__text"},"Certaines actions peuvent etre indisponibles.")],-1)),u("button",{class:"button-ghost",type:"button",onClick:s},"Reessayer")])),K(N(Xe)),K(dt),K(yt)],64))}}),$t="modulepreload",Ut=function(e,t){return new URL(e,t).href},Ce={},d=function(t,o,r){let n=Promise.resolve();if(o&&o.length>0){let m=function(a){return Promise.all(a.map(l=>Promise.resolve(l).then(A=>({status:"fulfilled",value:A}),A=>({status:"rejected",reason:A}))))};const c=document.getElementsByTagName("link"),i=document.querySelector("meta[property=csp-nonce]"),S=i?.nonce||i?.getAttribute("nonce");n=m(o.map(a=>{if(a=Ut(a,r),a in Ce)return;Ce[a]=!0;const l=a.endsWith(".css"),A=l?'[rel="stylesheet"]':"";if(r)for(let _=c.length-1;_>=0;_--){const g=c[_];if(g.href===a&&(!l||g.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${a}"]${A}`))return;const w=document.createElement("link");if(w.rel=l?"stylesheet":$t,l||(w.as="script"),w.crossOrigin="",w.href=a,S&&w.setAttribute("nonce",S),document.head.appendChild(w),l)return new Promise((_,g)=>{w.addEventListener("load",_),w.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${a}`)))})}))}function s(c){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=c,window.dispatchEvent(i),!i.defaultPrevented)throw c}return n.then(c=>{for(const i of c||[])i.status==="rejected"&&s(i.reason);return t().catch(s)})},jt=()=>d(()=>import("./IntroView-BY3kYQ-t.js"),__vite__mapDeps([0,1,2]),import.meta.url),qt=()=>d(()=>import("./LoginView-wc3Xs5ta.js"),__vite__mapDeps([3,1]),import.meta.url),Ft=()=>d(()=>import("./RegisterView-DmpoF3Bt.js"),__vite__mapDeps([4,1]),import.meta.url),Jt=()=>d(()=>import("./ForgotPasswordView-BqArdVb8.js"),__vite__mapDeps([5,1]),import.meta.url),Bt=()=>d(()=>import("./HomeView-DECqALwe.js"),__vite__mapDeps([6,1,7,2,8,9,10,11,12]),import.meta.url),Wt=()=>d(()=>import("./MatchListView-K1Tdpzla.js"),__vite__mapDeps([13,1,7,2,8]),import.meta.url),Gt=()=>d(()=>import("./StoryView-CHFZF-u2.js"),__vite__mapDeps([14,1,7,2,11]),import.meta.url),Ht=()=>d(()=>import("./StoryChapterView-5fxheSTq.js"),__vite__mapDeps([15,1,7,2,11]),import.meta.url),xt=()=>d(()=>import("./GameView-BBRaWjpN.js"),__vite__mapDeps([16,1,7,2,17,12]),import.meta.url),Kt=()=>d(()=>import("./LeaderboardView-nEd2d1cU.js"),__vite__mapDeps([18,1,7,2,9]),import.meta.url),Qt=()=>d(()=>import("./ProfileView-FVv6qQWh.js"),__vite__mapDeps([19,1,7,2]),import.meta.url),Yt=()=>d(()=>import("./ProfileAnalysisView-CNfix-6g.js"),__vite__mapDeps([20,1,7,2,10,21]),import.meta.url),Xt=()=>d(()=>import("./UserProfileView-BlSYDj53.js"),__vite__mapDeps([22,1,7,2]),import.meta.url),Zt=()=>d(()=>import("./FriendsView-DTU2y4FG.js"),__vite__mapDeps([23,1,7,2]),import.meta.url),eo=()=>d(()=>import("./SettingsView-J-quDJxK.js"),__vite__mapDeps([24,1,7,2]),import.meta.url),to=()=>d(()=>import("./HelpView-Dh8kUIO3.js"),__vite__mapDeps([25,1,2]),import.meta.url),oo=()=>d(()=>import("./PerfView-OxRL5HpH.js"),__vite__mapDeps([26,7,1,2]),import.meta.url),ro=()=>d(()=>import("./NotFoundView-Dm9vzTRS.js"),__vite__mapDeps([27,1,2]),import.meta.url),I=Ze({history:et("./"),scrollBehavior(){return{top:0}},routes:[{path:"/",redirect:"/intro"},{path:"/intro",name:"intro",component:jt,meta:{title:"Accueil",description:"Decouvrez WarChess, l'arene d'echecs pour jouer et progresser rapidement."}},{path:"/auth",name:"auth",component:qt,alias:"/connexion",meta:{title:"Connexion",description:"Connectez-vous ou jouez en invite pour demarrer une partie."}},{path:"/dashboard",name:"dashboard",component:Bt,alias:"/tableau-de-bord",meta:{title:"Dashboard",description:"Suivez vos performances, matchs et analyses recentes."}},{path:"/matchs",name:"matchs",component:Wt,alias:"/matches",meta:{title:"Matchs",description:"Creez et gerez vos parties en cours."}},{path:"/histoire",name:"histoire",component:Gt,meta:{title:"Mode histoire",description:"Progressez dans une campagne de chapitres a difficulte croissante."}},{path:"/histoire/:id",name:"histoire-chapitre",component:Ht,meta:{title:"Chapitre",description:"Detail du chapitre et lancement de la mission."}},{path:"/play/:id?",name:"play",component:xt,alias:"/jeu/:id?",meta:{title:"Jouer",description:"Lancez une partie locale ou en ligne."}},{path:"/leaderboard",name:"leaderboard",component:Kt,alias:"/classement",meta:{title:"Classement",description:"Comparez vos performances avec les meilleurs joueurs."}},{path:"/profile",name:"profile",component:Qt,alias:"/profil",meta:{title:"Profil",description:"Gerez vos informations et la securite du compte."}},{path:"/amis",name:"amis",component:Zt,meta:{title:"Amis",description:"Invitez et suivez vos partenaires de jeu."}},{path:"/joueur/:id",name:"joueur",component:Xt,meta:{title:"Profil joueur",description:"Consultez les statistiques publiques."}},{path:"/profil/analyse",name:"profil-analyse",component:Yt,meta:{title:"Analyse",description:"Analysez votre progression sur la saison."}},{path:"/settings",name:"settings",component:eo,alias:"/parametres",meta:{title:"Parametres",description:"Ajustez l'interface, les notifications et la confidentialite."}},{path:"/inscription",name:"inscription",component:Ft,alias:"/auth/inscription",meta:{title:"Inscription",description:"Creez un compte WarChess."}},{path:"/mot-de-passe-oublie",name:"mot-de-passe-oublie",component:Jt,alias:"/auth/mot-de-passe-oublie",meta:{title:"Mot de passe",description:"Reinitialisez votre acces au compte."}},{path:"/help",name:"help",component:to,alias:"/aide",meta:{title:"Aide",description:"Regles, FAQ et conseils pour bien demarrer."}},{path:"/perf",name:"perf",component:oo,alias:"/diagnostics",meta:{title:"Diagnostics",description:"Mesures de performance et erreurs client."}},{path:"/:pathMatch(.*)*",name:"not-found",component:ro,meta:{title:"Page introuvable",description:"La page demandee n'existe pas."}}]});I.beforeEach(e=>{if(e.name!=="play")return!0;const t=typeof e.params.id=="string"&&e.params.id.length>0,o=typeof e.query.allow=="string"&&e.query.allow==="1";let r=!1;if(typeof window<"u")try{r=window.sessionStorage.getItem("warchess.play.access")==="1",r&&window.sessionStorage.removeItem("warchess.play.access")}catch{r=!1}return t||o||r?!0:{path:"/matchs"}});const de="warchess.session.guest",no=()=>typeof window>"u"?!1:window.localStorage.getItem(de)==="1",Co=()=>{typeof window>"u"||window.localStorage.setItem(de,"1")},me=()=>{typeof window>"u"||window.localStorage.removeItem(de)},je="warchess.dashboard",U={profile:{id:"",name:"",title:"",rating:1200,motto:"",location:"",lastSeen:"",email:"",avatarUrl:""},games:[],goals:[]},so={name:"Invite",title:"Mode invite",rating:1200,motto:"Jouez librement, progressez ensuite.",location:"Hors ligne",lastSeen:"Maintenant",email:""};let h=null,q=null,C=0;const ao=6e4,io=()=>{if(typeof window>"u")return null;try{const e=window.localStorage.getItem(je);return e?JSON.parse(e):null}catch{return null}},B=e=>{if(!(typeof window>"u"))try{window.localStorage.setItem(je,JSON.stringify(e))}catch{}},ne=e=>e?{profile:{...U.profile,...e.profile},games:e.games?.length?e.games:U.games,goals:e.goals?.length?e.goals:U.goals}:U,Re=e=>no()?{...e,profile:{...e.profile,...so}}:e,co=()=>{h=null,q=null,C=0},lo=(e,t)=>{e.profile={...e.profile,...t.profile},e.games=t.games,e.goals=t.goals},uo=async()=>{const e=io(),t=Re(ne(e)),o=e?.profile?.avatarUrl??"";if(h||(h=t),!E())return h;const r=Date.now()-C>ao;return!q&&r&&(q=p("dashboard-get").then(n=>{if(!n.ok)return t;const s=ne(n.dashboard);return o&&!s.profile.avatarUrl&&(s.profile.avatarUrl=o),Re(s)}).catch(()=>t).then(n=>h?(lo(h,n),B(h),C=Date.now(),h):(h=n,B(n),C=Date.now(),n)).finally(()=>{q=null})),h},Ro=async e=>{if(h=e,B(e),C=Date.now(),!E())return e;if(M())return await De("profile-save",{profile:e.profile}),e;try{const t=await p("dashboard-save",{method:"POST",body:JSON.stringify({profile:e.profile})}),o=t.ok?ne(t.dashboard):e;return t.ok&&e.profile.avatarUrl&&!o.profile.avatarUrl&&(o.profile.avatarUrl=e.profile.avatarUrl),h=o,B(o),C=Date.now(),o}catch(t){return(Ue(t)||M())&&await De("profile-save",{profile:e.profile}),e}},j=[];let k=null,F=null;const mo=e=>e==="planifie"?"waiting":e==="en_cours"?"started":e==="termine"?"finished":e==="abandonne"?"aborted":e==="waiting"||e==="ready"||e==="started"||e==="finished"||e==="aborted"?e:"waiting",fo=e=>({...e,status:mo(e.status)}),po=()=>{k=null,F=null},fe=async()=>k||(E()?(F||(F=p("matches-get").then(e=>e.ok&&e.matches?.length?e.matches:j).catch(()=>j).then(e=>e.filter(t=>t.mode==="JcJ").map(fo)).then(e=>(k=e,e))),F):(k=j,j)),Mo=async e=>(await fe()).find(o=>o.id===e)??null,Vo=async(e="history")=>{const t=await fe(),o=e==="all"?[]:t.filter(r=>r.status!=="finished"&&r.status!=="aborted");if(!E())return k=o,{ok:!0,message:"Historique efface.",matches:o};try{const r=await p("matches-clear",{method:"POST",body:JSON.stringify({scope:e})}),n=r.ok&&r.matches?r.matches:o;return k=n,{ok:r.ok,message:r.message,matches:n}}catch(r){return k=o,{ok:!1,message:r.message,matches:o}}},ho=async()=>{E()&&await Promise.allSettled([uo(),fe()])},qe="warchess.preferences",R={darkMode:!1,simplifiedUi:!1,language:"Francais",timezone:"Europe/Paris",cadence:"10+0 Rapide",boardTheme:"Theme sable",haloTheme:"blue",notifications:{matchAlerts:!0,matchResults:!0,tacticalTips:!1},privacy:{publicProfile:!0,visibleHistory:!1,sharedStats:!0}},go=()=>{if(typeof window>"u")return{};try{const e=window.localStorage.getItem(qe);return e?JSON.parse(e):{}}catch{return{}}},yo=()=>{const e=go();return{...R,...e,notifications:{...R.notifications,...e.notifications??{}},privacy:{...R.privacy,...e.privacy??{}}}},No=e=>{typeof window>"u"||window.localStorage.setItem(qe,JSON.stringify(e))},zo=()=>({...R,notifications:{...R.notifications},privacy:{...R.privacy}}),wo=e=>{if(typeof document>"u")return;const t=document.documentElement,o=document.body,r=o?[t,o]:[t];r.forEach(a=>{a.classList.toggle("theme-dark",e.darkMode),a.classList.toggle("ui-simple",e.simplifiedUi)});const n=["theme-halo-blue","theme-halo-red","theme-halo-green","theme-halo-violet","theme-halo-amber","theme-halo-teal","theme-halo-slate"];r.forEach(a=>{n.forEach(l=>a.classList.remove(l))});const s=["blue","red","green","violet","amber","teal","slate"].includes(e.haloTheme)?e.haloTheme:"blue";r.forEach(a=>{a.classList.add(`theme-halo-${s}`)});const c=["board-theme-sable","board-theme-contraste"];r.forEach(a=>{c.forEach(l=>a.classList.remove(l))});const i={"Theme sable":"board-theme-sable","Theme contraste":"board-theme-contraste"},S=i["Theme sable"],m=i[e.boardTheme]??S;r.forEach(a=>{a.classList.add(m)})},Z={title:"WarChess | Echecs nouvelle generation",description:"WarChess, plateforme d'echecs moderne pour jouer et progresser.",image:"/favicon-512x512.png"},vo=()=>typeof window>"u"?"":window.location.origin,T=(e,t,o="name")=>{if(typeof document>"u")return;let r=document.querySelector(`meta[${o}="${e}"]`);r||(r=document.createElement("meta"),r.setAttribute(o,e),document.head.appendChild(r)),r.setAttribute("content",t)},_o=(e,t)=>{if(typeof document>"u")return;let o=document.querySelector(`link[rel="${e}"]`);o||(o=document.createElement("link"),o.setAttribute("rel",e),document.head.appendChild(o)),o.setAttribute("href",t)},bo=(e,t)=>{if(typeof document>"u")return;({...e});const o=e.title?`${e.title} | WarChess`:Z.title;document.title=o;const r=e.description??Z.description,n=e.image??Z.image,s=`${vo()}/#${t.path}`;T("description",r),T("og:title",o,"property"),T("og:description",r,"property"),T("og:image",n,"property"),T("og:url",s,"property"),T("twitter:title",o),T("twitter:description",r),T("twitter:image",n),_o("canonical",s)},Eo=e=>{e.afterEach(t=>{bo(t.meta||{},t)})},pe=()=>{co(),po()},Fe=()=>{le(null),me(),pe(),Lt()},$o=async()=>{try{E()&&await p("auth-logout",{method:"POST"})}catch{}finally{Fe()}},Uo=async()=>{if(!E())return null;try{const e=await p("auth-session");return e.ok?e.user??null:null}catch{return null}},jo=async(e,t,o)=>{if(!e||!t||!o)return{ok:!1,message:"Veuillez remplir tous les champs."};try{const r=await p("auth-register",{method:"POST",body:JSON.stringify({email:e.trim(),password:t,displayName:o.trim()})});return r.ok&&r.token&&(le(r.token),me(),pe(),b()),{ok:r.ok,message:r.message,user:r.user}}catch(r){return{ok:!1,message:r.message}}},qo=async(e,t)=>{if(!e||!t)return{ok:!1,message:"Veuillez remplir tous les champs."};try{const o=await p("auth-login",{method:"POST",body:JSON.stringify({email:e.trim(),password:t})});return o.ok&&o.token&&(le(o.token),me(),pe(),b()),{ok:o.ok,message:o.message,user:o.user}}catch(o){return{ok:!1,message:o.message}}},Fo=e=>e.trim().toLowerCase()?{ok:!0,message:"Si un compte existe, un lien de reinitialisation a ete envoye."}:{ok:!1,message:"Veuillez saisir un email."},Jo=async(e,t)=>{if(!e||!t)return{ok:!1,message:"Veuillez remplir tous les champs."};try{const o=await p("auth-password",{method:"POST",body:JSON.stringify({currentPassword:e,nextPassword:t})});return{ok:o.ok,message:o.message}}catch(o){return{ok:!1,message:o.message}}},he="warchess.observability.errors",G="warchess.observability.perf",So=50,ge=()=>typeof window<"u",ye=e=>{if(!ge())return[];try{const t=window.localStorage.getItem(e);return t?JSON.parse(t):[]}catch{return[]}},se=(e,t)=>{if(ge())try{window.localStorage.setItem(e,JSON.stringify(t.slice(-So)))}catch{}},we=(e,t)=>{const o=ye(e);o.push(t),se(e,o)},ve=()=>`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`,Me=(e,t,o)=>{we(he,{id:ve(),message:e,stack:t,context:o,time:new Date().toISOString()})},ee=(e,t,o)=>{we(G,{id:ve(),type:"navigation",name:e,value:t,meta:o,time:new Date().toISOString()})},To=(e,t,o)=>{we(G,{id:ve(),type:"route",name:e,value:t,meta:o,time:new Date().toISOString()})},Bo=()=>ye(he),Wo=()=>ye(G),Go=()=>{se(he,[]),se(G,[])},ko=e=>{if(!ge())return;const t=performance.getEntriesByType("navigation")[0];if(t&&(ee("ttfb",t.responseStart-t.requestStart),ee("domContentLoaded",t.domContentLoadedEventEnd-t.startTime),ee("load",t.loadEventEnd-t.startTime)),e){let o=0;e.beforeEach(()=>{o=performance.now()}),e.afterEach(r=>{o>0&&To("route-change",performance.now()-o,{path:r.fullPath})})}window.addEventListener("error",o=>{Me(o.message||"Erreur inconnue",o.error?.stack,{source:o.filename,line:o.lineno,column:o.colno})}),window.addEventListener("unhandledrejection",o=>{const r=o.reason;Me(r?.message??"Promise rejetee",r?.stack,{source:"unhandledrejection"})})};ho();wo(yo());const _e=tt(zt);_e.use(ot());_e.use(I);Eo(I);ht(I);ko(I);Rt();_e.mount("#app");if(typeof document<"u"){document.documentElement.classList.add("app-ready");const e=document.getElementById("app-loader");e&&(e.setAttribute("aria-hidden","true"),window.setTimeout(()=>{e.remove()},350))}"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").catch(()=>{})});typeof window<"u"&&window.addEventListener("auth:expired",()=>{const e=I.currentRoute.value;if(!e.path.startsWith("/auth")){try{window.sessionStorage.setItem("warchess.postLoginRedirect",e.fullPath)}catch{}Fe(),I.push({path:"/auth",query:{reason:"expired"}})}});export{Bo as A,Go as B,no as C,$o as D,d as _,Lo as a,Io as b,Fo as c,fe as d,E as e,p as f,uo as g,Vo as h,M as i,De as j,Ue as k,qo as l,po as m,Do as n,Mo as o,Uo as p,Ro as q,jo as r,Co as s,pt as t,Jo as u,yo as v,No as w,wo as x,zo as y,Wo as z};
